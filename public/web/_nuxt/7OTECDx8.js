const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./BlqZ-tUz.js","./Dgvg0_To.js","./BYm23QKU.js","./DGUAW_1C.js","./DDJ79SjH.js","./Ti3HjCpC.js","./DegKy-XA.js","./B1TeSxwV.js","./RmzZBBRE.js","./C4jlvBh2.js","./C-XPfH0G.js","./7d3iyZ8h.js","./BLC1YsUd.js"])))=>i.map(i=>d[i]);
import{d as G,aX as W,e as H,ap as q,ar as X,f as J,Q as K,au as Y,a$ as Z,i as ee,R as E,ag as te,c as i,q as t,t as r,m as l,x as o,F as re,C as se,l as _,v as I,D as oe,_ as ae,b0 as ne,U as S,o as d,z as ce,A as ie,y as b}from"#entry";import{_ as de}from"./tnelovi7.js";import{a as le,c as T,d as pe,b as Q}from"./D5Fk3VIb.js";import{u as me}from"./CIZXtYrT.js";import"./DoL5-2Ox.js";import"./CXk2IlXx.js";import"./DVSiT9pd.js";import"./cwT2REE1.js";import"./DaC7Nksz.js";import"./D_1uxSdv.js";import"./CZsOHrUj.js";import"./DegKy-XA.js";import"./BzLCLO6P.js";const ue={class:"h-full"},he={key:0,class:"flex h-full flex-col space-y-4 px-6 pt-6"},ge={class:"flex flex-1 flex-col space-y-8 overflow-y-auto"},fe={class:"bg-muted flex items-center gap-4 rounded-lg p-4"},_e={class:"text-lg font-medium"},ye={class:"text-center"},xe={class:"space-y-4"},ve={class:"text-lg font-medium"},ke={key:0,class:"grid grid-cols-1 gap-x-4 gap-y-6 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4"},Ie=["onClick"],be={key:0,class:"absolute -top-4 left-0 rounded-tl-md rounded-br-md bg-[#352B00] px-2 py-0.5 text-xs text-[#FFE7B5]"},we={class:"mb-2 flex items-center gap-2"},Ce={class:"text-xl font-bold"},Pe={class:"mb-4 text-lg font-medium"},Re={class:"space-y-2"},Oe={key:0,class:"flex items-center gap-2"},Me={class:"space-x-1 text-sm text-gray-600"},Ee={class:"font-bold"},Se={key:1,class:"text-muted-foreground"},Te={class:"space-y-4"},Qe={class:"text-lg font-medium"},$e={class:"flex flex-row items-center justify-start gap-6"},Ae={class:"flex items-center gap-2"},De={class:"space-y-4"},Ue={class:"text-lg font-medium"},Ve=["innerHTML"],ze={key:1,class:"text-muted-foreground text-sm"},Be={class:"flex items-center justify-between border-t pt-4"},Fe={class:"text-lg"},Le={class:"text-muted-foreground text-sm"},Ne={class:"flex items-center gap-4"},je={key:0,class:"text-xl font-bold"},Ge={key:1,class:"flex h-full w-full items-center justify-center p-20"},We={class:"w-full max-w-md p-8 text-center"},He={class:"mb-2 text-2xl font-bold"},qe={class:"text-muted-foreground text-sm"},lt=G({__name:"recharge-center",async setup(Xe){let u,w;const $=E(()=>S(()=>import("./BlqZ-tUz.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11]),import.meta.url)),A=E(()=>S(()=>import("./BLC1YsUd.js"),__vite__mapDeps([12,1,2,3,4,5,6,7,8,9,10,11]),import.meta.url)),D=W(),{t:n}=H(),y=q(),C=X(),p=J(),P=K(),e=Y({_prepaidData:null,orderInfo:null,rechargeOptions:[],paymentMethods:[],selectedOptionIndex:0,selectedPaymentMethod:1,rechargeInstructions:void 0,rechargeSuccess:!1,isQrCodeExpired:!1}),{start:R,clear:x}=me(async s=>{try{if(!e.orderInfo?.orderId){s();return}(await le({orderId:e.orderInfo.orderId,from:"recharge"})).payStatus===1&&(s(),await U(),await p.getUser(),z())}catch(a){console.error("Payment polling error:",a)}},{interval:3e3,maxWaitTime:12e4,stopCondition:()=>e.isQrCodeExpired,onEnded:()=>{e.rechargeSuccess||(e.isQrCodeExpired=!0)}}),{data:v}=([u,w]=Z(()=>ne("rechargeCenterInfo",()=>T(),{transform:s=>(e.paymentMethods=s.payWayList.map(a=>({value:a.payType,label:a.name,icon:a.logo})),e.rechargeInstructions=s.rechargeExplain,e.rechargeOptions=s.rechargeRule,s)})),u=await u,w(),u),U=async()=>{try{const s=await T();e.paymentMethods=s.payWayList.map(a=>({value:a.payType,label:a.name,icon:a.logo})),e.rechargeInstructions=s.rechargeExplain,e.rechargeOptions=s.rechargeRule}catch(s){console.error("Failed to refresh recharge info:",s)}},h=ee(()=>e.rechargeOptions.length===0?null:e.rechargeOptions[e.selectedOptionIndex]),V=async()=>{try{if(!h.value){y.error(n("marketing.frontend.recharge.noOptionSelected"));return}const s=await pe({id:h.value.id,payType:e.selectedPaymentMethod});e.orderInfo=s;const a=await Q({from:"recharge",orderId:s.orderId,payType:e.selectedPaymentMethod});M(a),e.isQrCodeExpired=!1,e.rechargeSuccess=!1,R()}catch(s){console.error("Recharge failed:",s)}},O=P.create($),M=async s=>{await O.open({prepaidData:s,orderInfo:e.orderInfo,isQrCodeExpired:e.isQrCodeExpired,onRefreshQrCode:()=>F()}).result&&(x(),e.isQrCodeExpired=!1,y.warning(n("marketing.frontend.recharge.cancelPay")))},z=async()=>{const a=P.create(A).open();O.close(),await a.result&&N()},B=()=>{C.push(`/profile/${p.userInfo?.id}/power-detail`)},F=async()=>{try{if(x(),!e.orderInfo?.orderId){console.error("Order ID does not exist"),y.error(n("marketing.frontend.recharge.orderNotFound"));return}const s=await Q({from:"recharge",orderId:e.orderInfo.orderId,payType:e.selectedPaymentMethod});M(s),e.isQrCodeExpired=!1,e.rechargeSuccess=!1,R()}catch(s){console.error("Failed to refresh QR code:",s)}},L=()=>{window.open("/agreement?type=agreement&item=payment","_blank")},N=()=>{C.push(`/profile/${p.userInfo?.id}/power-detail`)};return te(()=>{x()}),(s,a)=>{const g=oe,f=ce,j=de,k=ae;return d(),i("div",ue,[t(v)?.rechargeStatus?(d(),i("div",he,[r("div",ge,[r("div",fe,[l(g,{src:t(p).userInfo.avatar,size:"3xl"},null,8,["src"]),r("div",null,[r("div",_e,[r("span",null,o(t(p).userInfo.nickname||t(n)("user.frontend.profile.notSet")),1)]),r("div",{class:"text-muted-foreground flex cursor-pointer items-center gap-1",onClick:B},[r("span",ye,o(t(n)("marketing.frontend.recharge.powerBalance"))+"： "+o(t(v)?.user.power),1),l(f,{name:"i-lucide-chevron-right",class:"text-sm"})])])]),r("div",xe,[r("h2",ve,o(t(n)("marketing.frontend.recharge.selectRechargePackage")),1),t(e).rechargeOptions.length>0?(d(),i("div",ke,[(d(!0),i(re,null,se(t(e).rechargeOptions,(c,m)=>(d(),i("div",{key:m,class:ie(["border-muted relative cursor-pointer rounded-lg border p-4 transition-all duration-200",{"border-primary-500 bg-muted":t(e).selectedOptionIndex===m,"bg-primary/5":t(e).selectedOptionIndex===m,"hover:border-primary-300 border-gray-200":t(e).selectedOptionIndex!==m}]),onClick:Je=>t(e).selectedOptionIndex=m},[c.label?(d(),i("div",be,o(c.label),1)):I("",!0),r("div",we,[l(f,{name:"i-lucide-zap",class:"text-primary text-xl"}),r("span",Ce,o(c.power),1)]),r("div",Pe,"¥ "+o(c.sellPrice),1),r("ul",Re,[c.givePower?(d(),i("li",Oe,[l(f,{name:"i-lucide-check",class:"text-sm text-green-500"}),r("span",Me,[r("span",null,o(t(n)("marketing.frontend.recharge.add")),1),r("span",Ee,o(c.givePower),1),r("span",null,o(t(n)("marketing.frontend.recharge.power")),1)])])):I("",!0)])],10,Ie))),128))])):(d(),i("div",Se,o(t(n)("marketing.frontend.recharge.noRechargeOptions")),1))]),r("div",Te,[r("h2",Qe,o(t(n)("marketing.frontend.recharge.paymentMethod")),1),r("div",$e,[l(j,{modelValue:t(e).selectedPaymentMethod,"onUpdate:modelValue":a[0]||(a[0]=c=>t(e).selectedPaymentMethod=c),orientation:"horizontal",variant:"card",color:"primary",items:t(e).paymentMethods},{label:_(({item:c})=>[r("div",Ae,[l(g,{src:c?.icon,size:"2xs"},null,8,["src"]),r("span",null,o(c?.label),1)])]),_:1},8,["modelValue","items"])])]),r("div",De,[r("h2",Ue,o(t(n)("marketing.frontend.recharge.rechargeInstructions.title")),1),t(e).rechargeInstructions?(d(),i("div",{key:0,innerHTML:t(e).rechargeInstructions,class:"text-muted-foreground space-y-2 text-sm whitespace-pre-wrap"},null,8,Ve)):(d(),i("div",ze,o(t(n)("marketing.frontend.recharge.rechargeInstructions.content")),1))])]),r("div",Be,[r("div",Fe,[r("span",Le,o(t(n)("marketing.frontend.recharge.agreement")),1),l(k,{variant:"link",class:"p-0",onClick:L},{default:_(()=>[b(" 《"+o(t(D).siteConfig?.agreement.paymentTitle||t(n)("marketing.frontend.recharge.payment"))+"》 ",1)]),_:1})]),r("div",Ne,[t(h)?(d(),i("div",je," ¥ "+o(t(h)?.sellPrice),1)):I("",!0),l(k,{color:"primary",size:"lg",disabled:!t(v)?.rechargeRule.length,loadingAuto:"",onClick:V},{default:_(()=>[b(o(t(n)("marketing.frontend.recharge.immediatelyPurchase")),1)]),_:1},8,["disabled"])])])])):(d(),i("div",Ge,[r("div",We,[l(f,{name:"i-lucide-lock",class:"text-primary mx-auto mb-4 text-4xl"}),r("h1",He,o(t(n)("marketing.frontend.recharge.notOpen")),1),r("p",qe,o(t(n)("marketing.frontend.recharge.notOpenTip")),1),l(k,{class:"mt-6",icon:"i-tabler-arrow-left",variant:"soft",onClick:a[1]||(a[1]=c=>s.$router.back())},{default:_(()=>[b(o(t(n)("marketing.frontend.recharge.back")),1)]),_:1})])]))])}}});export{lt as default};
