import B from"./CDSfhndf.js";import{_ as C}from"./Brlt-NDg.js";import{_ as R}from"./ilPiIi3f.js";import D from"./BjYsydzc.js";import{_ as H}from"./tnelovi7.js";import{_ as j}from"./CaHBeWuX.js";import{d as A,e as M,ap as W,s as G,au as K,aK as L,k as g,o as y,l as a,m as i,t as m,q as e,x as d,I as P,_ as Z,y as k}from"#entry";import{_ as O}from"./Ds48qA85.js";import{_ as X}from"./BYm23QKU.js";import{E as c}from"./XBYuZpdu.js";import{d as J,a as Q,b as Y}from"./BdGqAD-s.js";import{c as ee,a as v}from"./BUyfW8JT.js";import"./DoL5-2Ox.js";import"./CjOovgR0.js";import"./DXP7Kkdt.js";import"./BRI4D6WA.js";import"./DlAUqK2U.js";import"./CXk2IlXx.js";import"./DVSiT9pd.js";import"./cwT2REE1.js";import"./DaC7Nksz.js";import"./D_1uxSdv.js";import"./CZsOHrUj.js";import"./DegKy-XA.js";import"./DJ9SNVgt.js";import"./CgMDXot0.js";import"./DGUAW_1C.js";import"./DDJ79SjH.js";import"./Ti3HjCpC.js";import"./B1TeSxwV.js";import"./RmzZBBRE.js";import"./C4jlvBh2.js";import"./C-XPfH0G.js";import"./7d3iyZ8h.js";import"./DaWZu8wl.js";const oe={class:"text-xs"},te={class:"text-xs"},se={class:"text-xs"},ne={class:"text-xs"},ae={class:"flex items-center gap-2"},le={class:"text-xs"},ie={class:"flex justify-end gap-4 pt-8"},We=A({__name:"add-extension",props:{isEdit:{type:Boolean,default:!1},id:{default:null},initialData:{default:()=>({})}},emits:["close"],setup(V,{emit:$}){const b=$,r=V,{t}=M(),u=W(),x=G(!1),s=K({name:"",icon:"",packName:"",description:"",version:"",type:1,supportTerminal:[],author:{avatar:"",name:"",homepage:""},...r.initialData}),h=ee({name:v().required(t("extensions.develop.form.nameRequired")),packName:v().required(t("extensions.develop.form.keyRequired")).matches(/^[a-zA-Z][a-zA-Z0-9_-]*$/,t("extensions.develop.form.keyFormat")),description:v().required(t("extensions.develop.form.descriptionRequired")),version:v().required(t("extensions.develop.form.versionRequired")).matches(/^\d+\.\d+\.\d+$/,t("extensions.develop.form.versionFormat"))}),E=()=>{Object.keys(s).forEach(l=>{const o=l;typeof s[o]=="string"&&(s[o]="")}),s.type=1,s.supportTerminal=[c.WEB],u.info(t("extensions.develop.messages.formReset"))},N=P(async l=>{if(!l)return x.value=!1,!0;try{const{exists:o}=await J(l,r.isEdit?r.id?.toString():void 0);return o?(u.error(t("extensions.develop.form.keyExists")),x.value=t("extensions.develop.form.keyExists"),!1):(x.value=!1,!0)}catch(o){return console.error("Failed to check identifier uniqueness:",o),u.error(t("extensions.develop.messages.checkIdentifierError")),!1}},500),{isLock:T,lockFn:U}=L(async()=>{try{const l={name:s.name,identifier:s.packName,description:s.description,version:s.version,icon:s.icon,author:s.author||{avatar:"",name:"",homepage:""},type:s.type,status:1,supportTerminal:s.supportTerminal.map(o=>Number(o))};return r.isEdit&&r.id?(await Q(r.id.toString(),l),u.success(t("extensions.develop.messages.updateSuccess"))):(await Y(l),u.success(t("extensions.develop.messages.createSuccess"))),b("close",!0),!0}catch(l){return console.error("Failed to submit form:",l),u.error(t("extensions.develop.messages.submitError")),!1}});return(l,o)=>{const f=B,p=C,q=R,w=D,I=H,S=j,_=Z,F=O,z=X;return y(),g(z,{title:l.$t("extensions.modal.addExtension"),description:l.$t("extensions.modal.addExtensionDescription"),ui:{content:"max-w-xl"},onClose:o[11]||(o[11]=n=>b("close",!1))},{default:a(()=>[i(F,{ref:"formRef",state:e(s),schema:e(h),class:"w-full space-y-2",onSubmit:e(U)},{default:a(()=>[i(p,{label:e(t)("extensions.develop.form.name"),required:"",name:"name"},{default:a(()=>[i(f,{modelValue:e(s).name,"onUpdate:modelValue":o[0]||(o[0]=n=>e(s).name=n),placeholder:e(t)("extensions.develop.form.nameInput"),size:"lg",ui:{root:"w-full"}},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),i(p,{label:e(t)("extensions.develop.form.icon"),required:"",name:"icon"},{help:a(()=>[m("span",oe,d(e(t)("extensions.develop.form.iconRecommendation")),1)]),default:a(()=>[i(q,{modelValue:e(s).icon,"onUpdate:modelValue":o[1]||(o[1]=n=>e(s).icon=n),class:"size-20",text:e(t)("extensions.develop.form.addIcon"),icon:"i-lucide-upload",accept:".jpg,.png,.jpeg,.gif",maxCount:1,single:!0},null,8,["modelValue","text"])]),_:1},8,["label"]),i(p,{label:e(t)("extensions.develop.form.packName"),required:"",name:"packName",error:e(x)},{help:a(()=>[m("span",te,d(e(t)("extensions.develop.form.packNameHelp")),1)]),default:a(()=>[r.isEdit?(y(),g(f,{key:0,modelValue:e(s).packName,"onUpdate:modelValue":o[2]||(o[2]=n=>e(s).packName=n),placeholder:e(t)("extensions.develop.form.packNameInput"),size:"lg",disabled:r.isEdit,ui:{root:"w-full"}},null,8,["modelValue","placeholder","disabled"])):(y(),g(f,{key:1,modelValue:e(s).packName,"onUpdate:modelValue":[o[3]||(o[3]=n=>e(s).packName=n),o[4]||(o[4]=n=>e(N)(e(s).packName))],placeholder:e(t)("extensions.develop.form.packNameInput"),size:"lg",disabled:r.isEdit,ui:{root:"w-full",base:"pl-22"}},{leading:a(()=>[...o[12]||(o[12]=[m("span",{class:"text-muted-foreground pl-1 text-sm"}," buildingai- ",-1)])]),_:1},8,["modelValue","placeholder","disabled"]))]),_:1},8,["label","error"]),i(p,{label:e(t)("extensions.develop.form.description"),required:"",name:"description"},{default:a(()=>[i(w,{modelValue:e(s).description,"onUpdate:modelValue":o[5]||(o[5]=n=>e(s).description=n),placeholder:e(t)("extensions.develop.form.descriptionInput"),size:"lg",rows:2,ui:{root:"w-full"}},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),i(p,{label:e(t)("extensions.develop.form.type"),required:"",name:"type"},{help:a(()=>[m("span",se,d(e(t)("extensions.develop.form.typeHelp")),1)]),default:a(()=>[i(I,{modelValue:e(s).type,"onUpdate:modelValue":o[6]||(o[6]=n=>e(s).type=n),items:[{label:l.$t("extensions.modal.extensionTypes.application"),value:1},{label:l.$t("extensions.modal.extensionTypes.function"),value:2}],ui:{fieldset:"flex flex-row gap-2"}},null,8,["modelValue","items"])]),_:1},8,["label"]),i(p,{label:e(t)("extensions.develop.form.supportTerminal"),required:"",name:"supportTerminal"},{help:a(()=>[m("span",ne,d(e(t)("extensions.develop.form.supportTerminalHelp")),1)]),default:a(()=>[i(S,{modelValue:e(s).supportTerminal,"onUpdate:modelValue":o[7]||(o[7]=n=>e(s).supportTerminal=n),items:[{label:l.$t("extensions.modal.terminalTypes.web"),value:e(c).WEB.toString()},{label:l.$t("extensions.modal.terminalTypes.weixin"),value:e(c).WEIXIN.toString(),disabled:!0},{label:l.$t("extensions.modal.terminalTypes.h5"),value:e(c).H5.toString(),disabled:!0},{label:l.$t("extensions.modal.terminalTypes.mp"),value:e(c).MP.toString(),disabled:!0},{label:l.$t("extensions.modal.terminalTypes.api"),value:e(c).API.toString()}],ui:{fieldset:"flex flex-row gap-2"}},null,8,["modelValue","items"])]),_:1},8,["label"]),i(p,{label:e(t)("extensions.develop.form.version"),required:"",name:"version"},{help:a(()=>[m("span",le,d(e(t)("extensions.develop.form.versionHelp")),1)]),default:a(()=>[m("div",ae,[i(f,{modelValue:e(s).version,"onUpdate:modelValue":o[8]||(o[8]=n=>e(s).version=n),placeholder:"0",length:"3",ui:{root:"w-full",base:"pl-18"}},{leading:a(()=>[...o[13]||(o[13]=[m("span",{class:"text-muted-foreground pl-1 text-sm"}," Version ",-1)])]),_:1},8,["modelValue"])])]),_:1},8,["label"]),i(p,{label:e(t)("extensions.develop.form.authorName"),name:"author.name"},{default:a(()=>[i(f,{modelValue:e(s).author.name,"onUpdate:modelValue":o[9]||(o[9]=n=>e(s).author.name=n),placeholder:e(t)("extensions.develop.form.authorNameInput"),size:"lg",ui:{root:"w-full"}},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),m("div",ie,[i(_,{color:"neutral",variant:"outline",size:"lg",onClick:o[10]||(o[10]=n=>b("close",!1))},{default:a(()=>[k(d(e(t)("console-common.cancel")),1)]),_:1}),i(_,{color:"neutral",size:"lg",onClick:E},{default:a(()=>[k(d(e(t)("console-common.reset")),1)]),_:1}),i(_,{color:"primary",size:"lg",loading:e(T),type:"submit"},{default:a(()=>[k(d(r.isEdit?e(t)("console-common.update"):e(t)("console-common.create")),1)]),_:1},8,["loading"])])]),_:1},8,["state","schema","onSubmit"])]),_:1},8,["title","description"])}}});export{We as default};
