const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./BqWskwak.js","./DDtM2OcI.js","./coNoMDN2.js","./DHFmmngs.js","./CR1AS2Ry.js","./Btvd554H.js","./BPKB8n-W.js","./B-DdbQ-X.js","./V9POJiZu.js","./MN31c9CG.js","./BstbYvQo.js","./DuSMYVIA.js","./BruVSCWF.js","./WlaO8erW.js","./kRIii9yh.js","./D6yWePie.js","./C3zg6GHm.js","./DduSJdeS.js","./VGKgjfSv.js","./CXUt0j5Y.js","./-Eb02sIQ.js","./Dk6FGhu1.js","./CCcv9mzY.js","./BFAo_s2U.js","./Cb04SOqd.js","./DRV5AIQP.js"])))=>i.map(i=>d[i]);
import{d as K,aI as F,ar as j,ap as H,b as N,e as q,Q,g as h,aL as G,w as J,H as W,i as X,c as Y,o as Z,q as u,l as b,v as A,p as o,k as ee,_ as ae,ao as se,h as s,C as te,y as oe,R as re,f as R,aS as ne,U as le}from"#entry";import{_ as ie}from"./Cif_tCX1.js";import{_ as ce}from"./CG0QMV_m.js";import de from"./BruVSCWF.js";import{_ as me}from"./DLMDXBaB.js";import{_ as ue}from"./D67g-sqv.js";import be from"./Dg6D3RQ3.js";import{_ as pe}from"./jQG0lB_l.js";import{_ as fe}from"./CTfStZur.js";import{p as ge,q as ve,r as ke,s as he}from"./DRV5AIQP.js";import{u as xe}from"./DkncK-NE.js";import{u as x}from"./CLKo8PO4.js";import{u as _e}from"./Dx01Lm3C.js";import"./Bcbime_x.js";import"./DHFmmngs.js";import"./kRIii9yh.js";import"./Btvd554H.js";import"./MN31c9CG.js";import"./C6Y-ieo6.js";import"./BPKB8n-W.js";import"./B-DdbQ-X.js";import"./V9POJiZu.js";import"./CuOaO1Pb.js";import"./D6yWePie.js";import"./DuSMYVIA.js";import"./3UOIlTK8.js";import"./DduSJdeS.js";import"./VGKgjfSv.js";import"./C8uaHDBS.js";import"./WlaO8erW.js";import"./CR1AS2Ry.js";import"./C3zg6GHm.js";import"./DlAUqK2U.js";const we={class:"flex h-full w-full flex-col px-6"},ye={class:"flex flex-col justify-center gap-1 pt-4"},Ae={class:"text-lg! font-bold"},Re={class:"text-muted-foreground text-sm"},$e={class:"flex w-full justify-between gap-4 py-6 backdrop-blur-sm"},Ie={class:"flex items-center gap-2 md:ml-auto"},Ue={class:"mt-auto flex items-center justify-end gap-3 py-4"},ca=K({__name:"members",setup(Se){const $=re(()=>le(()=>import("./BqWskwak.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25]),import.meta.url)),p=ae,_=ie,w=ce,I=de,U=te,S=me,C=oe,{params:T}=F(),V=j(),f=H(),{t:a}=N(),g=q("table"),D=Q(),v=h(()=>T.id),d=G({datasetId:v.value||"",username:"",role:void 0,isActive:void 0}),m=h(()=>({user:a("ai-datasets.backend.members.table.user"),role:a("ai-datasets.backend.members.table.role"),status:a("console-common.status"),createdAt:a("ai-datasets.backend.members.table.createdAt"),lastActiveAt:a("ai-datasets.backend.members.table.lastActiveAt"),actions:a("console-common.operation")})),{paging:l,getLists:i}=xe({fetchFun:ge,params:d}),y=h(()=>l.items.find(e=>e.oneself)),M={owner:{label:a("ai-datasets.backend.members.role.owner"),color:"error"},manager:{label:a("ai-datasets.backend.members.role.manager"),color:"warning"},editor:{label:a("ai-datasets.backend.members.role.editor"),color:"primary"},viewer:{label:a("ai-datasets.backend.members.role.viewer"),color:"neutral"}},O=[{accessorKey:"user",header:()=>s("p",{class:""},`${m.value.user}`),cell:({row:e})=>s("div",{class:"flex items-center gap-3"},[s(U,{src:e.original.user?.avatar,alt:e.original.user?.username||e.original.userId,size:"sm"}),s("div",void 0,[s("div",{class:"flex items-center gap-2"},[s("p",{class:"font-medium text-highlighted"},e.original.user?.nickname||e.original.user?.username||e.original.userId),e.original.oneself?s(_,{color:"primary",variant:"subtle",size:"xs"},()=>a("ai-datasets.backend.members.self")):null]),e.original.user?.username?s("p",{class:"text-sm text-muted-foreground truncate max-w-xs"},e.original.user.username):null,e.original.note?s("p",{class:"text-sm text-muted-foreground mt-1"},`${a("ai-datasets.backend.members.note")}: ${e.original.note}`):null])])},{accessorKey:"role",header:()=>s("div",{class:"flex items-center gap-2"},[s("p",{class:""},`${m.value.role}`),s(S,{mode:"hover",openDelay:200,content:{align:"start",side:"bottom",sideOffset:8}},{default:()=>s(C,{name:"i-lucide-info",class:"text-muted-foreground size-4 cursor-help"}),content:()=>s("div",{class:"w-80 space-y-3 p-4"},[s("h3",{class:"text-sm font-semibold mb-3"},a("ai-datasets.backend.members.rolePermissionDescription")),s("ul",{class:"space-y-2.5 text-sm"},[s("li",{class:"flex flex-col gap-1"},[s("span",{class:"font-medium"},`${a("ai-datasets.backend.members.role.owner")}:`),s("span",{class:"text-muted-foreground"},a("ai-datasets.backend.members.roleOwnerDescription"))]),s("li",{class:"flex flex-col gap-1"},[s("span",{class:"font-medium"},`${a("ai-datasets.backend.members.role.manager")}:`),s("span",{class:"text-muted-foreground"},a("ai-datasets.backend.members.roleManagerDescription"))]),s("li",{class:"flex flex-col gap-1"},[s("span",{class:"font-medium"},`${a("ai-datasets.backend.members.role.editor")}:`),s("span",{class:"text-muted-foreground"},a("ai-datasets.backend.members.roleEditorDescription"))]),s("li",{class:"flex flex-col gap-1"},[s("span",{class:"font-medium"},`${a("ai-datasets.backend.members.role.viewer")}:`),s("span",{class:"text-muted-foreground"},a("ai-datasets.backend.members.roleViewerDescription"))])])])})]),cell:({row:e})=>{const t=e.getValue("role"),n=M[t];return s(_,{color:n.color,variant:"subtle"},()=>n.label)}},{accessorKey:"createdAt",header:({column:e})=>{const t=e.getIsSorted();return s(p,{color:"neutral",variant:"ghost",label:m.value.createdAt,icon:t?t==="asc"?"i-lucide-arrow-up-narrow-wide":"i-lucide-arrow-down-wide-narrow":"i-lucide-arrow-up-down",class:"-mx-2.5",onClick:()=>e.toggleSorting(e.getIsSorted()==="asc")})},cell:({row:e})=>{const t=e.getValue("createdAt");return s("span",{class:"text-sm"},new Date(t).toLocaleDateString())}},{accessorKey:"lastActiveAt",header:()=>s("p",{class:""},`${m.value.lastActiveAt}`),cell:({row:e})=>{const t=e.getValue("lastActiveAt");return s("span",{class:"text-sm text-muted-foreground"},t?new Date(t).toLocaleDateString():"-")}},{id:"actions",header:()=>s("p",{class:""},`${m.value.actions}`),size:80,enableSorting:!1,enableHiding:!1,cell:({row:e})=>{const t=P(e);return t.length===0?null:s(w,{items:t},()=>s(p,{icon:"i-lucide-ellipsis-vertical",color:"neutral",variant:"ghost",class:"ml-auto"},()=>""))}}];function P(e){return[e.original.isCurrentUserOwner&&e.original.role!=="owner"?{label:a("ai-datasets.backend.members.transferOwnership"),icon:"i-lucide-crown",onClick:()=>{E(e.original)}}:null,e.original.canOperate&&!e.original.oneself?{label:a("ai-datasets.backend.members.updateRole"),icon:"i-lucide-pen-line",onClick:()=>{B(e.original)}}:null,e.original.canOperate?{label:e.original.oneself?a("ai-datasets.backend.members.exit"):a("ai-datasets.backend.members.removeMember"),icon:e.original.oneself?"i-lucide-log-out":"i-lucide-trash",color:"error",onSelect(){L(e)}}:null].filter(Boolean)}J(()=>[d.username,d.role,d.isActive],()=>{W(()=>{l.page=1,i()},300)()},{deep:!0});const z=async()=>{await D.create($).open({modelValue:!0,datasetId:v.value||""}).result&&i()},B=async e=>{try{const t=R(e.role),n=R(e.note||""),k=[{label:a("ai-datasets.backend.members.role.manager"),value:"manager"},{label:a("ai-datasets.backend.members.role.editor"),value:"editor"},{label:a("ai-datasets.backend.members.role.viewer"),value:"viewer"}],r=ne({setup(){return()=>s("div",{class:"space-y-4"},[s("div",{class:"text-sm text-gray-600 mb-3"},[a("console-common.update"),s("span",{class:"text-red-500"},e.user?.username||e.userId),a("ai-datasets.backend.members.roleTip")]),s("div",{},[s("label",{class:"block text-sm font-medium mb-2"},`${a("ai-datasets.backend.members.newRole")}:`),s(ue,{modelValue:t.value,"onUpdate:modelValue":c=>t.value=c,items:k,labelKey:"label",valueKey:"value",class:"w-full"})]),s("div",{},[s("label",{class:"block text-sm font-medium mb-2"},`${a("ai-datasets.backend.members.note")}:`),s(be,{modelValue:n.value,"onUpdate:modelValue":c=>n.value=c,placeholder:a("ai-datasets.backend.members.notePlaceholder"),class:"w-full",rows:3})])])}});await x({title:a("ai-datasets.backend.members.updateRoleModal"),content:r,confirmText:a("console-common.update"),cancelText:a("console-common.cancel"),ui:{content:"!w-md"}}),(t.value!==e.role||n.value!==(e.note||""))&&(await ve({memberId:e.id,role:t.value,note:n.value||void 0}),f.success(a("ai-datasets.backend.members.updateRoleSuccess")),i())}catch(t){console.error("更新角色失败:",t)}},L=async e=>{try{if(await x({color:"error",title:e.original.oneself?a("ai-datasets.backend.members.confirmExit"):a("ai-datasets.backend.members.confirmRemove"),content:e.original.oneself?a("ai-datasets.backend.members.confirmExitContent"):a("ai-datasets.backend.members.confirmRemoveContent"),confirmText:e.original.oneself?a("console-common.exit"):a("console-common.remove"),ui:{content:"!w-sm"}}),await ke({memberId:e.original.id}),e.original.oneself){V.push(_e("ai-datasets:list")),f.success(a("ai-datasets.backend.members.exitSuccess"));return}f.success(a("ai-datasets.backend.members.removeSuccess")),i()}catch(t){console.error("移除失败:",t)}},E=async e=>{try{await x({color:"warning",title:a("ai-datasets.backend.members.transferOwnership"),content:s("div",{class:"text-sm text-gray-600"},[s("p",{class:"mb-2"},[a("ai-datasets.backend.members.confirmTransferContent"),s("span",{class:"text-red-500"},e.user?.username||e.userId)," ？"]),s("p",{class:"text-red-500"},a("ai-datasets.backend.members.confirmTransferContent2"))]),confirmText:a("ai-datasets.backend.members.confirmTransfer"),ui:{content:"!w-sm"}}),await he({datasetId:v.value||"",newOwnerId:e.userId}),f.success(a("ai-datasets.backend.members.confirmTransferSuccess")),i()}catch(t){console.error("转移所有权失败:",t)}};return X(()=>i()),(e,t)=>{const n=pe,k=fe;return Z(),Y("div",we,[u("div",ye,[u("h1",Ae,A(o(a)("ai-datasets.backend.members.title")),1),u("p",Re,A(o(a)("ai-datasets.backend.members.description")),1)]),u("div",$e,[b(o(I),{modelValue:o(d).username,"onUpdate:modelValue":t[0]||(t[0]=r=>o(d).username=r),placeholder:e.$t("ai-datasets.backend.members.searchPlaceholder"),class:"w-80",icon:"i-lucide-search"},null,8,["modelValue","placeholder"]),u("div",Ie,[b(o(w),{items:o(g)?.tableApi?.getAllColumns().filter(r=>r.getCanHide()).map(r=>({label:o(m)[r.id]||r.columnDef.header,type:"checkbox",checked:r.getIsVisible(),onUpdateChecked(c){o(g)?.tableApi?.getColumn(r.id)?.toggleVisibility(!!c)},onSelect(c){c?.preventDefault()}})),content:{align:"end"}},{default:ee(()=>[b(o(p),{label:e.$t("console-common.showColumns"),color:"neutral",variant:"outline","trailing-icon":"i-lucide-chevron-down"},null,8,["label"])]),_:1},8,["items"]),b(o(p),{label:e.$t("ai-datasets.backend.members.addMember"),disabled:!("useUserStore"in e?e.useUserStore:o(se))().userInfo?.isRoot&&o(y)?.role!=="owner"&&o(y)?.role!=="manager","leading-icon":"i-lucide-plus",color:"primary",onClick:z},null,8,["label","disabled"])])]),b(n,{loading:o(l).loading,data:o(l).items,columns:O,class:"shrink-0",ref_key:"table",ref:g,selectable:"",ui:{base:"table-fixed border-separate border-spacing-0",thead:"[&>tr]:bg-elevated/50 [&>tr]:after:content-none",tbody:"[&>tr]:last:[&>td]:border-b-0",th:"py-2 first:rounded-l-lg last:rounded-r-lg border-y border-default first:border-l last:border-r",td:"border-b border-default",tr:"hover:bg-elevated/50"}},null,8,["loading","data"]),u("div",Ue,[b(k,{page:o(l).page,"onUpdate:page":t[1]||(t[1]=r=>o(l).page=r),size:o(l).pageSize,"onUpdate:size":t[2]||(t[2]=r=>o(l).pageSize=r),total:o(l).total,onChange:o(i)},null,8,["page","size","total","onChange"])])])}}});export{ca as default};
