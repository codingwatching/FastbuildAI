import B from"./cd55qm53.js";import{_ as C}from"./D_3bTjYR.js";import{_ as R}from"./DesRvLqb.js";import D from"./4jjeIyfe.js";import{_ as H}from"./BSO3uWJk.js";import{_ as j}from"./DFk6Fzd0.js";import{d as A,i as M,at as W,s as G,a2 as K,aN as L,f as _,o as y,w as l,t as i,x as m,g as e,z as d,K as P,_ as Z,A as k}from"#entry";import{_ as O}from"./DD8ySyt7.js";import{_ as X}from"./8WqOM-18.js";import{E as c}from"./C_Nw1JQK.js";import{e as J,b as Q,c as Y}from"./itKTsrtZ.js";import{c as ee,b as v}from"./FTderXKt.js";import"./D9sX2Qi6.js";import"./9Q2Y_nd6.js";import"./td2xDKru.js";import"./RPflLnqr.js";import"./TrJvDfxI.js";import"./jsPNKUA0.js";import"./abPSHzII.js";import"./CtosDvS0.js";import"./CAQVAH0V.js";import"./BCcN9pii.js";import"./CMKSl-Ng.js";import"./Deu6qIfg.js";import"./DBEJUH-Z.js";import"./CuVAPZQ8.js";import"./DwmTM9vS.js";import"./uJeysGHZ.js";import"./BEGiluhg.js";import"./OUYfsp1i.js";import"./BFo3vNrE.js";import"./Z7qkLoXK.js";import"./CjE5iPSn.js";import"./a4x2414q.js";import"./MCK2d4XT.js";import"./EK7Wbu3-.js";import"./DaWZu8wl.js";const oe={class:"text-xs"},te={class:"text-xs"},se={class:"text-xs"},ne={class:"text-xs"},le={class:"flex items-center gap-2"},ae={class:"text-xs"},ie={class:"flex justify-end gap-4 pt-8"},Ke=A({__name:"add-extension",props:{isEdit:{type:Boolean,default:!1},id:{default:null},initialData:{default:()=>({})}},emits:["close"],setup(V,{emit:$}){const b=$,r=V,{t}=M(),u=W(),x=G(!1),s=K({name:"",icon:"",packName:"",description:"",version:"",type:1,supportTerminal:[],author:{avatar:"",name:"",homepage:""},...r.initialData}),h=ee({name:v().required(t("extensions.develop.form.nameRequired")),packName:v().required(t("extensions.develop.form.keyRequired")).matches(/^[a-zA-Z][a-zA-Z0-9_-]*$/,t("extensions.develop.form.keyFormat")),description:v().required(t("extensions.develop.form.descriptionRequired")),version:v().required(t("extensions.develop.form.versionRequired")).matches(/^\d+\.\d+\.\d+$/,t("extensions.develop.form.versionFormat"))}),E=()=>{Object.keys(s).forEach(a=>{const o=a;typeof s[o]=="string"&&(s[o]="")}),s.type=1,s.supportTerminal=[c.WEB],u.info(t("extensions.develop.messages.formReset"))},N=P(async a=>{if(!a)return x.value=!1,!0;try{const{exists:o}=await J(a,r.isEdit?r.id?.toString():void 0);return o?(u.error(t("extensions.develop.form.keyExists")),x.value=t("extensions.develop.form.keyExists"),!1):(x.value=!1,!0)}catch(o){return console.error("Failed to check identifier uniqueness:",o),u.error(t("extensions.develop.messages.checkIdentifierError")),!1}},500),{isLock:w,lockFn:T}=L(async()=>{try{const a={name:s.name,identifier:s.packName,description:s.description,version:s.version,icon:s.icon,author:s.author||{avatar:"",name:"",homepage:""},type:s.type,status:1,supportTerminal:s.supportTerminal.map(o=>Number(o))};return r.isEdit&&r.id?(await Q(r.id.toString(),a),u.success(t("extensions.develop.messages.updateSuccess"))):(await Y(a),u.success(t("extensions.develop.messages.createSuccess"))),b("close",!0),!0}catch(a){return console.error("Failed to submit form:",a),u.error(t("extensions.develop.messages.submitError")),!1}});return(a,o)=>{const f=B,p=C,U=R,q=D,I=H,S=j,g=Z,z=O,F=X;return y(),_(F,{title:a.$t("extensions.modal.addExtension"),description:a.$t("extensions.modal.addExtensionDescription"),ui:{content:"max-w-xl"},onClose:o[11]||(o[11]=n=>b("close",!1))},{default:l(()=>[i(z,{ref:"formRef",state:e(s),schema:e(h),class:"w-full space-y-2",onSubmit:e(T)},{default:l(()=>[i(p,{label:e(t)("extensions.develop.form.name"),required:"",name:"name"},{default:l(()=>[i(f,{modelValue:e(s).name,"onUpdate:modelValue":o[0]||(o[0]=n=>e(s).name=n),placeholder:e(t)("extensions.develop.form.nameInput"),size:"lg",ui:{root:"w-full"}},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),i(p,{label:e(t)("extensions.develop.form.icon"),required:"",name:"icon"},{help:l(()=>[m("span",oe,d(e(t)("extensions.develop.form.iconRecommendation")),1)]),default:l(()=>[i(U,{modelValue:e(s).icon,"onUpdate:modelValue":o[1]||(o[1]=n=>e(s).icon=n),class:"size-20",text:e(t)("extensions.develop.form.addIcon"),icon:"i-lucide-upload",accept:".jpg,.png,.jpeg,.gif",maxCount:1,single:!0},null,8,["modelValue","text"])]),_:1},8,["label"]),i(p,{label:e(t)("extensions.develop.form.packName"),required:"",name:"packName",error:e(x)},{help:l(()=>[m("span",te,d(e(t)("extensions.develop.form.packNameHelp")),1)]),default:l(()=>[r.isEdit?(y(),_(f,{key:0,modelValue:e(s).packName,"onUpdate:modelValue":o[2]||(o[2]=n=>e(s).packName=n),placeholder:e(t)("extensions.develop.form.packNameInput"),size:"lg",disabled:r.isEdit,ui:{root:"w-full"}},null,8,["modelValue","placeholder","disabled"])):(y(),_(f,{key:1,modelValue:e(s).packName,"onUpdate:modelValue":[o[3]||(o[3]=n=>e(s).packName=n),o[4]||(o[4]=n=>e(N)(e(s).packName))],placeholder:e(t)("extensions.develop.form.packNameInput"),size:"lg",disabled:r.isEdit,ui:{root:"w-full",base:"pl-22"}},{leading:l(()=>[...o[12]||(o[12]=[m("span",{class:"text-muted-foreground pl-1 text-sm"}," buildingai- ",-1)])]),_:1},8,["modelValue","placeholder","disabled"]))]),_:1},8,["label","error"]),i(p,{label:e(t)("extensions.develop.form.description"),required:"",name:"description"},{default:l(()=>[i(q,{modelValue:e(s).description,"onUpdate:modelValue":o[5]||(o[5]=n=>e(s).description=n),placeholder:e(t)("extensions.develop.form.descriptionInput"),size:"lg",rows:2,ui:{root:"w-full"}},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),i(p,{label:e(t)("extensions.develop.form.type"),required:"",name:"type"},{help:l(()=>[m("span",se,d(e(t)("extensions.develop.form.typeHelp")),1)]),default:l(()=>[i(I,{modelValue:e(s).type,"onUpdate:modelValue":o[6]||(o[6]=n=>e(s).type=n),items:[{label:a.$t("extensions.modal.extensionTypes.application"),value:1},{label:a.$t("extensions.modal.extensionTypes.function"),value:2}],ui:{fieldset:"flex flex-row gap-2"}},null,8,["modelValue","items"])]),_:1},8,["label"]),i(p,{label:e(t)("extensions.develop.form.supportTerminal"),required:"",name:"supportTerminal"},{help:l(()=>[m("span",ne,d(e(t)("extensions.develop.form.supportTerminalHelp")),1)]),default:l(()=>[i(S,{modelValue:e(s).supportTerminal,"onUpdate:modelValue":o[7]||(o[7]=n=>e(s).supportTerminal=n),items:[{label:a.$t("extensions.modal.terminalTypes.web"),value:e(c).WEB.toString()},{label:a.$t("extensions.modal.terminalTypes.weixin"),value:e(c).WEIXIN.toString(),disabled:!0},{label:a.$t("extensions.modal.terminalTypes.h5"),value:e(c).H5.toString(),disabled:!0},{label:a.$t("extensions.modal.terminalTypes.mp"),value:e(c).MP.toString(),disabled:!0},{label:a.$t("extensions.modal.terminalTypes.api"),value:e(c).API.toString()}],ui:{fieldset:"flex flex-row gap-2"}},null,8,["modelValue","items"])]),_:1},8,["label"]),i(p,{label:e(t)("extensions.develop.form.version"),required:"",name:"version"},{help:l(()=>[m("span",ae,d(e(t)("extensions.develop.form.versionHelp")),1)]),default:l(()=>[m("div",le,[i(f,{modelValue:e(s).version,"onUpdate:modelValue":o[8]||(o[8]=n=>e(s).version=n),placeholder:"0",length:"3",ui:{root:"w-full",base:"pl-18"}},{leading:l(()=>[...o[13]||(o[13]=[m("span",{class:"text-muted-foreground pl-1 text-sm"}," Version ",-1)])]),_:1},8,["modelValue"])])]),_:1},8,["label"]),i(p,{label:e(t)("extensions.develop.form.authorName"),name:"author.name"},{default:l(()=>[i(f,{modelValue:e(s).author.name,"onUpdate:modelValue":o[9]||(o[9]=n=>e(s).author.name=n),placeholder:e(t)("extensions.develop.form.authorNameInput"),size:"lg",ui:{root:"w-full"}},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),m("div",ie,[i(g,{color:"neutral",variant:"outline",size:"lg",onClick:o[10]||(o[10]=n=>b("close",!1))},{default:l(()=>[k(d(e(t)("console-common.cancel")),1)]),_:1}),i(g,{color:"neutral",size:"lg",onClick:E},{default:l(()=>[k(d(e(t)("console-common.reset")),1)]),_:1}),i(g,{color:"primary",size:"lg",loading:e(w),type:"submit"},{default:l(()=>[k(d(r.isEdit?e(t)("console-common.update"):e(t)("console-common.create")),1)]),_:1},8,["loading"])])]),_:1},8,["state","schema","onSubmit"])]),_:1},8,["title","description"])}}});export{Ke as default};
