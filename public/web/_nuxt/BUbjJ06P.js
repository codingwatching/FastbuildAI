import B from"./AwTBxaf_.js";import{_ as C}from"./AkfmfxUv.js";import{_ as R}from"./CvQTAktg.js";import D from"./BoUSUkpo.js";import{_ as H}from"./CNWUrYsy.js";import{_ as j}from"./BKvD-c7Q.js";import{d as A,b as M,ap as W,s as G,au as L,aJ as P,j as g,o as y,k as a,l,q as m,p as e,v as d,H as Z,_ as J,x as k}from"#entry";import{_ as K}from"./DP8wpnmM.js";import{_ as O}from"./BtIvDPex.js";import{E as c}from"./XBYuZpdu.js";import{a as X,b as Q,c as Y}from"./BvGrPIC1.js";import{c as ee,a as x}from"./BUyfW8JT.js";import"./BgHJjJs-.js";import"./BdImEx5p.js";import"./oFTPHjuc.js";import"./BcsO9TDZ.js";import"./DlAUqK2U.js";import"./DHFmmngs.js";import"./CR1AS2Ry.js";import"./CuOaO1Pb.js";import"./D6yWePie.js";import"./BHhI-3jl.js";import"./DVnbt8cp.js";import"./DuSMYVIA.js";import"./g_UzmQET.js";import"./CgMDXot0.js";import"./CgvJPw28.js";import"./PUaae8Vl.js";import"./B2mx0Z2E.js";import"./MN31c9CG.js";import"./fQGamG-_.js";import"./CH6zLhsh.js";import"./Cb04SOqd.js";import"./VGKgjfSv.js";import"./DaWZu8wl.js";const oe={class:"text-xs"},te={class:"text-xs"},se={class:"text-xs"},ne={class:"text-xs"},ae={class:"flex items-center gap-2"},le={class:"text-xs"},ie={class:"flex justify-end gap-4 pt-8"},We=A({__name:"add-extension",props:{isEdit:{type:Boolean,default:!1},id:{default:null},initialData:{default:()=>({})}},emits:["close"],setup(V,{emit:$}){const v=$,r=V,{t}=M(),u=W(),b=G(!1),s=L({name:"",icon:"",packName:"",description:"",version:"",type:1,supportTerminal:[],author:{avatar:"",name:"",homepage:""},...r.initialData}),h=ee({name:x().required(t("extensions.develop.form.nameRequired")),packName:x().required(t("extensions.develop.form.keyRequired")).matches(/^[a-zA-Z][a-zA-Z0-9_-]*$/,t("extensions.develop.form.keyFormat")),description:x().required(t("extensions.develop.form.descriptionRequired")),version:x().required(t("extensions.develop.form.versionRequired")).matches(/^\d+\.\d+\.\d+$/,t("extensions.develop.form.versionFormat"))}),E=()=>{Object.keys(s).forEach(i=>{const o=i;typeof s[o]=="string"&&(s[o]="")}),s.type=1,s.supportTerminal=[c.WEB],u.info(t("extensions.develop.messages.formReset"))},N=Z(async i=>{try{const{exists:o}=await X(i,r.isEdit?r.id?.toString():void 0);return o?(u.error(t("extensions.develop.form.keyExists")),b.value=t("extensions.develop.form.keyExists"),!1):(b.value=!1,!0)}catch(o){return console.error("Failed to check identifier uniqueness:",o),u.error(t("extensions.develop.messages.checkIdentifierError")),!1}},500),{isLock:T,lockFn:U}=P(async()=>{try{const i={name:s.name,identifier:s.packName,description:s.description,version:s.version,icon:s.icon,author:s.author||{avatar:"",name:"",homepage:""},type:s.type,status:1,supportTerminal:s.supportTerminal.map(o=>Number(o))};return r.isEdit&&r.id?(await Q(r.id.toString(),i),u.success(t("extensions.develop.messages.updateSuccess"))):(await Y(i),u.success(t("extensions.develop.messages.createSuccess"))),v("close",!0),!0}catch(i){return console.error("Failed to submit form:",i),u.error(t("extensions.develop.messages.submitError")),!1}});return(i,o)=>{const f=B,p=C,q=R,w=D,I=H,S=j,_=J,F=K,z=O;return y(),g(z,{title:i.$t("extensions.modal.addExtension"),description:i.$t("extensions.modal.addExtensionDescription"),ui:{content:"max-w-xl"},onClose:o[11]||(o[11]=n=>v("close",!1))},{default:a(()=>[l(F,{ref:"formRef",state:e(s),schema:e(h),class:"w-full space-y-2",onSubmit:e(U)},{default:a(()=>[l(p,{label:e(t)("extensions.develop.form.name"),required:"",name:"name"},{default:a(()=>[l(f,{modelValue:e(s).name,"onUpdate:modelValue":o[0]||(o[0]=n=>e(s).name=n),placeholder:e(t)("extensions.develop.form.nameInput"),size:"lg",ui:{root:"w-full"}},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(p,{label:e(t)("extensions.develop.form.icon"),required:"",name:"icon"},{help:a(()=>[m("span",oe,d(e(t)("extensions.develop.form.iconRecommendation")),1)]),default:a(()=>[l(q,{modelValue:e(s).icon,"onUpdate:modelValue":o[1]||(o[1]=n=>e(s).icon=n),class:"size-20",text:e(t)("extensions.develop.form.addIcon"),icon:"i-lucide-upload",accept:".jpg,.png,.jpeg,.gif",maxCount:1,single:!0},null,8,["modelValue","text"])]),_:1},8,["label"]),l(p,{label:e(t)("extensions.develop.form.packName"),required:"",name:"packName",error:e(b)},{help:a(()=>[m("span",te,d(e(t)("extensions.develop.form.packNameHelp")),1)]),default:a(()=>[r.isEdit?(y(),g(f,{key:0,modelValue:e(s).packName,"onUpdate:modelValue":o[2]||(o[2]=n=>e(s).packName=n),placeholder:e(t)("extensions.develop.form.packNameInput"),size:"lg",disabled:r.isEdit,ui:{root:"w-full"}},null,8,["modelValue","placeholder","disabled"])):(y(),g(f,{key:1,modelValue:e(s).packName,"onUpdate:modelValue":[o[3]||(o[3]=n=>e(s).packName=n),o[4]||(o[4]=n=>e(N)(e(s).packName))],placeholder:e(t)("extensions.develop.form.packNameInput"),size:"lg",disabled:r.isEdit,ui:{root:"w-full",base:"pl-22"}},{leading:a(()=>[...o[12]||(o[12]=[m("span",{class:"text-muted-foreground pl-1 text-sm"}," buildingai- ",-1)])]),_:1},8,["modelValue","placeholder","disabled"]))]),_:1},8,["label","error"]),l(p,{label:e(t)("extensions.develop.form.description"),required:"",name:"description"},{default:a(()=>[l(w,{modelValue:e(s).description,"onUpdate:modelValue":o[5]||(o[5]=n=>e(s).description=n),placeholder:e(t)("extensions.develop.form.descriptionInput"),size:"lg",rows:2,ui:{root:"w-full"}},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(p,{label:e(t)("extensions.develop.form.type"),required:"",name:"type"},{help:a(()=>[m("span",se,d(e(t)("extensions.develop.form.typeHelp")),1)]),default:a(()=>[l(I,{modelValue:e(s).type,"onUpdate:modelValue":o[6]||(o[6]=n=>e(s).type=n),items:[{label:i.$t("extensions.modal.extensionTypes.application"),value:1},{label:i.$t("extensions.modal.extensionTypes.function"),value:2}],ui:{fieldset:"flex flex-row gap-2"}},null,8,["modelValue","items"])]),_:1},8,["label"]),l(p,{label:e(t)("extensions.develop.form.supportTerminal"),required:"",name:"supportTerminal"},{help:a(()=>[m("span",ne,d(e(t)("extensions.develop.form.supportTerminalHelp")),1)]),default:a(()=>[l(S,{modelValue:e(s).supportTerminal,"onUpdate:modelValue":o[7]||(o[7]=n=>e(s).supportTerminal=n),items:[{label:i.$t("extensions.modal.terminalTypes.web"),value:e(c).WEB.toString()},{label:i.$t("extensions.modal.terminalTypes.weixin"),value:e(c).WEIXIN.toString(),disabled:!0},{label:i.$t("extensions.modal.terminalTypes.h5"),value:e(c).H5.toString(),disabled:!0},{label:i.$t("extensions.modal.terminalTypes.mp"),value:e(c).MP.toString(),disabled:!0},{label:i.$t("extensions.modal.terminalTypes.api"),value:e(c).API.toString()}],ui:{fieldset:"flex flex-row gap-2"}},null,8,["modelValue","items"])]),_:1},8,["label"]),l(p,{label:e(t)("extensions.develop.form.version"),required:"",name:"version"},{help:a(()=>[m("span",le,d(e(t)("extensions.develop.form.versionHelp")),1)]),default:a(()=>[m("div",ae,[l(f,{modelValue:e(s).version,"onUpdate:modelValue":o[8]||(o[8]=n=>e(s).version=n),placeholder:"0",length:"3",ui:{root:"w-full",base:"pl-18"}},{leading:a(()=>[...o[13]||(o[13]=[m("span",{class:"text-muted-foreground pl-1 text-sm"}," Version ",-1)])]),_:1},8,["modelValue"])])]),_:1},8,["label"]),l(p,{label:e(t)("extensions.develop.form.authorName"),name:"author.name"},{default:a(()=>[l(f,{modelValue:e(s).author.name,"onUpdate:modelValue":o[9]||(o[9]=n=>e(s).author.name=n),placeholder:e(t)("extensions.develop.form.authorNameInput"),size:"lg",ui:{root:"w-full"}},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),m("div",ie,[l(_,{color:"neutral",variant:"outline",size:"lg",onClick:o[10]||(o[10]=n=>v("close",!1))},{default:a(()=>[k(d(e(t)("console-common.cancel")),1)]),_:1}),l(_,{color:"neutral",size:"lg",onClick:E},{default:a(()=>[k(d(e(t)("console-common.reset")),1)]),_:1}),l(_,{color:"primary",size:"lg",loading:e(T),type:"submit"},{default:a(()=>[k(d(r.isEdit?e(t)("console-common.update"):e(t)("console-common.create")),1)]),_:1},8,["loading"])])]),_:1},8,["state","schema","onSubmit"])]),_:1},8,["title","description"])}}});export{We as default};
