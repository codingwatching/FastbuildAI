import{d as L,e as S,ap as N,ar as R,s as T,i as E,aK as w,j as G,k as p,o as s,l,c as f,q as o,m as i,z as K,t as m,v as b,C as H,A as C,aq as J,x as g,F as O,y as h,_ as Q,aL as W}from"#entry";import{_ as X}from"./Brlt-NDg.js";import{_ as Y}from"./ilPiIi3f.js";import Z from"./CDSfhndf.js";import ee from"./BjYsydzc.js";import{_ as ae}from"./Ds48qA85.js";import{_ as te}from"./BYm23QKU.js";import{g as oe,a as ne,l as re}from"./ChM0pAjz.js";import{c as ie,a as M}from"./BUyfW8JT.js";import{u as se}from"./DW_vtyFa.js";import{u as le}from"./Dx01Lm3C.js";import"./DoL5-2Ox.js";import"./CjOovgR0.js";import"./DXP7Kkdt.js";import"./BRI4D6WA.js";import"./DlAUqK2U.js";import"./DGUAW_1C.js";import"./DDJ79SjH.js";import"./Ti3HjCpC.js";import"./DegKy-XA.js";import"./B1TeSxwV.js";import"./RmzZBBRE.js";import"./C4jlvBh2.js";import"./C-XPfH0G.js";import"./7d3iyZ8h.js";import"./DaWZu8wl.js";const ce={key:0,class:"flex items-center justify-center",style:{height:"420px"}},de={class:"flex flex-col gap-4"},me={class:"grid grid-cols-3 gap-4"},ue=["onClick"],pe={key:0,class:"bg-primary absolute -top-1 -right-1 flex h-6 w-6 items-center justify-center rounded-full text-white"},fe={class:"mb-2 flex justify-center"},ge={class:"text-foreground font-medium"},ve={class:"mt-6 flex justify-end gap-2"},Ge=L({__name:"agent-modal",props:{id:{}},emits:["close"],setup(V,{emit:U}){const r=V,v=U,{t:d}=S(),y=N(),x=R(),e=T({name:"",description:"",avatar:"",createMode:"direct",thirdPartyIntegration:{}}),k=E(()=>{const a=[{value:"direct",label:d("ai-agent.backend.create.modes.direct"),icon:"i-lucide-zap"}],n=se("agent:create:modes").value.map(c=>({value:c.meta?.value,label:d(c.meta?.label),icon:c.meta?.icon}));return[...a,...n]}),j=ie({name:M().required(d("ai-agent.backend.create.namePlaceholder")),description:M().required(d("ai-agent.backend.create.descriptionPlaceholder"))}),{lockFn:F,isLock:P}=w(async()=>{try{const{createdAt:a,userCount:n,updatedAt:c,id:u,..._}=await oe(r.id);e.value=_}catch(a){console.error("获取智能体详情失败:",a)}}),{lockFn:A,isLock:D}=w(async()=>{try{if(r.id)e.value.avatar===void 0&&(e.value.avatar=null),await ne(r.id,{name:e.value.name,description:e.value.description,avatar:e.value.avatar}),W(`agent-detail-${r.id}`),y.success(d("common.message.updateSuccess"));else{const a=await re({name:e.value.name,description:e.value.description,avatar:e.value.avatar,createMode:e.value.createMode,thirdPartyIntegration:e.value.thirdPartyIntegration});x.push(le("ai-agent:detail",{id:a.id})),y.success(d("common.message.createSuccess"))}v("close",!0)}catch(a){console.error(`${r.id?"更新":"创建"}智能体失败:`,a)}});return G(async()=>{r.id&&F()}),(a,n)=>{const c=K,u=X,_=Y,z=Z,B=ee,$=Q,q=ae,I=te;return s(),p(I,{title:r.id?a.$t("ai-agent.backend.create.editTitle"):a.$t("ai-agent.backend.create.title"),description:r.id?a.$t("ai-agent.backend.create.editDesc"):a.$t("ai-agent.backend.create.desc"),ui:{content:"max-w-lg"},onClose:n[4]||(n[4]=t=>v("close",!1))},{default:l(()=>[o(P)?(s(),f("div",ce,[i(c,{name:"i-lucide-loader-2",class:"size-8 animate-spin"})])):(s(),p(q,{key:1,schema:o(j),state:o(e),class:"space-y-4",onSubmit:o(A)},{default:l(()=>[m("div",de,[!r.id&&o(k).length!=1?(s(),p(u,{key:0,label:a.$t("ai-agent.backend.create.mode"),name:"createMode"},{default:l(()=>[m("div",me,[(s(!0),f(O,null,H(o(k),t=>(s(),f("div",{key:t.value,class:C(["group hover:border-primary/50 relative cursor-pointer rounded-lg border-2 px-4 py-3 text-center transition-colors",{"border-primary bg-primary/5":o(e).createMode===t.value,"border-gray-200 bg-white":o(e).createMode!==t.value}]),onClick:_e=>o(e).createMode=t.value},[o(e).createMode===t.value?(s(),f("div",pe,[i(c,{name:"i-lucide-check",class:"h-3 w-3"})])):b("",!0),m("div",fe,[m("div",{class:C(["flex h-12 w-12 items-center justify-center overflow-hidden rounded-lg",{"bg-primary text-white":o(e).createMode===t.value,"bg-gray-100 text-gray-600":o(e).createMode!==t.value}])},[t.icon&&typeof t.icon=="string"&&!t.icon.includes(".")?(s(),p(c,{key:0,name:t.icon,class:"h-6 w-6"},null,8,["name"])):t.icon?(s(),p(J(t.icon),{key:1,src:t.icon,alt:t.label,filled:"",fontControlled:!1,class:"size-8 object-contain"},null,8,["src","alt"])):b("",!0)],2)]),m("div",ge,g(t.label),1)],10,ue))),128))])]),_:1},8,["label"])):b("",!0),i(u,{label:a.$t("ai-agent.backend.create.avatar"),name:"avatar"},{hint:l(()=>[h(g(a.$t("ai-agent.backend.create.avatarDefault")),1)]),default:l(()=>[i(_,{modelValue:o(e).avatar,"onUpdate:modelValue":n[0]||(n[0]=t=>o(e).avatar=t),class:"h-24 w-24",text:a.$t("ai-agent.backend.create.avatarUpload"),icon:"i-lucide-upload",accept:".jpg,.png,.jpeg,.gif,.webp",maxCount:1,single:!0,multiple:!1},null,8,["modelValue","text"])]),_:1},8,["label"]),i(u,{label:a.$t("ai-agent.backend.create.name"),name:"name",required:""},{default:l(()=>[i(z,{modelValue:o(e).name,"onUpdate:modelValue":n[1]||(n[1]=t=>o(e).name=t),placeholder:a.$t("ai-agent.backend.create.namePlaceholder"),ui:{root:"w-full"}},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),i(u,{label:a.$t("ai-agent.backend.create.description"),name:"description",required:""},{default:l(()=>[i(B,{modelValue:o(e).description,"onUpdate:modelValue":n[2]||(n[2]=t=>o(e).description=t),placeholder:a.$t("ai-agent.backend.create.descriptionPlaceholder"),rows:6,ui:{root:"w-full"}},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),m("div",ve,[i($,{color:"neutral",variant:"soft",size:"lg",onClick:n[3]||(n[3]=t=>v("close",!1))},{default:l(()=>[h(g(a.$t("console-common.cancel")),1)]),_:1}),i($,{color:"primary",size:"lg",loading:o(D),type:"submit"},{default:l(()=>[h(g(r.id?a.$t("console-common.update"):a.$t("console-common.create")),1)]),_:1},8,["loading"])])]),_:1},8,["schema","state","onSubmit"]))]),_:1},8,["title","description"])}}});export{Ge as default};
