const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./B5k8dCfX.js","./C4ofdRUp.js","./cd55qm53.js","./D_3bTjYR.js","./D9sX2Qi6.js","./DNb4RPhn.js","./CtosDvS0.js","./CuVAPZQ8.js","./BCcN9pii.js","./CMKSl-Ng.js","./DBEJUH-Z.js","./o4ws_w_T.js","./D19QCKnC.js","./LSmoYDCw.js","./B3XNqw4u.js","./zlMhJk0P.js","./BhB8DUPm.js","./BVraOlsu.js","./BxwUS5gW.js","./MCK2d4XT.js","./EK7Wbu3-.js","./CwhGvpQ4.js","./B_IAV05G.js","./CAQVAH0V.js","./Deu6qIfg.js","./BtLy_Oaq.js","./FTderXKt.js","./DaWZu8wl.js"])))=>i.map(i=>d[i]);
import{d as ne,aP as me,l as ce,s as X,k as fe,n as z,p as W,q as re,c as A,o as _,C as S,t as n,g as e,D as U,w as m,x as u,f as N,y as q,v as Z,B as pe,_ as ie,A as C,z as v,J as be,i as ve,at as he,V as ge,aQ as ke,aN as we,az as ye,cj as _e,W as ee,X as ae}from"#entry";import{_ as xe}from"./DUJH4dqr.js";import{_ as Ve}from"./bvMLy1sv.js";import de from"./cd55qm53.js";import{_ as $e}from"./D_3bTjYR.js";import{_ as Ce}from"./BpHgfaGD.js";import{_ as ze}from"./shdu-Ndv.js";import{_ as Ue}from"./Iv8N83fp.js";import{_ as ue}from"./CBP5wIdr.js";import{f as Te,p as B,_ as De,a as Ee,b as Re,m as Fe}from"./DvKR6pUC.js";import{_ as Ie}from"./Be9qZ8Md.js";import{a as le,e as Pe,$ as Se}from"./BKdtdX-7.js";import{_ as Be}from"./BtLy_Oaq.js";import{g as Ne,P as oe,v as Ae}from"./C_EXknkZ.js";import{e as te,b as T,c as se}from"./FTderXKt.js";import"./DWy_CFG9.js";import"./td2xDKru.js";import"./RPflLnqr.js";import"./TrJvDfxI.js";import"./jsPNKUA0.js";import"./Bzv9SrOl.js";import"./D9sX2Qi6.js";import"./CAQVAH0V.js";import"./Deu6qIfg.js";import"./2uNW2Gs5.js";import"./DxD6Ynfo.js";import"./CuVAPZQ8.js";import"./zlMhJk0P.js";import"./CZX-O16F.js";import"./CtosDvS0.js";import"./kRIii9yh.js";import"./D4e4FYoF.js";import"./CMKSl-Ng.js";import"./BhB8DUPm.js";import"./DeCyaT7k.js";import"./BstbYvQo.js";import"./BkF8DltG.js";import"./MCK2d4XT.js";import"./EK7Wbu3-.js";import"./C6Y-ieo6.js";import"./BCcN9pii.js";import"./psimjGaX.js";import"./DaWZu8wl.js";const qe={class:"mb-2 flex items-center justify-between"},Me={class:"flex items-center space-x-2"},je={class:"flex items-center space-x-1"},Le={key:0,class:"b mt-2 pt-2"},Oe={class:"b mt-2 flex justify-between gap-2 pt-2"},He={class:"flex gap-2"},Ye=ne({__name:"index",props:{modelValue:{default:""},dateStyle:{default:"medium"},timeStyle:{default:"medium"},disabled:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1},clearable:{type:Boolean,default:!0},size:{default:"md"},showTime:{type:Boolean,default:!1},timeFormat:{default:"HH:mm:ss"},defaultTime:{default:""},icon:{default:"i-lucide-calendar"},placement:{default:"bottom"},variant:{},color:{},ui:{}},emits:["update:modelValue","confirm","cancel","focus","blur","clear","open","close","change"],setup(d,{emit:M}){const{$i18n:j}=me(),{t:p,locale:b}=j,c=d,a=M,h=ce(!1),i=X(null),g=X(null),k=fe("timePickerRef"),o=z(()=>i.value?i.value:new le(new Date().getFullYear(),new Date().getMonth()+1,new Date().getDate())),P=[{value:1,label:p("common.month.january")},{value:2,label:p("common.month.february")},{value:3,label:p("common.month.march")},{value:4,label:p("common.month.april")},{value:5,label:p("common.month.may")},{value:6,label:p("common.month.june")},{value:7,label:p("common.month.july")},{value:8,label:p("common.month.august")},{value:9,label:p("common.month.september")},{value:10,label:p("common.month.october")},{value:11,label:p("common.month.november")},{value:12,label:p("common.month.december")}],D=z({get:()=>o.value.month,set:l=>{i.value?i.value=i.value.set({month:l}):i.value=o.value.set({month:l})}}),E=z({get:()=>o.value.year,set:l=>{i.value?i.value=i.value.set({year:l}):i.value=o.value.set({year:l})}}),L=z(()=>{const l=new Date().getFullYear(),r=[];for(let w=l-100;w<=l+10;w++)r.push({value:w,label:`${w} year`});return r}),x=z(()=>Te(c.modelValue,b.value,c.dateStyle,c.timeStyle,c.showTime)),R=()=>{if(i.value=Re(c.modelValue),c.showTime){if(c.modelValue){const l=B(c.modelValue),r=new Pe("zh-CN",{dateStyle:void 0,timeStyle:c.timeStyle});g.value=r.format(l)}else if(c.defaultTime){const l=B(c.defaultTime);l&&(g.value=l,k.value&&k.value.setTime(l))}}},O=l=>{l?(a("open"),be(()=>{R()})):a("close")},H=l=>{!c.disabled&&!c.readonly&&a("focus",l)},Y=l=>{a("blur",l)},G=l=>{l.stopPropagation(),i.value=null,g.value=null,a("update:modelValue",null),a("clear"),a("change",null),h.value=!1},f=()=>{h.value=!1;let l=g.value;c.showTime&&!l&&c.defaultTime&&(l=B(c.defaultTime));const r=Fe(i?.value?.toDate(Se()),l);a("update:modelValue",r),a("confirm",r),a("change",r)},t=()=>{h.value=!1,a("cancel"),a("change",null)},V=()=>{i.value?i.value=i.value.subtract({months:1}):i.value=o.value.subtract({months:1})},F=()=>{i.value?i.value=i.value.add({months:1}):i.value=o.value.add({months:1})},$=()=>{const l=new Date;i.value=new le(l.getFullYear(),l.getMonth()+1,l.getDate()),c.showTime&&(g.value=new Date(l),k.value&&k.value.setTime(l)),f()};return W(()=>c.modelValue,async l=>{l&&R()}),W(()=>i.value,()=>{if(c.showTime&&i.value&&!g.value&&c.defaultTime){const l=B(c.defaultTime);l&&(g.value=l,k.value&&k.value.setTime(l))}}),W(()=>h.value,l=>{O(l)},{immediate:!1}),re(R),(l,r)=>{const w=pe,y=ie,K=de,I=ue,J=De,Q=Ie;return _(),A("div",{class:S(["bd-date-picker relative inline-flex w-full",[d.size,{"cursor-not-allowed opacity-60":d.disabled}]])},[n(Q,{open:e(h),"onUpdate:open":r[6]||(r[6]=s=>U(h)?h.value=s:null),disabled:d.disabled||d.readonly,placement:d.placement,popper:{placement:d.placement,strategy:"fixed"},ui:{content:"w-auto"},"prevent-close":!0},{content:m(()=>[u("div",{class:"bd-date-picker-panel bg-default w-[320px] p-4",onClick:r[5]||(r[5]=Z(()=>{},["stop"]))},[u("div",qe,[u("div",Me,[n(I,{modelValue:e(E),"onUpdate:modelValue":r[1]||(r[1]=s=>U(E)?E.value=s:null),items:e(L),"option-attribute":"value",ui:{base:"min-w-[100px] py-1"},size:"sm"},null,8,["modelValue","items"]),n(I,{modelValue:e(D),"onUpdate:modelValue":r[2]||(r[2]=s=>U(D)?D.value=s:null),items:P,"option-attribute":"value",ui:{base:"min-w-[100px] py-1"},size:"sm"},null,8,["modelValue"])]),u("div",je,[n(y,{icon:"i-lucide-chevron-left",variant:"ghost",color:"neutral",size:"sm",padded:!1,onClick:V}),n(y,{icon:"i-lucide-chevron-right",variant:"ghost",color:"neutral",size:"sm",padded:!1,onClick:F})])]),n(J,{modelValue:e(i),"onUpdate:modelValue":r[3]||(r[3]=s=>U(i)?i.value=s:null),"month-controls":!1,"year-controls":!1,color:"primary",size:"sm"},null,8,["modelValue"]),d.showTime?(_(),A("div",Le,[n(Ee,{ref_key:"timePickerRef",ref:k,modelValue:e(g),"onUpdate:modelValue":r[4]||(r[4]=s=>U(g)?g.value=s:null),format:d.timeFormat,disabled:d.disabled,readonly:d.readonly,clearable:!1,size:"sm",ui:{root:"w-full"}},null,8,["modelValue","format","disabled","readonly"])])):q("",!0),u("div",Oe,[u("div",null,[n(y,{size:"sm",variant:"soft",onClick:$},{default:m(()=>[C(v(e(p)("common.now")),1)]),_:1})]),u("div",He,[n(y,{size:"sm",variant:"ghost",icon:"i-lucide-x",onClick:t}),n(y,{size:"sm",icon:"i-lucide-check",disabled:!e(i)&&!d.disabled,onClick:f},null,8,["disabled"])])])])]),default:m(()=>[u("div",{class:S(["relative w-full",d.ui?.root])},[n(K,{modelValue:e(x),"onUpdate:modelValue":r[0]||(r[0]=s=>U(x)?x.value=s:null),placeholder:e(p)("common.placeholder.dateSelect"),disabled:d.disabled,readonly:!0,size:d.size,color:d.color,variant:d.variant,class:S({"cursor-default":d.readonly}),ui:{...d.ui,root:d.ui?.root||"w-full",base:`${e(h)?"ring-2 ring-inset ring-primary":""} text-left ${d.ui?.base}`},onFocus:H,onBlur:Y},{leading:m(()=>[n(w,{name:d.icon,class:S(e(x)?"text-highlighted":"text-dimmed")},null,8,["name","class"])]),trailing:m(()=>[d.clearable&&e(x)&&!d.disabled&&!d.readonly?(_(),N(y,{key:0,color:"neutral",variant:"ghost",icon:"i-lucide-x",padded:!1,size:"xs",onClick:Z(G,["stop"])})):q("",!0)]),_:1},8,["modelValue","placeholder","disabled","size","color","variant","class","ui"])],2)]),_:1},8,["open","disabled","placement","popper"])],2)}}}),Ge={class:"grid grid-cols-1 gap-8 p-1 lg:grid-cols-3"},Ke={class:"shadow-default h-fit rounded-lg lg:col-span-1"},Je={class:"flex flex-col items-center space-y-4",style:{padding:"80px 24px 40px"}},Qe={class:"border-default relative rounded-full border border-dashed p-2"},We={class:"mt-6 px-12 text-center text-xs"},Xe={class:"text-muted-foreground"},Ze={class:"mt-6 flex w-full items-center justify-between"},ea={class:"text-secondary-foreground text-sm font-medium"},aa={class:"text-muted-foreground mt-2 text-xs"},la={key:0,class:"mt-4 w-full"},oa={class:"shadow-default space-y-6 rounded-lg p-6 lg:col-span-2"},ta={class:"grid grid-cols-1 gap-6 md:grid-cols-2"},sa={class:"text-muted-foreground text-xs"},na={class:"grid grid-cols-1 gap-6 md:grid-cols-2"},ra={class:"grid grid-cols-2 gap-6"},ia={class:"text-muted-foreground text-xs"},da={class:"grid grid-cols-2 gap-6"},ua={class:"flex justify-end gap-4"},el=ne({__name:"user-form",props:{isEdit:{type:Boolean,default:!1},id:{default:null},initialData:{default:()=>({})}},emits:["submit-success","cancel","refresh"],setup(d,{emit:M}){const j=ee(()=>ae(()=>import("./B5k8dCfX.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20]),import.meta.url)),p=ee(()=>ae(()=>import("./CwhGvpQ4.js"),__vite__mapDeps([21,2,1,3,4,22,6,23,8,9,24,10,7,25,12,13,14,15,16,17,18,19,20,26,27]),import.meta.url)),b=d,c=M,{t:a}=ve(),h=he(),i=ge(),{userNo:g,...k}=b.initialData||{},o=ke({username:"",nickname:"",email:"",phone:"",phoneAreaCode:Ne(),avatar:"",password:"",roleId:void 0,status:1,source:0,level:"",levelEndTime:"",...k}),P=X([]),D=z(()=>oe.map(f=>({label:`${f.flag} ${a(f.i18nKey)} +${f.areaCode}`,value:f.areaCode}))),E=z(()=>{const f={username:T().required(a("user.backend.form.usernameRequired")).matches(/^[a-zA-Z0-9_]*$/,a("user.backend.form.usernameFormat")),nickname:T().required(a("user.backend.form.nicknameRequired")),email:T().email(a("user.backend.form.emailFormat")).nullable(),phone:T().test("phone-format",a("user.backend.form.phoneFormat"),function(t){if(!t)return!0;const V=oe.find(F=>F.areaCode===o.phoneAreaCode);return V?Ae(t,V.code):!1}).nullable(),phoneAreaCode:T().matches(/^\d{1,4}$/,a("user.backend.form.areaCodeFormat")).nullable(),status:te().required(a("user.backend.form.statusRequired")),source:te().required(a("user.backend.form.sourceRequired"))};return b.isEdit?se(f):se({...f,password:T().required(a("user.backend.form.passwordRequired")).min(6,a("user.backend.form.passwordMinLength"))})}),L=async()=>{try{const f=await _e();P.value=[{label:a("user.backend.form.noRole"),value:"null"},...f.map(t=>({label:t.name,value:t.id}))]}catch(f){console.error("Get role list failed:",f),h.error(a("user.backend.form.getRoleListFailed"))}},x=()=>{Object.keys(o).forEach(f=>{const t=f;typeof o[t]=="string"?o[t]="":typeof o[t]=="number"&&(o[t]=f==="status"?1:0)}),h.info(a("user.backend.form.formReset"))},R=async()=>{if(!b.id)return;await i.create(p).open({user:{id:b.id,power:o.power}}).result&&c("refresh")},O=async()=>{if(!b.id)return;await i.create(j).open({userid:b.id}).result},H=()=>{O()},{isLock:Y,lockFn:G}=we(async()=>{try{o.roleId==="null"&&(o.roleId=void 0),c("submit-success",{...o})}catch(f){return console.error(a("user.backend.form.formValidationFailed")+":",f),!1}});return re(()=>L()),(f,t)=>{const V=xe,F=Ve,$=ie,l=de,r=$e,w=Ce,y=ze,K=Ue,I=ue,J=Ye,Q=Be;return _(),A("div",null,[n(Q,{state:e(o),schema:e(E),class:"space-y-8",onSubmit:e(G)},{default:m(()=>[u("div",Ge,[u("div",Ke,[u("div",Je,[u("div",Qe,[n(V,{modelValue:e(o).avatar,"onUpdate:modelValue":t[0]||(t[0]=s=>e(o).avatar=s),class:"bg-muted h-32 w-32 overflow-hidden rounded-full! border-none!",text:e(a)("user.backend.form.addAvatar"),icon:"i-lucide-camera",accept:".jpg,.png,.jpeg",maxCount:1,single:!0},null,8,["modelValue","text"])]),u("div",We,[u("p",Xe,v(e(a)("user.backend.form.avatarFormats")),1)]),u("div",Ze,[u("div",null,[u("h4",ea,v(e(a)("user.backend.form.statusLabel")),1),u("p",aa,v(e(a)("user.backend.form.statusHelp")),1)]),n(F,{"model-value":!!e(o).status,"unchecked-icon":"i-lucide-x","checked-icon":"i-lucide-check",size:"xl",onChange:t[1]||(t[1]=s=>e(o).status=e(o).status?0:1)},null,8,["model-value"])]),b.isEdit?(_(),A("div",la,[n(r,{label:e(a)("user.backend.form.power"),name:"power"},{default:m(()=>[n(l,{modelValue:e(o).power,"onUpdate:modelValue":t[2]||(t[2]=s=>e(o).power=s),disabled:!0,variant:"subtle",size:"xl",class:"w-full",type:"number"},{trailing:m(()=>[n($,{class:"cursor-pointer",color:"primary",variant:"link",size:"sm",icon:"i-lucide-edit","aria-label":"Clear input",onClick:R})]),_:1},8,["modelValue"])]),_:1},8,["label"])])):q("",!0)])]),u("div",oa,[u("div",ta,[n(r,{label:e(a)("user.backend.form.username"),name:"username",required:""},ye({default:m(()=>[n(l,{modelValue:e(o).username,"onUpdate:modelValue":t[3]||(t[3]=s=>e(o).username=s),placeholder:e(a)("user.backend.form.usernameInput"),size:"xl",disabled:b.isEdit,class:"w-full"},null,8,["modelValue","placeholder","disabled"])]),_:2},[b.isEdit?void 0:{name:"hint",fn:m(()=>[u("span",sa,v(e(a)("user.backend.form.usernameHelp")),1)]),key:"0"}]),1032,["label"]),n(r,{label:e(a)("user.backend.form.nickname"),name:"nickname",required:""},{default:m(()=>[n(l,{modelValue:e(o).nickname,"onUpdate:modelValue":t[4]||(t[4]=s=>e(o).nickname=s),placeholder:e(a)("user.backend.form.nicknameInput"),size:"xl",class:"w-full"},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),u("div",na,[n(r,{label:e(a)("user.backend.form.phone"),name:"phone"},{default:m(()=>[n(l,{modelValue:e(o).phone,"onUpdate:modelValue":t[7]||(t[7]=s=>e(o).phone=s),placeholder:e(a)("user.backend.form.phoneInput"),size:"xl",autocomplete:"off",ui:{root:"w-full",base:"!pl-28"}},{leading:m(()=>[u("div",{class:"flex items-center text-sm",onClick:t[6]||(t[6]=Z(()=>{},["stop","prevent"]))},[n(w,{modelValue:e(o).phoneAreaCode,"onUpdate:modelValue":t[5]||(t[5]=s=>e(o).phoneAreaCode=s),items:e(D),"trailing-icon":"heroicons:chevron-up-down-20-solid",class:"w-fit",size:"lg",ui:{base:"!ring-0",content:"z-999 w-64"},"value-key":"value"},{default:m(()=>[C(" + "+v(e(o).phoneAreaCode),1)]),item:m(({item:s})=>[C(v(s.label),1)]),_:1},8,["modelValue","items"])]),n(y,{class:"h-1/2",orientation:"vertical"})]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),n(r,{label:e(a)("user.backend.form.email"),name:"email"},{default:m(()=>[n(l,{modelValue:e(o).email,"onUpdate:modelValue":t[8]||(t[8]=s=>e(o).email=s),placeholder:e(a)("user.backend.form.emailInput"),size:"xl",type:"email",class:"w-full"},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),u("div",ra,[b.isEdit?q("",!0):(_(),N(r,{key:0,label:e(a)("user.backend.form.password"),name:"password",required:""},{hint:m(()=>[u("span",ia,v(e(a)("user.backend.form.passwordHelp")),1)]),default:m(()=>[n(K,{modelValue:e(o).password,"onUpdate:modelValue":t[9]||(t[9]=s=>e(o).password=s),placeholder:e(a)("user.backend.form.passwordInput"),size:"xl",type:"password",class:"w-full"},null,8,["modelValue","placeholder"])]),_:1},8,["label"])),n(r,{label:e(a)("user.backend.form.role"),name:"roleId"},{default:m(()=>[n(I,{modelValue:e(o).roleId,"onUpdate:modelValue":t[10]||(t[10]=s=>e(o).roleId=s),"label-key":"label","value-key":"value",items:e(P),placeholder:e(a)("user.backend.form.roleSelect"),size:"xl",class:"w-full"},null,8,["modelValue","items","placeholder"])]),_:1},8,["label"]),n(r,{label:e(a)("user.backend.form.realName"),name:"realName"},{default:m(()=>[n(l,{modelValue:e(o).realName,"onUpdate:modelValue":t[11]||(t[11]=s=>e(o).realName=s),placeholder:e(a)("user.backend.form.realNameInput"),size:"xl",class:"w-full"},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),u("div",da,[n(r,{label:"会员等级",name:"roleId"},{default:m(()=>[n(I,{modelValue:e(o).level,"onUpdate:modelValue":t[12]||(t[12]=s=>e(o).level=s),placeholder:"普通用户",size:"xl",class:"w-full",variant:"subtle",disabled:!0},null,8,["modelValue"])]),_:1}),n(r,{label:"有效期",name:"levelEndTime"},{default:m(()=>[n(J,{disabled:!0,modelValue:e(o).levelEndTime,"onUpdate:modelValue":t[13]||(t[13]=s=>e(o).levelEndTime=s),"show-time":"",size:"xl",class:"w-full",variant:"subtle",ui:{root:"w-full"}},null,8,["modelValue"])]),_:1})]),u("div",ua,[n($,{color:"neutral",variant:"outline",size:"lg",onClick:t[14]||(t[14]=s=>c("cancel")),class:"px-8"},{default:m(()=>[C(v(e(a)("console-common.cancel")),1)]),_:1}),b.id?(_(),N($,{key:0,color:"neutral",size:"lg",onClick:H,class:"px-8"},{default:m(()=>[C(v(e(a)("user.backend.password.resetTab")),1)]),_:1})):(_(),N($,{key:1,color:"neutral",size:"lg",onClick:x,class:"px-8"},{default:m(()=>[C(v(e(a)("console-common.reset")),1)]),_:1})),n($,{color:"primary",size:"lg",loading:e(Y),type:"submit",class:"px-8"},{default:m(()=>[C(v(b.isEdit?e(a)("console-common.update"):e(a)("console-common.create")),1)]),_:1},8,["loading"])])])])]),_:1},8,["state","schema","onSubmit"])])}}});export{el as default};
