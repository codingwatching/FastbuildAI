const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./AqVXOsKl.js","./BixMXl5t.js","./Dgvg0_To.js","./BYm23QKU.js","./DGUAW_1C.js","./DDJ79SjH.js","./Ti3HjCpC.js","./DegKy-XA.js","./B1TeSxwV.js","./RmzZBBRE.js","./C4jlvBh2.js","./C-XPfH0G.js","./7d3iyZ8h.js","./C84gZd7E.js","./DcxZIiHI.js"])))=>i.map(i=>d[i]);
import{d as z,e as E,ap as G,Q as q,s as H,aN as Q,h as p,D as Y,_ as J,r as W,i as X,w as Z,j as ee,c as h,o as y,t as n,m as l,F as te,C as oe,l as c,x as d,q as e,bB as x,v as ae,y as re,R as se,U as ne}from"#entry";import{_ as le}from"./BixMXl5t.js";import{_ as ie}from"./6WwfWHXT.js";import{_ as de}from"./BadPEZWm.js";import me from"./CDSfhndf.js";import{_ as ce}from"./DULnWpIH.js";import{_ as pe}from"./12pJH7Js.js";import{_ as ue}from"./B-p4_8pw.js";import{_ as be}from"./CEOm-hjj.js";import{_ as fe}from"./DhlnS5e0.js";import{b as he,c as ye,a as ge}from"./C84gZd7E.js";import{u as _e}from"./zDgZcZqa.js";import{u as ke}from"./C1xCp5oe.js";import{u as ve}from"./DcxZIiHI.js";import"./KiG0a5S-.js";import"./CXk2IlXx.js";import"./kRIii9yh.js";import"./DBwQYu6J.js";import"./B1TeSxwV.js";import"./C6Y-ieo6.js";import"./Ti3HjCpC.js";import"./CyS2mNdj.js";import"./BaKvIqXP.js";import"./cwT2REE1.js";import"./DaC7Nksz.js";import"./DegKy-XA.js";import"./DnFVE45b.js";import"./DSCppvl0.js";import"./7d3iyZ8h.js";import"./BzbI-krH.js";import"./CvZB4bI9.js";import"./CR9qioUt.js";import"./BRI4D6WA.js";import"./DlAUqK2U.js";import"./C-XPfH0G.js";import"./DVSiT9pd.js";import"./BstbYvQo.js";const xe={class:"flex h-full flex-col space-y-4 pb-6"},Se={class:"grid grid-cols-2 gap-4 pt-px md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5"},we={class:"flex items-center justify-center"},Ve={class:"flex flex-col items-center"},Te={class:"text-2xl font-bold"},Ae={class:"text-muted-foreground ml-1 text-sm"},Ue={class:"text-muted-foreground text-sm"},Ce={class:"flex flex-wrap items-center gap-4"},Ke={class:"flex flex-col items-start"},Ne={class:"flex flex-col items-center"},Re={key:0,class:"text-muted-foreground mb-1 flex justify-center text-xs font-medium"},Oe={class:"flex items-center justify-end gap-4"},De={class:"text-muted-foreground text-sm"},_t=z({__name:"order-membership",setup(Ie){const S=se(()=>ne(()=>import("./AqVXOsKl.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14]),import.meta.url)),w=le,g=J,V=ie,T=Y,{t}=E(),{hasAccessByCodes:_}=_e(),A=G(),U=q(),k=H({totalAmount:0,totalIncome:0,totalOrder:0,totalRefundAmount:0,totalRefundOrder:0}),C=[{key:"totalOrder",unit:"console-common.unit",label:"order.backend.membership.orderCount"},{key:"totalAmount",unit:"console-common.yuan",label:"order.backend.membership.totalAmount"},{key:"totalRefundOrder",unit:"console-common.unit",label:"order.backend.membership.refundCount"},{key:"totalRefundAmount",unit:"console-common.yuan",label:"order.backend.membership.totalRefundAmount"},{key:"totalIncome",unit:"console-common.yuan",label:"order.backend.membership.netIncome"}],s=Q({userKeyword:"",orderNo:"",payType:void 0,payState:void 0,refundState:void 0,startTime:void 0,endTime:void 0}),{paging:i,getLists:m,resetPage:u}=ke({fetchFun:he,params:s}),K=[{accessorKey:"orderNo",header:t("order.backend.membership.list.orderNo")},{accessorKey:"user",header:t("order.backend.membership.list.user"),cell:({row:o})=>p("div",{class:"flex items-center gap-2"},[p(T,{src:o.original.user.avatar}),o.original.user.nickname])},{accessorKey:"plan",header:t("order.backend.membership.list.planName"),cell:({row:o})=>o.original.plan?.name||"-"},{accessorKey:"level",header:t("order.backend.membership.list.levelName"),cell:({row:o})=>o.original.level?.name||"-"},{accessorKey:"duration",header:t("order.backend.membership.list.duration")},{accessorKey:"orderAmount",header:t("order.backend.membership.list.orderAmount"),cell:({row:o})=>{const a=Number.parseFloat(o.getValue("orderAmount"));return new Intl.NumberFormat("zh-CN",{style:"currency",currency:"CNY"}).format(a)}},{accessorKey:"payState",header:t("order.backend.membership.list.paymentStatus")},{accessorKey:"createdAt",header:({column:o})=>{const a=o.getIsSorted();return p(g,{color:"neutral",variant:"ghost",label:t("order.backend.membership.list.createdAt"),icon:a?a==="asc"?"i-lucide-arrow-up-narrow-wide":"i-lucide-arrow-down-wide-narrow":"i-lucide-arrow-up-down",class:"-mx-2.5",onClick:()=>o.toggleSorting(o.getIsSorted()==="asc")})},cell:({row:o})=>{const a=o.getValue("createdAt");return p(w,{datetime:a,mode:"datetime"})}},{accessorKey:"actions",header:()=>t("order.backend.membership.list.actions"),size:40,enableSorting:!1,enableHiding:!0}],N=async o=>{await ve({title:t("order.backend.membership.list.refund"),description:t("console-common.confirmRefund"),color:"warning"}),await ge(o||""),m(),A.success(t("console-common.refundSuccess"))};function R(o){return[_(["membership-order:detail"])?{label:t("order.backend.membership.list.viewDetails"),icon:"i-lucide-eye",color:"info",onClick:()=>{I(o.original.id)}}:null,o.original.payState===1&&_(["membership-order:refund"])&&o.original.refundStatus===0?{label:t("order.backend.membership.list.refund"),icon:"tabler:arrow-back",color:"error",onSelect(){N(o.original.id)}}:null].filter(Boolean)}const O=W({left:[],right:["actions"]}),D=X(()=>{const o=i.extend?.payTypeLists||[];return[{label:t("console-common.all"),value:"all"},...o.map(a=>({label:a.name,value:a.payType}))]});Z(()=>i.extend,o=>{o?.statistics&&(k.value=o.statistics)},{deep:!0});const I=async o=>{if(o)try{const a=await ye(o);$(a)}catch(a){console.error(a)}},$=o=>{U.create(S).open({order:o,"onGet-list":()=>{m()},onClose:()=>{}})},b=()=>{s.payType==="all"&&(s.payType=void 0),s.payState==="all"&&(s.payState=void 0),s.refundState==="all"&&(s.refundState=void 0),u()};return ee(()=>m()),(o,a)=>{const B=de,v=me,M=ce,f=pe,P=ue,F=be,L=fe;return y(),h("div",xe,[n("div",Se,[(y(),h(te,null,oe(C,(r,j)=>l(B,{key:j},{default:c(()=>[n("div",we,[n("div",Ve,[n("div",null,[n("span",Te,d(e(k)[r.key]),1),n("span",Ae,d(e(t)(r.unit)),1)]),n("span",Ue,d(e(t)(r.label)),1)])])]),_:2},1024)),64))]),n("div",Ce,[l(v,{modelValue:e(s).userKeyword,"onUpdate:modelValue":a[0]||(a[0]=r=>e(s).userKeyword=r),placeholder:e(t)("order.backend.membership.search.userKeyword"),class:"w-48",onKeyup:x(e(u),["enter"])},null,8,["modelValue","placeholder","onKeyup"]),l(v,{modelValue:e(s).orderNo,"onUpdate:modelValue":a[1]||(a[1]=r=>e(s).orderNo=r),placeholder:e(t)("order.backend.membership.search.orderNo"),class:"w-48",onKeyup:x(e(u),["enter"])},null,8,["modelValue","placeholder","onKeyup"]),l(M,{class:"ml-auto",start:e(s).startTime,"onUpdate:start":a[2]||(a[2]=r=>e(s).startTime=r),end:e(s).endTime,"onUpdate:end":a[3]||(a[3]=r=>e(s).endTime=r),"show-time":!0,ui:{root:"w-auto sm:w-xs"},onChange:e(m)},null,8,["start","end","onChange"]),l(f,{modelValue:e(s).payType,"onUpdate:modelValue":[a[4]||(a[4]=r=>e(s).payType=r),b],items:e(D),placeholder:e(t)("order.backend.membership.search.payType"),class:"w-36"},null,8,["modelValue","items","placeholder"]),l(f,{modelValue:e(s).payState,"onUpdate:modelValue":[a[5]||(a[5]=r=>e(s).payState=r),b],items:[{label:e(t)("console-common.all"),value:"all"},{label:e(t)("order.backend.membership.detail.paid"),value:1},{label:e(t)("order.backend.membership.detail.unpaid"),value:0}],placeholder:e(t)("order.backend.membership.search.payState"),class:"w-36"},null,8,["modelValue","items","placeholder"]),l(f,{modelValue:e(s).refundState,"onUpdate:modelValue":[a[6]||(a[6]=r=>e(s).refundState=r),b],items:[{label:e(t)("console-common.all"),value:"all"},{label:e(t)("order.backend.membership.search.refunded"),value:1},{label:e(t)("order.backend.membership.search.notRefunded"),value:0}],placeholder:e(t)("order.backend.membership.search.refundState"),class:"w-36"},null,8,["modelValue","items","placeholder"])]),l(F,{data:e(i).items,columns:K,loading:e(i).loading,"column-pinning":e(O),sticky:"",ui:{base:"table-fixed border-separate border-spacing-0",thead:"[&>tr]:bg-elevated/50 [&>tr]:after:content-none",tbody:"[&>tr]:last:[&>td]:border-b-0",th:"py-2 first:rounded-l-lg last:rounded-r-lg border-y border-default first:border-l last:border-r",td:"border-b border-default",tr:"[&:has(>td[colspan])]:hidden"},class:"flex-1"},{"payState-cell":c(({row:r})=>[n("div",Ke,[n("div",Ne,[r.original.refundStatus===1?(y(),h("div",Re,d(e(t)("order.backend.recharge.list.paid")),1)):ae("",!0),l(P,{color:r.original.refundStatus===1?"warning":r.original.payState===1?"success":"error"},{default:c(()=>[re(d(r.original.refundStatus===1?e(t)("order.backend.recharge.list.refunded"):r.original.payState===1?e(t)("order.backend.recharge.list.paid"):e(t)("order.backend.recharge.list.unpaid")),1)]),_:2},1032,["color"])])])]),"actions-cell":c(({row:r})=>[l(e(V),{items:[R(r)]},{default:c(()=>[l(e(g),{icon:"i-lucide-ellipsis",color:"neutral",variant:"ghost","aria-label":"Actions"})]),_:1},8,["items"])]),_:1},8,["data","loading","column-pinning"]),n("div",Oe,[n("span",De,d(e(t)("console-common.total"))+" "+d(e(i).total)+" "+d(e(t)("console-common.items")),1),l(L,{modelValue:e(i).page,"onUpdate:modelValue":[a[7]||(a[7]=r=>e(i).page=r),e(m)],"items-per-page":e(i).pageSize,total:e(i).total},null,8,["modelValue","items-per-page","total","onUpdate:modelValue"])])])}}});export{_t as default};
