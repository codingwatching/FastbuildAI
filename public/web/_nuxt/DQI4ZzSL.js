import{d as R,e as L,ar as q,ap as A,r as y,h as m,_ as N,j as E,c as F,o as I,t as n,m as r,x as l,q as o,B as G,l as p,y as x}from"#entry";import{_ as H}from"./DyTskiS5.js";import{_ as J}from"./B-p4_8pw.js";import{_ as O}from"./Bjbrn0__.js";import Q from"./CDSfhndf.js";import{_ as W}from"./CvZB4bI9.js";import{_ as X}from"./CEOm-hjj.js";import{u as C}from"./Dx01Lm3C.js";import{d as Y,e as Z,f as w,g as ee,h as se}from"./B924-IOC.js";import{u as te}from"./zDgZcZqa.js";import{u as oe}from"./DcxZIiHI.js";import"./DoL5-2Ox.js";import"./DVSiT9pd.js";import"./D_1uxSdv.js";import"./KiG0a5S-.js";import"./CXk2IlXx.js";import"./kRIii9yh.js";import"./DBwQYu6J.js";import"./B1TeSxwV.js";import"./C6Y-ieo6.js";import"./Ti3HjCpC.js";import"./CyS2mNdj.js";import"./BaKvIqXP.js";import"./cwT2REE1.js";import"./DaC7Nksz.js";import"./DegKy-XA.js";import"./DnFVE45b.js";const ae={class:"plans-config-container space-y-4 pb-8"},ne={class:"flex flex-col justify-between"},ie={class:"text-lg font-semibold"},re={class:"text-sm text-gray-500"},le={class:"space-y-4"},pe={class:"flex items-center justify-between"},ce={class:"text-lg font-semibold"},me={class:"group flex items-center gap-2"},de={class:"text-sm"},ue={class:"flex items-center justify-center gap-2 p-4"},he={class:"flex justify-end gap-2"},Ie=R({__name:"list",setup(be){const{t}=L(),{hasAccessByCodes:_}=te(),S=q(),g=A(),c=N,U=H,P=J,d=y(!1),$=y(),V=[{accessorKey:"name",header:t("membership.console-membership.plan.table.name")},{accessorKey:"durationConfig",header:t("membership.console-membership.plan.table.durationConfig"),cell:({row:e})=>K(e.original.durationConfig,e.original.duration)},{accessorKey:"levels",header:t("membership.console-membership.plan.table.levels"),cell:({row:e})=>{const s=e.original.levels;return m("div",{class:"flex items-center gap-1 max-w-52 flex-wrap"},s?.map(i=>m(P,{color:"primary",variant:"soft"},()=>i.name)))}},{accessorKey:"status",header:t("membership.console-membership.plan.table.status"),cell:({row:e})=>m(U,{modelValue:e.original.status,disabled:!_(["plan:update"]),"onUpdate:modelValue":s=>{B(e.original.id,s)}})},{accessorKey:"sort",header:t("membership.console-membership.plan.table.sort")},{accessorKey:"actions",header:t("membership.console-membership.plan.table.actions"),cell:({row:e})=>m("div",{class:"flex items-center gap-1"},[_(["plan:update"])?m(c,{icon:"i-lucide-pen-line",color:"primary",variant:"ghost",size:"xs",label:t("console-common.edit"),onClick:()=>{S.push({path:C("plans:update"),query:{id:e.original.id}})}}):null,_(["plan:delete"])?m(c,{icon:"i-lucide-trash",color:"error",variant:"ghost",size:"xs",label:t("console-common.delete"),onClick:()=>{k(e.original.id)}}):null].filter(Boolean))}],k=async e=>{try{await oe({title:t("membership.console-membership.plan.list.deleteTitle"),description:t("membership.console-membership.plan.list.deleteMsg"),color:"error"}),await Y(e),u()}catch(s){console.error(`${t("membership.console-membership.plan.list.deleteFailed")}:`,s)}},u=async()=>{const{plansStatus:e,plans:s}=await Z();d.value=e,$.value=s},M=async()=>{try{await ee({status:d.value}),u(),g.success(t("membership.console-membership.plan.status.updateSuccess"))}catch(e){console.error("Update membership status failed:",e)}},B=async(e,s)=>{try{await w(e,{status:s}),u(),g.success(t("membership.console-membership.plan.status.updateSuccess"))}catch(i){console.error("Update plan status failed:",i)}},f=y({});function h(e,s){return f.value[e]||(f.value[e]={open:!1,value:s}),f.value[e]}async function z(e){const s=f.value[e.id];if(s){e.sort=s.value;try{await se(e.id,{sort:s.value}),s.open=!1,u(),g.success(t("membership.console-membership.plan.list.updateSortSuccess"))}catch(i){console.error(`${t("membership.console-membership.plan.list.updateSortFailed")}:`,i)}}}function K(e,s){const i={1:"membership.console-membership.plan.duration.month",2:"membership.console-membership.plan.duration.quarter",3:"membership.console-membership.plan.duration.half",4:"membership.console-membership.plan.duration.year",5:"membership.console-membership.plan.duration.forever"};if(e!==6)return t(i[e]||"");const v=T(s.unit);return`${s.value} ${v}`}function T(e){return t({day:"membership.console-membership.plan.unit.day",month:"membership.console-membership.plan.unit.month",year:"membership.console-membership.plan.unit.year"}[e]||e)}return E(()=>{u()}),(e,s)=>{const i=O,v=Q,j=W,D=X;return I(),F("div",ae,[n("div",ne,[n("h4",ie,l(o(t)("membership.console-membership.plan.status.title")),1),n("div",re,l(o(t)("membership.console-membership.plan.status.description")),1)]),r(o(U),{modelValue:o(d),"onUpdate:modelValue":[s[0]||(s[0]=a=>G(d)?d.value=a:null),M]},null,8,["modelValue"]),n("div",le,[n("div",pe,[n("h4",ce,l(o(t)("membership.console-membership.plan.list.title")),1),r(i,{codes:["plan:create"]},{default:p(()=>[r(o(c),{color:"primary",icon:"i-lucide-plus",size:"sm",onClick:s[1]||(s[1]=a=>o(S).push({path:("useRoutePath"in e?e.useRoutePath:o(C))("plans:create")}))},{default:p(()=>[x(l(o(t)("membership.console-membership.plan.list.add")),1)]),_:1})]),_:1})]),r(D,{data:o($),columns:V,ui:{base:"table-fixed border-separate border-spacing-0",thead:"[&>tr]:bg-elevated/50 [&>tr]:after:content-none",tbody:"[&>tr]:last:[&>td]:border-b-0",th:"py-2 first:rounded-l-lg last:rounded-r-lg border-y border-default first:border-l last:border-r",td:"border-b border-default"}},{"sort-cell":p(({row:a})=>[n("div",me,[n("span",de,l(a.original.sort??0),1),r(j,{open:h(a.original.id,a.original.sort??0).open,"onUpdate:open":b=>h(a.original.id,a.original.sort??0).open=b},{content:p(()=>[n("div",ue,[r(v,{modelValue:h(a.original.id,a.original.sort??0).value,"onUpdate:modelValue":b=>h(a.original.id,a.original.sort??0).value=b,type:"number",placeholder:o(t)("membership.console-membership.plan.form.inputPlaceholder")},null,8,["modelValue","onUpdate:modelValue","placeholder"]),n("div",he,[r(o(c),{variant:"outline",size:"sm",onClick:b=>h(a.original.id,a.original.sort??0).open=!1},{default:p(()=>[x(l(o(t)("console-common.cancel")),1)]),_:1},8,["onClick"]),r(o(c),{size:"sm",onClick:b=>z(a.original)},{default:p(()=>[x(l(o(t)("console-common.confirm")),1)]),_:1},8,["onClick"])])])]),default:p(()=>[r(o(c),{icon:"i-lucide-pencil",color:"neutral",variant:"ghost",size:"xs",class:"opacity-0 transition-opacity group-hover:opacity-100"})]),_:2},1032,["open","onUpdate:open"])])]),_:1},8,["data"])])])}}});export{Ie as default};
