const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./DH0fxYWa.js","./n4aLOYdS.js","./4jjeIyfe.js","./D_3bTjYR.js","./D9sX2Qi6.js","./C4S285vI.js","./BTN3Ax-V.js","./BKdtdX-7.js","./CtosDvS0.js","./kRIii9yh.js","./DxD6Ynfo.js","./BhB8DUPm.js","./C6Y-ieo6.js","./zlMhJk0P.js","./DeCyaT7k.js","./D4e4FYoF.js","./BCcN9pii.js","./CMKSl-Ng.js","./CuVAPZQ8.js","./psimjGaX.js","./B3rWqoNg.js","./EK7Wbu3-.js","./BjKIBNOf.js","./DWy_CFG9.js","./td2xDKru.js","./BMSQkwth.js","./DaWZu8wl.js","./bvMLy1sv.js","./CAQVAH0V.js","./Deu6qIfg.js","./BtLy_Oaq.js","./D19QCKnC.js","./LSmoYDCw.js","./B3XNqw4u.js","./BVraOlsu.js","./BxwUS5gW.js","./MCK2d4XT.js","./meHCBXcx.js","./D2M85Dwf.js","./FTderXKt.js","./DpytHuLS.js","./BkF8DltG.js","./jsPNKUA0.js","./Bzv9SrOl.js","./DvNezYYM.js","./cd55qm53.js","./CBP5wIdr.js","./BstbYvQo.js"])))=>i.map(i=>d[i]);
import{d as Ee,i as Ue,at as Le,bu as Be,s as D,q as De,J as ue,p as W,b2 as ae,b3 as se,n as R,aW as nt,f as T,o as l,bb as lt,w as f,x as a,t as c,c as d,y as x,T as ot,g as e,G as it,z as k,_ as Re,B as je,A as Ne,F as I,E,v as Se,C as ne,D as de,l as rt,aX as ct,h as xe,aO as be,aM as ut,j as Fe,V as dt,k as mt,aR as ft,R as ce,a2 as pt,bJ as ze,ai as vt,a$ as gt,H as ht,W as ye,I as _t,aZ as xt,X as ke}from"#entry";import{_ as yt}from"./B_l_nphw.js";import{_ as kt,a as bt}from"./Omr6x9Yj.js";import{_ as wt}from"./shdu-Ndv.js";import{_ as Ct}from"./Dl_TiQPG.js";import{_ as Pe}from"./BkF8DltG.js";import{_ as $t}from"./DWe_-2t3.js";import{g as Tt,h as St,i as Ft,j as zt,k as Ie,l as It,m as Vt}from"./D2M85Dwf.js";import{e as At}from"./C457VaE0.js";import{e as Ve}from"./Bni8bPEl.js";import Mt from"./cd55qm53.js";import{_ as Et}from"./D_3bTjYR.js";import{_ as Ut}from"./BTN3Ax-V.js";import{_ as Lt}from"./CWpJD8K1.js";import{_ as Bt}from"./l1ozQanh.js";import{g as Dt}from"./eeyg4-1U.js";import{u as Ae}from"./oxig-ZyS.js";import{d as Rt}from"./MCK2d4XT.js";import{_ as jt}from"./Bzv9SrOl.js";import{u as Me}from"./Brot9FFj.js";import{u as Nt}from"./CKZGjRTU.js";const Pt={class:"relative h-full flex-1"},qt={key:0,class:"flex h-full min-h-0 w-[240px] flex-col"},Ot={class:"border-border/50 border-b p-4"},Gt={class:"flex items-center gap-3"},Ht={class:"min-w-0 flex-1"},Qt={class:"truncate font-medium"},Kt={class:"h-full flex-1 overflow-hidden"},Jt={key:0,class:"text-muted-foreground flex h-full flex-col items-center justify-center text-center text-sm"},Wt={class:"mb-2"},Xt={class:"flex flex-col gap-4 space-y-1 py-4 pr-4 pl-2"},Yt={class:"text-muted-foreground px-2 py-1 text-xs font-medium"},Zt={class:"flex flex-col gap-1"},ea={class:"block flex-1 truncate text-left"},ta={key:0,class:"flex flex-col gap-4 py-4"},aa={class:"px-2 py-1"},sa={class:"flex flex-col gap-1"},na={key:0,class:"absolute top-4 left-4 z-50 flex items-center gap-2"},la={class:"group relative"},oa={class:"block flex-1 truncate text-left text-sm"},ia={key:0,class:"text-muted-foreground flex h-full w-50 flex-col items-center justify-center text-center text-sm"},ra={class:"mb-2"},ca={class:"flex flex-col gap-4 space-y-1 py-4 pr-4 pl-2"},ua={class:"text-muted-foreground px-2 py-1 text-xs font-medium"},da={class:"flex flex-col gap-1"},ma={class:"block flex-1 truncate text-left"},fa={key:0,class:"flex flex-col gap-4 py-4"},pa={class:"px-2 py-1"},va={class:"flex flex-col gap-1"},ga=Ee({inheritAttrs:!1,__name:"chats-list",props:{agent:{},publishToken:{},accessToken:{},modelValue:{}},emits:["update:modelValue","new-conversation","switch-conversation"],async setup(b,{emit:_}){let S,X;const g=b,j=_,me=Mt,$=Et,{t:Y}=Ue(),le=Le(),h=nt(g,"modelValue",j),P=Be("(max-width: 768px)"),C=D(!1),F=D(!1);De(()=>{ue(()=>{P.value||(C.value=!0)})}),W(P,p=>{p?C.value=!1:(F.value=!1,C.value=!0)},{immediate:!1});const{data:q,pending:Q}=([S,X]=ae(()=>se(()=>`public-agent-conversations-${g.publishToken}-${g.accessToken}`,()=>g.accessToken?Tt(g.publishToken,g.accessToken,{page:1,pageSize:50}):{items:[]},{watch:[()=>g.accessToken]})),S=await S,X(),S),U=R(()=>q.value?.items||[]),v=R(()=>U.value?.length?Dt(U.value,"updatedAt",Y):[]);W(U,p=>{p?.length>0&&((g.modelValue?p.some(w=>w.id===g.modelValue):!1)?g.modelValue||j("switch-conversation",p[0]):(h.value=null,j("switch-conversation",p[0])))},{immediate:!0});const K=p=>{F.value=!1,j("switch-conversation",p)},J=()=>{j("new-conversation")},O=()=>{P.value?(F.value=!0,C.value=!1):(F.value=!1,C.value=!0)},Z=async p=>{const s=rt(p.title);try{const w=ct({setup(){return()=>xe("div",{class:"py-2"},[xe($,{label:"对话标题",size:"lg",required:!0,error:s.value.trim()?"":"对话标题不能为空"},{default:()=>xe(me,{modelValue:s.value,"onUpdate:modelValue":V=>{s.value=V},placeholder:"请输入对话标题",maxlength:50,class:"w-full"})})])}});await Ae({title:"编辑对话标题",content:w,confirmText:"保存",cancelText:"取消",color:"primary",ui:{content:"!w-sm"}}),s.value.trim()&&s.value!==p.title&&await z(p.id,s.value)}catch(w){console.log("用户取消编辑操作:",w)}},z=async(p,s)=>{try{await St(g.publishToken,g.accessToken,p,{title:s}),await be(`public-agent-conversations-${g.publishToken}-${g.accessToken}`),le.success("对话标题更新成功")}catch(w){console.error("更新对话标题失败:",w)}},A=async p=>{if(g.accessToken)try{await Ft(g.publishToken,g.accessToken,p.id),await be(`public-agent-conversations-${g.publishToken}-${g.accessToken}`),g.modelValue===p.id&&(h.value=null,j("new-conversation")),le.success(Y("common.message.deleteSuccess"))}catch(s){console.error("删除对话失败:",s)}},L=async p=>{try{await Ae({color:"error",title:"确认删除",content:"确定要删除这个会话吗？删除后无法恢复。",confirmText:"删除",cancelText:"取消",ui:{content:"!w-sm"}})&&await A(p)}catch(s){console.log("用户取消删除操作:",s)}},oe=p=>[{label:"编辑",color:"primary",icon:"i-lucide-pencil",onSelect:()=>Z(p)},{label:"删除",color:"error",icon:"i-lucide-trash",onSelect:()=>L(p)}];return Rt({o:()=>F.value=!F.value}),(p,s)=>{const w=it,V=je,B=Re,ee=Ut,n=Lt,ie=Pe,fe=Bt,pe=lt;return l(),T(pe,null,{default:f(()=>[a("div",Pt,[c(ot,{name:"sidebar"},{default:f(()=>[e(C)?(l(),d("div",qt,[a("div",Ot,[a("div",Gt,[c(w,{src:b.agent?.avatar,alt:b.agent?.name,size:"sm"},null,8,["src","alt"]),a("div",Ht,[a("h2",Qt,k(b.agent?.name),1)]),c(B,{color:"neutral",variant:"ghost",size:"sm",class:"p-2",onClick:s[0]||(s[0]=m=>C.value=!1)},{default:f(()=>[c(V,{name:"i-lucide-panel-left",class:"size-5"})]),_:1})]),c(B,{class:"mt-3 w-full",color:"primary",variant:"soft",onClick:J},{default:f(()=>[c(V,{name:"i-lucide-plus",class:"mr-2 size-4"}),s[4]||(s[4]=Ne(" 新建会话 ",-1))]),_:1})]),a("div",Kt,[!e(v).length&&!e(Q)?(l(),d("div",Jt,[a("div",Wt,[c(V,{name:"i-lucide-message-circle",size:"lg",class:"text-muted-foreground"})]),s[5]||(s[5]=a("p",null,"暂无会话记录",-1)),s[6]||(s[6]=a("p",{class:"text-xs"},"开始与智能体对话吧",-1))])):(l(),T(ie,{key:1,class:"grid h-full"},{default:f(()=>[a("div",Xt,[(l(!0),d(I,null,E(e(v),m=>(l(),d("div",{key:m.key,class:"flex flex-col gap-2"},[a("div",Yt,k(m.label),1),a("div",Zt,[(l(!0),d(I,null,E(m.items,r=>(l(),d("div",{key:r.id,class:"group relative"},[c(B,{label:r.title,ui:{base:"flex justify-between w-full gap-2 cursor-pointer pr-10 relative w-full"},variant:r.id===b.modelValue?"soft":"ghost",color:r.id===b.modelValue?"primary":"neutral",onClick:te=>K(r)},{default:f(()=>[a("span",ea,k(r.title||"新会话"),1)]),_:2},1032,["label","variant","color","onClick"]),c(ee,{items:[oe(r)],ui:{content:"w-3",group:"flex flex-col gap-1 p-2",itemLeadingIcon:"size-4"},content:{side:"right",align:"start"}},{default:f(()=>[c(V,{name:"i-lucide-ellipsis",size:14,class:ne(["absolute top-1/2 right-3 z-10 h-8 -translate-y-1/2 cursor-pointer px-2.5 py-1.5 opacity-0 transition-opacity group-hover:opacity-100",{"opacity-100":r.id===b.modelValue}]),onClick:s[1]||(s[1]=Se(()=>{},["stop"]))},null,8,["class"])]),_:2},1032,["items"])]))),128))])]))),128)),!e(v).length&&e(Q)?(l(),d("div",ta,[(l(),d(I,null,E(3,m=>a("div",{key:`group-${m}`,class:"flex flex-col gap-2"},[a("div",aa,[c(n,{class:"h-4 w-16"})]),a("div",sa,[(l(!0),d(I,null,E(m===1?3:m===2?2:1,r=>(l(),T(n,{key:`item-${m}-${r}`,class:"h-10 w-full rounded-md"}))),128))])])),64))])):x("",!0)])]),_:1}))]),s[7]||(s[7]=a("div",{class:"border-border/50 border-t pt-2"},[a("div",{class:"text-muted-foreground flex items-center justify-center gap-1 text-xs"},[a("span",null,"Powered by"),a("a",{href:"https://buildingai.cc",target:"_blank",class:"text-primary font-medium hover:underline"}," BuildingAI ")])],-1))])):x("",!0)]),_:1}),e(C)?x("",!0):(l(),d("div",na,[c(B,{color:"neutral",variant:"soft",size:"lg",class:"p-2",onClick:O},{default:f(()=>[c(V,{name:"i-lucide-panel-right",class:"size-5"})]),_:1}),s[9]||(s[9]=a("div",{class:"text-muted-foreground mx-1"},"/",-1)),a("div",la,[b.modelValue?(l(),T(ee,{key:1,items:[{label:"删除",color:"error",icon:"i-lucide-trash",onSelect:()=>L(e(U).find(m=>m.id===b.modelValue))},{label:"新建对话",color:"primary",icon:"i-lucide-plus",onSelect:()=>J()}],ui:{content:"w-32",group:"flex flex-col gap-1 p-2",itemLeadingIcon:"size-4"},content:{side:"bottom",align:"center"}},{default:f(()=>[c(B,{label:e(U).find(m=>m.id===b.modelValue)?.title||"当前对话",variant:"ghost",color:"neutral",size:"sm",class:"px-3 py-2"},{default:f(()=>[a("span",oa,k(e(U).find(m=>m.id===b.modelValue)?.title||"当前对话"),1),c(V,{name:"i-lucide-chevron-down",class:"size-5"})]),_:1},8,["label"])]),_:1},8,["items"])):(l(),T(B,{key:0,variant:"ghost",color:"neutral",size:"sm",class:"px-3 py-2"},{default:f(()=>[...s[8]||(s[8]=[a("span",{class:"block flex-1 truncate text-left text-sm"},"New Chat",-1)])]),_:1}))])])),c(fe,{open:e(F),"onUpdate:open":s[3]||(s[3]=m=>de(F)?F.value=m:null),side:"left",ui:{content:"!w-fit flex-0 max-w-fit"}},{content:f(()=>[!e(v).length&&!e(Q)?(l(),d("div",ia,[a("div",ra,[c(V,{name:"i-lucide-message-circle",size:"lg",class:"text-gray-400"})]),s[10]||(s[10]=a("p",null,"暂无会话记录",-1)),s[11]||(s[11]=a("p",{class:"text-xs"},"开始与智能体对话吧",-1))])):(l(),T(ie,{key:1,class:"h-full"},{default:f(()=>[a("div",ca,[(l(!0),d(I,null,E(e(v),m=>(l(),d("div",{key:m.key,class:"flex flex-col gap-2"},[a("div",ua,k(m.label),1),a("div",da,[(l(!0),d(I,null,E(m.items,r=>(l(),d("div",{key:r.id,class:"group relative"},[c(B,{label:r.title,ui:{base:"flex justify-between w-full gap-2 cursor-pointer pr-10 relative w-full"},variant:r.id===b.modelValue?"soft":"ghost",color:r.id===b.modelValue?"primary":"neutral",onClick:te=>K(r)},{default:f(()=>[a("span",ma,k(r.title||"新会话"),1)]),_:2},1032,["label","variant","color","onClick"]),c(ee,{items:[oe(r)],ui:{content:"w-3",group:"flex flex-col gap-1 p-2",itemLeadingIcon:"size-4"},content:{side:"right",align:"start"}},{default:f(()=>[c(V,{name:"i-lucide-ellipsis",size:14,class:ne(["absolute top-1/2 right-3 z-10 h-8 -translate-y-1/2 cursor-pointer px-2.5 py-1.5 opacity-0 transition-opacity group-hover:opacity-100",{"opacity-100":r.id===b.modelValue}]),onClick:s[2]||(s[2]=Se(()=>{},["stop"]))},null,8,["class"])]),_:2},1032,["items"])]))),128))])]))),128)),!e(v).length&&e(Q)?(l(),d("div",fa,[(l(),d(I,null,E(3,m=>a("div",{key:`group-${m}`,class:"flex flex-col gap-2"},[a("div",pa,[c(n,{class:"h-4 w-16"})]),a("div",va,[(l(!0),d(I,null,E(m===1?3:m===2?2:1,r=>(l(),T(n,{key:`item-${m}-${r}`,class:"h-10 w-full rounded-md"}))),128))])])),64))])):x("",!0)])]),_:1}))]),_:1},8,["open"])])]),_:1})}}}),ha=jt(ga,[["__scopeId","data-v-e3d15c41"]]),_a={class:"bg-secondary h-full flex-none"},xa={key:0,class:"flex h-full w-full items-center justify-center"},ya={class:"flex items-center gap-3"},ka={class:"text-lg"},ba={key:1,class:"flex h-full w-full items-center justify-center"},wa={class:"text-center"},Ca={class:"mb-2 text-xl font-semibold"},$a={class:"text-muted-foreground"},Ta={class:"text-muted-foreground text-sm"},Sa={key:0,class:"flex items-center gap-2"},Fa={class:"my-2 flex items-center gap-1"},za={class:"text-muted-foreground flex-none text-xs"},Ia={key:0,class:"m-2 space-y-2"},Va={key:2,class:"bg-background shadow-default my-6 w-full rounded-2xl"},Aa={class:"text-foreground border-muted/10 text-md flex items-center justify-between border-b p-4 font-medium"},Ma={class:"flex items-center gap-2"},Ea={key:0,class:"mt-2 p-4"},Ua={class:"w-full max-w-[800px] p-4 lg:py-2"},La={key:0,class:"mb-3"},Ba={class:"flex flex-wrap gap-2"},Da={key:0,class:"text-muted-foreground text-xs"},is=Ee({__name:"chat",props:{billingMode:{}},async setup(b){let _,S;const X=ye(()=>ke(()=>import("./DH0fxYWa.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39]),import.meta.url)),g=ye(()=>ke(()=>import("./DpytHuLS.js"),__vite__mapDeps([40,41,1,42,43,31,32,33,13,18,11,34,35,36,21]),import.meta.url)),j=ye(()=>ke(()=>import("./DvNezYYM.js"),__vite__mapDeps([44,45,1,3,4,2,46,8,28,10,13,14,15,11,47,18,30,39,26]),import.meta.url)),me=b,{t:$}=Ue(),Y=Be("(max-width: 768px)"),{params:le}=ut(),h=R(()=>le.id||""),P=Fe(),C=Le(),F=dt(),q=mt("scrollAreaRef"),{height:Q}=ft(q),U=ce(`public_agent_conversation_${h.value}`),v=D(P.isLogin&&U.value||null),K=D(!0),J=D(""),O=D(null),Z=D({question:"",answer:"",enabled:!0}),z=D(!1);W(v,t=>{P.isLogin?U.value=t:U.value=null});const A=pt({page:1,pageSize:15}),L=D(!1),{data:oe,refresh:p}=([_,S]=ae(async()=>se(`access-token-${h.value}`,async()=>{const t=`public_agent_token_${h.value}`,o=ce(t);if(o.value)return{accessToken:o.value,fromCache:!0};try{const u=await zt(h.value);return o.value=u.accessToken,{...u,fromCache:!1}}catch(u){throw console.error("生成访问令牌失败:",u),u}})),_=await _,S(),_),s=R(()=>oe.value?.accessToken||""),{data:w,refresh:V}=([_,S]=ae(()=>se(()=>!v.value||!s.value?(console.log("conversationId.value",v.value),{items:[],total:0,page:A.page,pageSize:A.pageSize}):Ie(h.value,s.value,v.value,A),{transform:t=>t},"$zgx5FY2pBK")),_=await _,S(),_),{data:B}=([_,S]=ae(()=>se("chat-config",()=>At())),_=await _,S(),_);w.value||(J.value="智能体不存在或未发布"),w.value?.items?.length||(v.value=null),L.value=w.value?.total>(w.value?.items?.length||0);const ee=R(()=>w.value?.items?w.value.items.map(t=>({...t,id:t.id||Me(),avatar:n.value?.chatAvatar||n.value?.avatar,status:"completed"})):[]),{data:n,pending:ie}=([_,S]=ae(()=>se(`public-agent-${h.value}`,()=>It(h.value,s.value))),_=await _,S(),_),fe=()=>{v.value=null,A.page=1,r.value=[],z.value=!0,n.value&&(n.value.formFieldsInputs={})},pe=async t=>{t.id!==v.value&&(v.value=t.id,A.page=1,V(),G())},m=t=>{if(!n.value)return;const o=t.slice().reverse().find(u=>u?.role==="user"&&u.formFieldsInputs);console.log("lastUserMessage",o),n.value.formFieldsInputs=o?.formFieldsInputs||{}},{messages:r,input:te,files:ve,handleSubmit:qe,reload:Oe,stop:we,status:Ge,error:He}=Nt({api:Vt,initialMessages:[],chatConfig:{get avatar(){return n.value?.chatAvatar||n.value?.avatar}},body:{publishToken:h.value,accessToken:s.value,saveConversation:!0,get conversationId(){return v.value},get billingMode(){return me.billingMode},get formFields(){return n.value?.formFields||[]},get formFieldsInputs(){return n.value?.formFieldsInputs||{}}},onToolCall(){},onResponse(t){t.status===401&&Fe().logout(!0)},onUpdate(t){t.type==="conversation_id"&&(v.value=t.data,be(`public-agent-conversations-${h.value}-${s.value}`))},onError(t){console.error("聊天错误:",t?.message||"发送失败")},onFinish(t){console.log("聊天完成:",t)}}),ge=R(()=>Ge.value==="loading");W(()=>P.isLogin,t=>{t||(ce(`public_agent_conversation_${h.value}`,{maxAge:-1,path:"/"}).value=null,ce(`public_agent_token_${h.value}`,{maxAge:-1,path:"/"}).value=null,we(),r.value=[],v.value=null,L.value=!1,A.page=1,z.value=!0)},{immediate:!0});const Qe=async()=>{if(!(!L.value||!v.value||!h.value||!s.value)){A.page++;try{const t=await Ie(h.value,s.value,v.value,A),o=t.items?.reverse().map(u=>({id:u.id||Me(),role:u.role,content:u.content,status:"completed",mcpToolCalls:u.mcpToolCalls}))||[];r.value.unshift(...o),L.value=t.total>r.value.length}catch(t){A.page--,console.error("加载更多消息失败:",t),L.value=!0}}},he=ze(t=>{const o=t.target,u=40;K.value=o.scrollHeight-(o.scrollTop+o.clientHeight)<=u},100),G=async(t=!0)=>{await ue(),q.value?.scrollToBottom(t)},Ce=()=>{if(!n.value)return C.error("智能体信息未加载"),!1;const t=n.value.formFields||[],o=n.value.formFieldsInputs||{};if(t.length===0)return!0;const u=[];return t.forEach(y=>{if(y.required){const M=o[y.name];(!M||typeof M=="string"&&M.trim()==="")&&u.push(`${y.label}是必填字段`)}}),u.length>0?(C.error(`表单验证失败: ${u.join(", ")}`),!1):!0},Ke=()=>{Ce()&&(z.value=!1)},re=async t=>{if(!(!t.trim()||ge.value)){if(!n.value)return C.error("智能体信息未加载");if(!s.value)return C.error("请先生成访问令牌");Ce()&&(await qe(t),G())}};W(ee,t=>{t&&(r.value=[...t],m(t),ue(()=>{t.length>0?G(!1):z.value=!0}))},{immediate:!0}),W(()=>r.value.at(-1)?.content,()=>{ue(()=>{K.value&&G(!1)})},{flush:"post"});const Je=t=>{F.create(g).open({context:t})},We=(t,o=null)=>{O.value=o,F.create(X).open({agentId:n.value?.id,hiddenStatus:!0,annotationId:t,messageId:o,isPublic:!0,publishToken:h.value,accessToken:s.value,initialData:void 0,onResult:y=>{$e(!0,y)}})},Xe=(t,o)=>{const u=r.value[o-1];if(!u||u.role!=="user"){C.error("找不到对应的用户问题");return}Z.value={question:Ve(u.content),answer:Ve(t.content),enabled:!0},O.value=t.id||null,F.create(X).open({agentId:n.value?.id,annotationId:null,messageId:t.id||null,isPublic:!0,publishToken:h.value,accessToken:s.value,initialData:Z.value,onResult:M=>{$e(!0,M)}})};function $e(t,o){if(o?.id&&O.value){const u=r.value.findIndex(y=>y.id===O.value);if(u>=0){const y=r.value[u];y&&!y.metadata&&(y.metadata={}),y?.metadata&&(y.metadata.annotations={annotationId:o.id,createdBy:"",question:"",similarity:1})}}O.value=null,Z.value={question:"",answer:"",enabled:!0}}let _e=null;return De(async()=>{G(!1);const t=q.value?.getViewportElement(),o=t&&t.viewportElement;if(o){o.addEventListener("scroll",he,{passive:!0}),he({target:o});const u=ze(()=>{K.value&&G(!1)},50);_e=new MutationObserver(()=>{u()}),_e.observe(o,{childList:!0,subtree:!1,characterData:!1})}}),vt(()=>{const t=q.value?.getViewportElement();(t&&t.viewportElement)?.removeEventListener("scroll",he),_e?.disconnect()}),gt({title:R(()=>n.value?`${n.value.name} - BuildingAI`:"BuildingAI"),link:[{rel:"icon",href:R(()=>n.value?.avatar||"/favicon.ico")},{rel:"apple-touch-icon",href:R(()=>n.value?.avatar||"/favicon.ico")}]}),(t,o)=>{const u=je,y=yt,M=Re,Te=bt,Ye=wt,Ze=Ct,et=kt,tt=Pe,at=xt,st=$t;return l(),d("div",{class:ne(["ai-chat bg-secondary flex h-full min-h-0 items-center justify-center rounded-l-xl p-2",{"p-0!":e(Y)}])},[a("div",_a,[c(ha,{agent:e(n),"publish-token":e(h),"access-token":e(s),modelValue:e(v),"onUpdate:modelValue":o[0]||(o[0]=i=>de(v)?v.value=i:null),onNewConversation:fe,onSwitchConversation:pe},null,8,["agent","publish-token","access-token","modelValue"])]),a("div",{class:ne(["bg-background flex h-full min-h-0 w-full flex-col items-center rounded-xl",{"rounded-none!":e(Y)}])},[e(ie)?(l(),d("div",xa,[a("div",ya,[c(u,{name:"i-lucide-loader-2",class:"text-primary size-6 animate-spin"}),a("span",ka,k(t.$t("ai-agent.frontend.chat.loadingAgent")),1)])])):e(J)?(l(),d("div",ba,[a("div",wa,[c(u,{name:"i-lucide-alert-circle",class:"text-error mx-auto mb-4 size-12"}),a("h2",Ca,k(t.$t("ai-agent.frontend.chat.loadingFailed")),1),a("p",$a,k(e(J)),1)])])):e(n)?(l(),d(I,{key:2},[o[6]||(o[6]=a("div",{class:"flex h-12 w-full items-center justify-center"},null,-1)),c(tt,{class:"h-full min-h-0 w-full",type:"auto",ref_key:"scrollAreaRef",ref:q,onInView:o[3]||(o[3]=i=>G(!1))},{default:f(()=>[c(et,{loading:!1,"has-more":e(L),threshold:500,"content-class":"max-w-[800px] w-full space-y-3 p-4 lg:py-4",onLoadMore:Qe},{default:f(()=>[e(r).length===0&&(!e(z)||!e(n).formFields?.length)&&e(n).openingStatement?.length&&e(n).openingQuestions?.length?(l(),T(Te,{key:0,messages:[{role:"assistant",avatar:e(n)?.chatAvatar||e(n)?.avatar,content:e(n)?.openingStatement||""}],"scroll-area-height":200,assistant:{actions:[]}},{content:f(({message:i})=>[c(y,{content:i.content.toString(),"show-run-button":!1},null,8,["content"]),a("div",{class:ne(["flex flex-col gap-2",{"ml-4":e(n)?.avatar}])},[a("div",Ta,k(t.$t("ai-agent.frontend.chat.youCanAskMe")),1),(l(!0),d(I,null,E(e(n)?.openingQuestions||[],N=>(l(),d("div",{key:N},[c(M,{label:N,color:"primary",variant:"soft",onClick:H=>re(N)},null,8,["label","onClick"])]))),128))],2)]),_:1},8,["messages"])):x("",!0),e(r).length!==0?(l(),T(Te,{key:1,messages:e(r),"scroll-area-height":e(Q),error:e(He),assistant:{actions:[{label:e($)("ai-chat.frontend.messages.retry"),icon:"i-lucide-rotate-cw-square",onClick:()=>e(Oe)()},{label:e($)("ai-agent.frontend.chat.chatContext"),icon:"i-lucide-file-type",show:!e(n).showContext,onClick:i=>{i?.metadata?.context?Je(i.metadata.context):e(C).error(e($)("ai-agent.backend.configuration.noChatContext"))}},{label:e($)("ai-agent.frontend.chat.annotation"),icon:"i-lucide-wrap-text",show:!e(n).enableFeedback,onClick:(i,N)=>{const H=i.metadata?.annotations?.annotationId;H?We(H,i.id):Xe(i,N)}}]},"spacing-offset":160},{content:f(({message:i})=>[i.content.length?(l(),T(y,{key:0,content:i.content.toString(),"show-run-button":!1},{before:f(()=>[i.status==="loading"?(l(),d("div",Sa,[c(u,{name:"i-lucide-loader-2",class:"animate-spin"}),a("span",null,k(e($)("ai-chat.frontend.messages.thinking")),1)])):x("",!0)]),after:f(()=>[i.metadata?.references&&i.metadata.references.length>0&&i.role==="assistant"&&!e(ge)&&e(n).showReference?(l(),d(I,{key:0},[a("div",Fa,[a("span",za,k(e($)("ai-agent.frontend.chat.reference")),1),i.metadata?.references&&i.metadata.references.length>0&&i.role==="assistant"?(l(),T(Ye,{key:0,size:"xs",type:"dashed"})):x("",!0)]),c(Ze,{references:i.metadata.references},null,8,["references"])],64)):x("",!0)]),_:2},1032,["content"])):x("",!0)]),"after-tools":f(({message:i,index:N})=>[i.metadata?.suggestions&&e(r).length-1===N?(l(),d("div",Ia,[(l(!0),d(I,null,E(i.metadata.suggestions,H=>(l(),d("div",{key:H},[c(M,{label:H,color:"primary",variant:"soft",onClick:Ra=>re(H)},null,8,["label","onClick"])]))),128))])):x("",!0)]),_:1},8,["messages","scroll-area-height","error","assistant"])):x("",!0),e(n).formFields&&e(n).formFields.length>0?(l(),d("div",Va,[a("div",Aa,[a("span",Ma,[c(u,{name:"i-lucide-bot-message-square",class:"text-primary size-7"}),Ne(" "+k(e($)("ai-agent.frontend.chat.newConversationSettings")),1)]),e(r).length||!e(z)?(l(),T(M,{key:0,color:"primary",variant:"ghost",size:"sm",onClick:o[1]||(o[1]=i=>z.value=!e(z))},{default:f(()=>[a("span",null,k(e(z)?e($)("console-common.close"):e($)("console-common.edit")),1)]),_:1})):x("",!0)]),ht(a("div",null,[c(e(j),{inputs:e(n).formFieldsInputs,"onUpdate:inputs":o[2]||(o[2]=i=>e(n).formFieldsInputs=i),formFields:e(n).formFields,class:"w-full bg-transparent pt-0",formClass:"bg-muted hover:bg-muted"},null,8,["inputs","formFields"])],512),[[_t,e(z)]]),e(r).length===0&&e(z)?(l(),d("div",Ea,[c(M,{color:"primary",class:"w-full justify-center",onClick:Ke},{default:f(()=>[a("span",null,k(e($)("ai-agent.frontend.chat.startConversation")),1)]),_:1})])):x("",!0)])):x("",!0)]),_:1},8,["has-more"])]),_:1},512),a("div",Ua,[e(n).quickCommands?.length?(l(),d("div",La,[a("div",Ba,[(l(!0),d(I,null,E(e(n).quickCommands,i=>(l(),T(M,{key:i.name,color:"neutral",variant:"soft",size:"sm",onClick:N=>re(i.name)},{default:f(()=>[i.avatar?(l(),T(at,{key:0,src:i.avatar,class:"h-4 w-4"},null,8,["src"])):x("",!0),a("span",null,k(i.name),1)]),_:2},1032,["onClick"]))),128))])])):x("",!0),c(st,{modelValue:e(te),"onUpdate:modelValue":o[4]||(o[4]=i=>de(te)?te.value=i:null),"file-list":e(ve),"onUpdate:fileList":o[5]||(o[5]=i=>de(ve)?ve.value=i:null),"is-loading":e(ge),placeholder:e($)("ai-chat.frontend.and",{name:e(n).name}),attachmentSizeLimit:e(B)?.attachmentSizeLimit,"model-features":e(n).modelFeatures,class:"sticky bottom-0 z-10 [view-transition-name:chat-prompt]",rows:1,onStop:e(we),onSubmit:re},{"panel-right-item":f(()=>[(e(n).billingConfig?.price??0)>0?(l(),d("span",Da,k(e($)("ai-chat.frontend.singleRunConsumption",{price:e(n).billingConfig?.price??0})),1)):x("",!0)]),_:1},8,["modelValue","file-list","is-loading","placeholder","attachmentSizeLimit","model-features","onStop"])])],64)):x("",!0)],2)],2)}}});export{is as _};
