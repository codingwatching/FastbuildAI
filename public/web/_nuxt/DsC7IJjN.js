import{d as L,ap as R,aI as G,g as Y,b as K,au as Q,aJ as $,i as W,j as V,o as h,k as i,c as X,p as e,l as s,y as Z,q as m,D,x as k,bG as ee,v,_ as ae,E as I}from"#entry";import{_ as oe}from"./GtAB3aV5.js";import{_ as te}from"./DS-TE4M7.js";import re from"./BruVSCWF.js";import{_ as se}from"./DDtM2OcI.js";import ie from"./Dg6D3RQ3.js";import{_ as le}from"./C2iKt9bM.js";import{_ as ne}from"./D-6Co9ha.js";import{_ as me}from"./DLMDXBaB.js";import{_ as ce}from"./CXUt0j5Y.js";import{d as de,e as pe,f as ue,g as fe}from"./D9F45f3T.js";import{c as T,a as j}from"./BUyfW8JT.js";import"./BdImEx5p.js";import"./oFTPHjuc.js";import"./BcsO9TDZ.js";import"./DlAUqK2U.js";import"./BgHJjJs-.js";import"./DHFmmngs.js";import"./CR1AS2Ry.js";import"./Btvd554H.js";import"./BPKB8n-W.js";import"./B-DdbQ-X.js";import"./V9POJiZu.js";import"./MN31c9CG.js";import"./BstbYvQo.js";import"./DuSMYVIA.js";import"./Cgm5UcRV.js";import"./BP0i4hNs.js";import"./CgMDXot0.js";import"./C6Y-ieo6.js";import"./Bcbime_x.js";import"./kRIii9yh.js";import"./CuOaO1Pb.js";import"./D6yWePie.js";import"./3UOIlTK8.js";import"./-Eb02sIQ.js";import"./Dk6FGhu1.js";import"./CCcv9mzY.js";import"./BFAo_s2U.js";import"./Cb04SOqd.js";import"./VGKgjfSv.js";import"./DaWZu8wl.js";const be={key:0,class:"flex items-center justify-center",style:{height:"400px"}},ve={class:"pb-2"},_e={class:"grid grid-cols-1 gap-4 md:grid-cols-2"},ye={class:"space-y-4"},ke={class:"pb-2"},ge={class:"pb-2"},he={class:"flex items-center gap-2 text-base"},je={class:"grid grid-cols-1 gap-4 md:grid-cols-2"},$e={class:"bottom-0 z-10 flex justify-end gap-2 py-4"},Ve={class:"pb-2"},we={class:"flex flex-col gap-4 p-4"},Ue={class:"flex flex-col"},xe={class:"flex flex-col items-start gap-2"},Se={class:"flex items-start gap-1 rounded-lg bg-blue-50 p-2 text-sm text-blue-800 dark:bg-blue-900/30 dark:text-blue-200"},De={class:"bottom-0 z-10 flex justify-end gap-2 pt-4"},Ie=`{
    "mcpServers": {
        "Your MCP Server Name": {
            "url": "xxxxx",
            // type: sse or streamable-http
            "type": "sse or streamable-http",
            "headers": {
                "Content-Type": "application/json",
                "Authorization": "Bearer Your Token"
                ...
            },
            ...
        }
    }
}`,ka=L({__name:"mcp-server-edit",props:{id:{},isView:{type:Boolean},isJsonImport:{type:Boolean},isSystemMcp:{type:Boolean}},emits:["close","updateIds"],setup(b,{emit:E}){const w=R(),N=G(),F=b,_=E,f=Y(()=>F.id||N.query.id||null),{t:a}=K(),r=Q({formData:{name:"",providerName:"",providerUrl:"",description:"",icon:"",url:"",communicationType:void 0,customHeaders:""},isSystem:!1,jsonFormData:{jsonImport:""}}),H=T({name:j().required(a("ai-mcp.backend.form.name")),url:j().required(a("ai-mcp.backend.form.baseUrlPlaceholder")).test("is-valid-url",a("ai-mcp.backend.form.baseUrlPlaceholder"),t=>{if(!t)return!1;if(/^(https?:\/\/)?[\w\d-]+(\.[\w\d-]+)+([\w\d\-.,@?^=%&:/~+#]*[\w\d=#])?$/.test(t))return!0;try{return new URL(t),!0}catch{return!1}}),communicationType:j().required(a("ai-mcp.backend.form.communicationType"))}),C=T({jsonImport:j().required(a("ai-mcp.backend.validation.jsonRequired")).test("is-valid-json",a("ai-mcp.backend.validation.jsonFormatError"),t=>{if(!t)return!1;try{return JSON.parse(t),!0}catch{return!1}}).test("validate-required-fields",(t,o)=>{if(!t)return!0;try{const c=JSON.parse(t);if(!c.mcpServers||typeof c.mcpServers!="object")return o.createError({message:a("ai-mcp.backend.validation.missingMcpServers")});const p=c.mcpServers;if(Object.keys(p).length===0)return o.createError({message:a("ai-mcp.backend.validation.emptyMcpServers")});for(const[d,y]of Object.entries(p)){if(!y||typeof y!="object")return o.createError({message:`"${d}" ${a("ai-mcp.backend.validation.invalidConfig")}`});const u=y;if(!u.url)return o.createError({message:`"${d}" ${a("ai-mcp.backend.validation.missingUrl")}`});if(typeof u.url!="string")return o.createError({message:`"${d}" ${a("ai-mcp.backend.validation.invalidUrlType")}`});if(!u.type)return o.createError({message:`"${d}" ${a("ai-mcp.backend.validation.missingType")}`});if(typeof u.type!="string")return o.createError({message:`"${d}" ${a("ai-mcp.backend.validation.invalidTypeValue")}`});if(!["sse","streamable-http"].includes(u.type))return o.createError({message:`"${d}" ${a("ai-mcp.backend.validation.invalidTypeEnum")}`});if(u.headers!==void 0&&(typeof u.headers!="object"||u.headers===null))return o.createError({message:`"${d}" ${a("ai-mcp.backend.validation.invalidHeaders")}`})}return!0}catch{return o.createError({message:a("console-ai-mcp-server.validation.jsonFormatError")})}})}),{lockFn:q,isLock:B}=$(async()=>{try{const t=await de(f.value);Object.assign(r.formData,{name:t.name||"",providerName:t.providerName||"",providerUrl:t.url||"",description:t.description||"",icon:t.icon||"",url:t.url||"",communicationType:t.communicationType});const o=t.customHeaders;if(o!==void 0)if(typeof o=="object"&&o!==null&&!Array.isArray(o)){const c=Object.entries(o).map(([p,n])=>`${p}=${n}`).join(",");r.formData.customHeaders=c}else typeof o=="string"?r.formData.customHeaders=o:r.formData.customHeaders=""}catch(t){console.error("获取供应商详情失败:",t)}}),M=t=>{if(!t?.trim())return{};const o={};return t.split(/[,\n]/).filter(p=>p.trim()).forEach(p=>{const[n,...d]=p.split("=");if(n?.trim()&&d.length>0){const y=d.join("=");o[n.trim()]=y.trim()}}),o},{lockFn:z,isLock:U}=$(async()=>{const{customHeaders:t,...o}=r.formData,c=M(t),p={...o,customHeaders:c};try{const n=f.value?await pe(f.value,p):await ue(p);w.success(f.value?a("ai-mcp.backend.updateSuccess"):a("ai-mcp.backend.createSuccess")),_("close",!0),_("updateIds",[n.id])}catch(n){console.error("提交失败:",n)}}),{lockFn:J}=$(async()=>{try{const t=await fe(r.jsonFormData.jsonImport||""),o=[`${a("ai-mcp.backend.jsonImportTotal")} ${t.total} ${a("ai-mcp.backend.jsonImportUnit")}`,`${a("console-common.create")} ${t.created} ${a("ai-mcp.backend.jsonImportUnit")}`,`${a("console-common.update")} ${t.updated} ${a("ai-mcp.backend.jsonImportUnit")}`].join("，");w.success(o),_("close",!0),_("updateIds",t.results.map(c=>c.id))}catch(t){console.error("JSON导入失败:",t)}});return W(async()=>f.value&&await q()),(t,o)=>{const c=Z,p=oe,n=te,d=re,y=se,u=ie,x=ee,P=le,g=ae,S=ne,O=me,A=ce;return h(),V(A,{title:b.isView&&e(f)?e(a)("ai-mcp.backend.detailTitle"):e(f)?e(a)("ai-mcp.backend.editTitle"):e(a)("ai-mcp.backend.addTitle"),description:b.isView&&e(f)?e(a)("ai-mcp.backend.detailTitle"):e(f)?e(a)("ai-mcp.backend.editTitle"):e(a)("ai-mcp.backend.addTitle"),ui:{content:"max-w-2xl overflow-y-auto h-fit"},onClose:o[11]||(o[11]=l=>_("close"))},{default:i(()=>[e(B)?(h(),X("div",be,[s(c,{name:"i-lucide-loader-2",class:"size-8 animate-spin"})])):b.isJsonImport?(h(),V(S,{key:2,state:e(r).jsonFormData,schema:e(C),disabled:b.isView,onSubmit:e(J)},{default:i(()=>[m("div",Ve,[s(n,{label:e(a)("ai-mcp.backend.form.jsonImport"),name:"jsonImport",required:""},{hint:i(()=>[s(O,{mode:"click","open-delay":0,"close-delay":0},{content:i(()=>[m("div",we,[m("div",Ue,[m("div",xe,[m("div",Se,[s(c,{size:"20",name:"i-tabler-alert-circle"}),m("span",null,v(e(a)("ai-mcp.backend.jsonImportCorrectExample")),1)]),m("pre",{class:"bg-muted w-full overflow-x-auto rounded-lg p-4 text-sm"},[m("code",null,v(Ie))])])])])]),default:i(()=>[s(g,{variant:"link",class:"text-primary cursor-pointer text-xs"},{default:i(()=>[k(v(e(a)("ai-mcp.backend.jsonImportExample")),1)]),_:1})]),_:1})]),default:i(()=>[s(u,{modelValue:e(r).jsonFormData.jsonImport,"onUpdate:modelValue":o[9]||(o[9]=l=>e(r).jsonFormData.jsonImport=l),placeholder:e(a)("ai-mcp.backend.form.jsonImportPlaceholder"),rows:13,ui:{root:"w-full"}},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),D(m("div",De,[s(g,{color:"neutral",variant:"soft",size:"lg",onClick:o[10]||(o[10]=l=>_("close"))},{default:i(()=>[k(v(e(a)("console-common.cancel")),1)]),_:1}),s(g,{color:"primary",size:"lg",type:"submit",loading:e(U)},{default:i(()=>[k(v(e(f)?e(a)("console-common.update"):e(a)("console-common.create")),1)]),_:1},8,["loading"])],512),[[I,!b.isView]])]),_:1},8,["state","schema","disabled","onSubmit"])):(h(),V(S,{key:1,state:e(r).formData,schema:e(H),disabled:b.isView,onSubmit:e(z)},{default:i(()=>[m("div",ve,[m("div",_e,[s(n,{label:e(a)("ai-mcp.backend.form.icon"),name:"iconUrl"},{default:i(()=>[s(p,{modelValue:e(r).formData.icon,"onUpdate:modelValue":o[0]||(o[0]=l=>e(r).formData.icon=l),class:"h-24 w-24",text:"上传图标",icon:"i-lucide-upload",accept:".jpg,.png,.svg,.ico",maxCount:1,single:!0,multiple:!1,disabled:e(r).isSystem},null,8,["modelValue","disabled"])]),_:1},8,["label"]),m("div",ye,[s(n,{label:e(a)("ai-mcp.backend.form.name"),name:"name",required:""},{default:i(()=>[s(d,{modelValue:e(r).formData.name,"onUpdate:modelValue":o[1]||(o[1]=l=>e(r).formData.name=l),disabled:e(r).isSystem,placeholder:e(a)("ai-mcp.backend.form.name"),ui:{root:"w-full"}},null,8,["modelValue","disabled","placeholder"])]),_:1},8,["label"]),s(n,{label:e(a)("ai-mcp.backend.form.type"),name:"communicationType",required:""},{default:i(()=>[s(y,{modelValue:e(r).formData.communicationType,"onUpdate:modelValue":o[2]||(o[2]=l=>e(r).formData.communicationType=l),placeholder:e(a)("ai-mcp.backend.form.type"),ui:{base:"w-full"},items:[{label:"sse",value:"sse"},{label:"streamable-http",value:"streamable-http"}]},null,8,["modelValue","placeholder"])]),_:1},8,["label"])])])]),m("div",ke,[s(n,{label:e(a)("ai-mcp.backend.form.baseUrl"),name:"url",required:""},{default:i(()=>[s(u,{modelValue:e(r).formData.url,"onUpdate:modelValue":o[3]||(o[3]=l=>e(r).formData.url=l),rows:1,autoresize:"",disabled:e(r).isSystem,placeholder:e(a)("ai-mcp.backend.form.url"),ui:{root:"w-full"}},null,8,["modelValue","disabled","placeholder"])]),_:1},8,["label"])]),m("div",ge,[s(n,{label:e(a)("ai-mcp.backend.form.description"),name:"description"},{default:i(()=>[s(u,{modelValue:e(r).formData.description,"onUpdate:modelValue":o[4]||(o[4]=l=>e(r).formData.description=l),disabled:e(r).isSystem,placeholder:e(a)("ai-mcp.backend.form.descriptionPlaceholder"),rows:3,ui:{root:"w-full"}},null,8,["modelValue","disabled","placeholder"])]),_:1},8,["label"])]),s(P,{items:[{}],ui:{header:"px-0 ",label:"text-lg font-semibold",content:"px-0",body:"flex flex-col gap-2"}},{body:i(()=>[m("div",je,[s(n,{label:e(a)("ai-mcp.backend.form.providerName"),name:"providerName"},{default:i(()=>[s(d,{modelValue:e(r).formData.providerName,"onUpdate:modelValue":o[5]||(o[5]=l=>e(r).formData.providerName=l),disabled:e(r).isSystem,placeholder:e(a)("ai-mcp.backend.form.providerName"),ui:{root:"w-full"}},null,8,["modelValue","disabled","placeholder"])]),_:1},8,["label"]),s(n,{label:e(a)("ai-mcp.backend.form.providerUrl"),name:"providerUrl",class:"col-span-2"},{default:i(()=>[s(d,{modelValue:e(r).formData.providerUrl,"onUpdate:modelValue":o[6]||(o[6]=l=>e(r).formData.providerUrl=l),disabled:e(r).isSystem,placeholder:e(a)("ai-mcp.backend.form.providerUrl"),ui:{root:"w-full"}},null,8,["modelValue","disabled","placeholder"])]),_:1},8,["label"]),s(n,{label:e(a)("ai-mcp.backend.form.headers"),name:"headers",class:"col-span-2"},{default:i(()=>[s(u,{modelValue:e(r).formData.customHeaders,"onUpdate:modelValue":o[7]||(o[7]=l=>e(r).formData.customHeaders=l),placeholder:e(a)("ai-mcp.backend.form.customHeadersPlaceholder"),ui:{root:"w-full"}},null,8,["modelValue","placeholder"])]),_:1},8,["label"])])]),default:i(()=>[m("div",he,[s(x,{name:"i-lucide-settings-2"}),k(" "+v(e(a)("ai-mcp.backend.form.advancedArgs")),1)])]),_:1}),D(m("div",$e,[s(g,{color:"neutral",variant:"soft",size:"lg",onClick:o[8]||(o[8]=l=>_("close"))},{default:i(()=>[k(v(e(a)("console-common.cancel")),1)]),_:1}),s(g,{color:"primary",size:"lg",type:"submit",loading:e(U)},{default:i(()=>[k(v(e(f)?e(a)("console-common.update"):e(a)("console-common.create")),1)]),_:1},8,["loading"])],512),[[I,!b.isView]])]),_:1},8,["state","schema","disabled","onSubmit"]))]),_:1},8,["title","description"])}}});export{ka as default};
