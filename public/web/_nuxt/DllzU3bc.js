const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./DRCuMXHz.js","./Dgvg0_To.js","./BYm23QKU.js","./DGUAW_1C.js","./DDJ79SjH.js","./Ti3HjCpC.js","./DegKy-XA.js","./B1TeSxwV.js","./RmzZBBRE.js","./C4jlvBh2.js","./C-XPfH0G.js","./7d3iyZ8h.js"])))=>i.map(i=>d[i]);
import{d as G,e as H,ap as Q,Q as J,s as h,au as X,i as p,aK as V,w as Y,k as Z,o as ee,l as d,t as a,m as l,z as se,x as m,q as e,bB as C,p as F,_ as oe,B as re,y as U,bK as ae,bL as ne,R as te,U as ie}from"#entry";import de from"./CDSfhndf.js";import{_ as le}from"./Brlt-NDg.js";import{_ as ce}from"./DNVymXxO.js";import{_ as ue}from"./BYm23QKU.js";import{d as we}from"./C-XPfH0G.js";import"./DoL5-2Ox.js";import"./CXk2IlXx.js";import"./DegKy-XA.js";import"./cwT2REE1.js";import"./DaC7Nksz.js";import"./CZsOHrUj.js";import"./B-p4_8pw.js";import"./DGUAW_1C.js";import"./DDJ79SjH.js";import"./Ti3HjCpC.js";import"./B1TeSxwV.js";import"./RmzZBBRE.js";import"./C4jlvBh2.js";import"./7d3iyZ8h.js";const me={class:"space-y-4"},pe={class:"space-y-4 pt-4"},fe={class:"text-muted-foreground text-xs"},ge={class:"space-y-4 pt-4"},_e={class:"rounded-lg border border-orange-200 bg-orange-50 p-4 dark:border-orange-800 dark:bg-orange-950"},be={class:"flex items-start gap-3"},ve={class:"space-y-2"},he={class:"font-medium text-orange-800 dark:text-orange-200"},Pe={class:"text-sm text-orange-700 dark:text-orange-300"},ke={class:"ml-4 list-disc space-y-1 text-sm text-orange-600 dark:text-orange-400"},ye={class:"flex justify-end gap-2"},je=G({__name:"edit-password",props:{userid:{}},emits:["close"],setup(B,{emit:$}){const L=te(()=>ie(()=>import("./DRCuMXHz.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11]),import.meta.url)),_=B,M=$,{t:s}=H(),c=Q(),K=J(),i=h("change"),n=X({newPassword:"",confirmPassword:""}),g=h(!1),w=h({new:!1,confirm:!1}),T=p(()=>[{value:"change",label:s("user.backend.password.changeTab"),icon:"i-lucide-edit",slot:"change"},{value:"reset",label:s("user.backend.password.resetTab"),icon:"i-lucide-refresh-cw",slot:"reset"}]),b=p(()=>{const o={};if(i.value==="change"){const r=n.newPassword.trim(),t=n.confirmPassword.trim();r&&r.length<6&&(o.newPassword=s("user.backend.password.validation.passwordMinLength")),t&&r&&(r.length<6||t!==r&&(o.confirmPassword=s("user.backend.password.validation.passwordMismatch")))}return o}),q=p(()=>Object.keys(b.value).length>0),z=p(()=>{if(i.value==="reset")return!1;const o=n.newPassword.trim(),r=n.confirmPassword.trim();return!o||!r});function P(){n.newPassword="",n.confirmPassword="",w.value={new:!1,confirm:!1}}function k(o){w.value[o]=!w.value[o]}const{lockFn:E,isLock:y}=V(async()=>{const o=n.newPassword.trim(),r=n.confirmPassword.trim();if(!o){c.warning(s("user.backend.password.validation.newPasswordRequired"));return}if(o.length<6){c.warning(s("user.backend.password.validation.passwordMinLength"));return}if(!r){c.warning(s("user.backend.password.validation.confirmPasswordRequired"));return}if(r!==o){c.warning(s("user.backend.password.validation.passwordMismatch"));return}try{await ae(_.userid||"",o),c.success(s("user.backend.password.messages.changeSuccess")),f()}catch(t){console.error("修改密码失败:",t),c.error(t instanceof Error?t.message:s("user.backend.password.messages.changeFailed"))}}),I=o=>{K.create(L).open({password:o})},D=async()=>{if(!_.userid){c.error(s("user.backend.password.validation.userIdRequired"));return}try{g.value=!0;const{password:o}=await ne(_.userid||"");I(o),f()}catch(o){console.error("重置密码失败:",o),c.error(o instanceof Error?o.message:s("user.backend.password.messages.resetFailed"))}finally{g.value=!1}},{lockFn:S}=V(D);function v(){i.value==="change"?E():S()}const f=()=>{P(),M("close")};Y(i,()=>{P()});const N=p(()=>{const o=y.value||g.value;return i.value==="change"&&(z.value||q.value)||o});we({escape:f});const O=p(()=>y.value||g.value);return(o,r)=>{const t=oe,x=de,R=le,j=se,A=ce,W=ue;return ee(),Z(W,{title:e(s)("user.backend.password.title"),ui:{content:"max-w-md overflow-y-auto h-fit"},"show-footer":!0,onClose:r[5]||(r[5]=u=>f())},{footer:d(()=>[a("div",ye,[l(t,{variant:"soft",color:"neutral",onClick:f},{default:d(()=>[U(m(e(s)("user.backend.password.cancel")),1)]),_:1}),l(t,{disabled:e(N),color:e(i)==="reset"?"warning":"primary",loading:e(O),onClick:v},{default:d(()=>[U(m(e(i)==="change"?e(s)("user.backend.password.changePassword"):e(s)("user.backend.password.confirmReset")),1)]),_:1},8,["disabled","color","loading"])])]),default:d(()=>[a("div",me,[l(A,{modelValue:e(i),"onUpdate:modelValue":r[4]||(r[4]=u=>re(i)?i.value=u:null),items:e(T),class:"w-full"},{change:d(()=>[a("div",pe,[l(R,{label:e(s)("user.backend.password.newPassword"),size:"lg",required:"",error:e(b).newPassword},{default:d(()=>[l(x,{modelValue:e(n).newPassword,"onUpdate:modelValue":r[1]||(r[1]=u=>e(n).newPassword=u),type:e(w).new?"text":"password",placeholder:e(s)("user.backend.password.newPasswordPlaceholder"),ui:{root:"w-full"},onKeydown:C(F(v,["prevent"]),["enter"])},{trailing:d(()=>[l(t,{variant:"ghost",size:"xs",icon:e(w).new?"i-lucide-eye-off":"i-lucide-eye",onClick:r[0]||(r[0]=u=>k("new"))},null,8,["icon"])]),_:1},8,["modelValue","type","placeholder","onKeydown"])]),_:1},8,["label","error"]),l(R,{label:e(s)("user.backend.password.confirmPassword"),size:"lg",required:"",error:e(b).confirmPassword},{default:d(()=>[l(x,{modelValue:e(n).confirmPassword,"onUpdate:modelValue":r[3]||(r[3]=u=>e(n).confirmPassword=u),type:e(w).confirm?"text":"password",placeholder:e(s)("user.backend.password.confirmPasswordPlaceholder"),ui:{root:"w-full"},onKeydown:C(F(v,["prevent"]),["enter"])},{trailing:d(()=>[l(t,{variant:"ghost",size:"xs",icon:e(w).confirm?"i-lucide-eye-off":"i-lucide-eye",onClick:r[2]||(r[2]=u=>k("confirm"))},null,8,["icon"])]),_:1},8,["modelValue","type","placeholder","onKeydown"])]),_:1},8,["label","error"]),a("div",fe,m(e(s)("user.backend.password.passwordHelp")),1)])]),reset:d(()=>[a("div",ge,[a("div",_e,[a("div",be,[l(j,{name:"i-lucide-alert-triangle",class:"mt-0.5 size-5 text-orange-600 dark:text-orange-400"}),a("div",ve,[a("h4",he,m(e(s)("user.backend.password.resetConfirmTitle")),1),a("p",Pe,m(e(s)("user.backend.password.resetConfirmDesc")),1),a("ul",ke,[a("li",null,m(e(s)("user.backend.password.resetWarning1")),1),a("li",null,m(e(s)("user.backend.password.resetWarning2")),1)])])])])])]),_:1},8,["modelValue","items"])])]),_:1},8,["title"])}}});export{je as default};
