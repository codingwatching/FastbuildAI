const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./BEWfOabk.js","./q_YSI2Sf.js","./Dgvg0_To.js","./BD5zOh0K.js","./DBwQYu6J.js","./DegKy-XA.js","./Ti3HjCpC.js","./Dc6e1ewN.js","./CXk2IlXx.js","./DVSiT9pd.js","./kRIii9yh.js","./BaKvIqXP.js","./DaC7Nksz.js","./D_1uxSdv.js","./C6Y-ieo6.js","./CGkf3lDq.js","./CDSfhndf.js","./Brlt-NDg.js","./DoL5-2Ox.js","./C9inLFuJ.js","./Ds48qA85.js","./BvBcSqjy.js","./BUyfW8JT.js","./DaWZu8wl.js","./BzLCLO6P.js","./B_bYPYFo.js","./DY-cUyKw.js","./DlAUqK2U.js","./CIZXtYrT.js","./CtvU5pWl.js","./CvZB4bI9.js","./KiG0a5S-.js","./B1TeSxwV.js","./CyS2mNdj.js","./cwT2REE1.js","./DnFVE45b.js","./HHGKx3uz.js","./DcxZIiHI.js","./COI23b-1.js","./BQjuU1b_.js","./DJ9SNVgt.js","./CgMDXot0.js","./CZsOHrUj.js"])))=>i.map(i=>d[i]);
import{d as R,i as M,c as h,F as $,C as Z,o as n,k as L,v as C,t as l,x as w,aW as G,s as ee,j as P,q as e,aq as J,R as V,U as B,ap as te,f as z,r as k,au as oe,aK as H,m as d,l as y,B as se,y as D,p as ne,_ as W,cE as le,bS as ae,aX as K,ag as Q,A as ie,cF as re,z as ce,cG as ue,e as de,n as me}from"#entry";import{_ as X}from"./CGkf3lDq.js";import{L as pe}from"./B_bYPYFo.js";import{_ as _e}from"./q_YSI2Sf.js";import ge from"./CDSfhndf.js";import{_ as fe}from"./Brlt-NDg.js";import{_ as he}from"./Ds48qA85.js";import{M as q}from"./BvBcSqjy.js";import{c as ye,a as Y}from"./BUyfW8JT.js";import{s as ve}from"./BzLCLO6P.js";import{u as be}from"./CIZXtYrT.js";const T={BIND:"bind-login",SUCCESS:"success-login"},b={CODE_ERROR:-1,INVALID:0,NORMAL:1,SCANNED_CODE:2,LOGIN_FAIL:3,LOGIN_SUCCESS:4},xe={LOGIN:"YZMDL",BIND_MOBILE:"BDSJHM",CHANGE_MOBILE:"BGSJHM",FIND_PASSWORD:"ZHDLMM",REGISTER:"YZMZC"},Se={class:"footer-copyright flex items-center justify-center gap-4 py-4"},Ce=["href"],Le=R({__name:"footer-copyright",props:{copyright:{}},setup(U){const i=U,p=M(()=>i.copyright||[]);return(_,g)=>{const m=G;return n(),h("footer",Se,[(n(!0),h($,null,Z(p.value,s=>(n(),h("a",{key:s.url,class:"hover:text-primary-500 flex items-center gap-1 text-xs text-gray-500 transition-colors",href:s.url,target:"_blank",rel:"noopener noreferrer"},[s.iconUrl?(n(),L(m,{key:0,src:s.iconUrl,alt:s.displayName,class:"inline-block h-4 w-4 align-middle"},null,8,["src","alt"])):C("",!0),l("span",null,w(s.displayName),1)],8,Ce))),128))])}}}),F={ACCOUNT:1,WECHAT:3},we=R({__name:"account",emits:["success","update:showLoginMethods"],setup(U,{emit:i}){const p=V(()=>B(()=>import("./BEWfOabk.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28]),import.meta.url)),_=V(()=>B(()=>import("./CtvU5pWl.js"),__vite__mapDeps([29,2,16,17,18,19,30,31,8,10,4,32,14,6,33,11,34,12,5,35,20,22,23,36,37,15,25,26,27,1,3,7,9,13,21,24,28]),import.meta.url)),g=V(()=>B(()=>import("./COI23b-1.js"),__vite__mapDeps([38,2,16,17,18,19,30,31,8,10,4,32,14,6,33,11,34,12,5,35,20,22,23,36,37]),import.meta.url)),m=i,s=ee("account-login"),a={"account-login":_,"account-register":g,"account-forget":p};function f(u){s.value=u,m("update:showLoginMethods",u==="account-login")}function c(u){m("success",u)}return P(()=>{m("update:showLoginMethods",!0)}),(u,N)=>(n(),L(J(a[e(s)]),{key:e(s),onSuccess:c,onSwitchComponent:f},null,32))}}),ke={class:"p-8"},Ie={class:"mt-10"},Me=R({__name:"login-bind",emits:["updateStyle","update:showLoginMethods","success"],setup(U,{emit:i}){const p=i,_=te(),g=z(),m=k([{value:"中国大陆",label:"86"}]),s=k(m.value[0]),a=k({isCounting:!1,text:"获取验证码"}),f=ye({mobile:Y().min(8,"手机号不能少于11位").required("请输入手机号码"),code:Y().min(4,"验证码不能少于4位").required("请输入验证码")}),c=oe({mobile:"",code:""}),{lockFn:u,isLock:N}=H(async()=>{if(a.value.isCounting!==!0){a.value.text="正在发送中";try{await ae({scene:xe.BIND_MOBILE,mobile:c.mobile}),_.success("验证码已发送，请注意查收",{title:"发送成功"}),a.value.isCounting=!0;let o=60;a.value.text=`${o}s`;const t=ve(()=>{o--,a.value.text=`${o}s`,o===0&&(clearInterval(t),a.value.isCounting=!1,a.value.text="重新发送")},1e3)}catch{a.value.isCounting=!1,a.value.text="重新发送"}}}),{lockFn:x,isLock:O}=H(async()=>{try{await le({type:"bind",...c}),p("success",{token:g.token,hasBind:!0})}catch(o){console.error("绑定失败:",o)}});return P(()=>{p("updateStyle",{width:"400px",height:"330px"}),p("update:showLoginMethods",!1)}),(o,t)=>{const r=_e,E=X,I=ge,A=fe,v=W,j=he;return n(),h("div",ke,[d(e(q),{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{type:"tween",stiffness:300,damping:30}},{default:y(()=>[...t[4]||(t[4]=[l("h2",{class:"mb-2 text-2xl font-bold"},"绑定手机号",-1),l("p",{class:"text-muted-foreground mb-2 text-sm"},"请输入手机号码，我们将向您发送验证码",-1)])]),_:1}),d(e(q),{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{type:"tween",stiffness:300,damping:30,delay:.4},class:"relative"},{default:y(()=>[d(j,{schema:e(f),state:e(c),onSubmit:e(x)},{default:y(()=>[d(A,{label:"手机号",name:"mobile",required:""},{default:y(()=>[d(I,{modelValue:e(c).mobile,"onUpdate:modelValue":t[2]||(t[2]=S=>e(c).mobile=S),class:"w-full",size:"lg",placeholder:"请输入手机号码",autocomplete:"off",ui:{base:"!pl-24"}},{leading:y(()=>[l("div",{class:"flex items-center text-sm",onClick:t[1]||(t[1]=ne(()=>{},["stop","prevent"]))},[t[5]||(t[5]=l("span",{class:"mr-[1px] pb-[1px]"},"+",-1)),d(r,{modelValue:e(s),"onUpdate:modelValue":t[0]||(t[0]=S=>se(s)?s.value=S:null),"trailing-icon":"heroicons:chevron-up-down-20-solid",ui:{base:"!ring-0",content:"z-999 w-34"},class:"w-16",items:e(m)},{item:y(({item:S})=>[D(w(S.value)+" +"+w(S.label),1)]),_:1},8,["modelValue","items"])]),d(E,{class:"h-1/2",orientation:"vertical"})]),_:1},8,["modelValue"])]),_:1}),d(A,{label:"验证码",name:"code",class:"mt-2",required:""},{default:y(()=>[d(I,{id:"code",modelValue:e(c).code,"onUpdate:modelValue":t[3]||(t[3]=S=>e(c).code=S),size:"lg",placeholder:"请输入验证码",autocomplete:"off",ui:{root:"w-full",trailing:"pr-0"}},{trailing:y(()=>[d(E,{class:"h-1/2",orientation:"vertical"}),d(v,{variant:"link",ui:{base:"w-[90px] justify-center"},disabled:e(N),onClick:e(u)},{default:y(()=>[D(w(e(a).text),1)]),_:1},8,["disabled","onClick"])]),_:1},8,["modelValue"])]),_:1}),l("div",Ie,[d(v,{color:"primary",type:"submit",size:"lg",ui:{base:"w-full justify-center"},loading:e(O)},{default:y(()=>[...t[6]||(t[6]=[D(" 立即绑定 ",-1)])]),_:1},8,["loading"])])]),_:1},8,["schema","state","onSubmit"])]),_:1})])}}}),Ne={class:"flex flex-col items-center justify-between"},Oe={class:"relative flex h-70 w-70 items-center justify-center overflow-hidden rounded-lg border p-1 dark:border-gray-700"},Ee={key:0,class:"h-70 w-70 animate-pulse rounded bg-gray-200 dark:bg-gray-700"},Ae={key:1,class:"absolute inset-0 z-30 flex flex-col items-center justify-center bg-white/40 backdrop-blur-sm dark:bg-gray-800/60"},Ue={key:2,class:"absolute inset-0 z-10 flex flex-col items-center justify-center bg-white/40 backdrop-blur-sm dark:bg-gray-800/60"},$e={class:"mb-3 text-sm text-gray-700 dark:text-gray-300"},De={class:"mt-2 mb-8 text-left"},Re=R({__name:"wechat",emits:["update:showLoginMethods","success"],setup(U,{emit:i}){const p=V(()=>B(()=>import("./BQjuU1b_.js"),__vite__mapDeps([39,2,40,41,9,42,5,12,34,8,13,18]),import.meta.url)),_=i,g=K(),m=z(),s=k(""),a=k(""),f=k(b.NORMAL),c=k(!1),u=M(()=>({[b.LOGIN_SUCCESS]:{icon:"i-lucide-check-circle",color:"text-green-500",message:"登录成功，正在跳转..."},[b.INVALID]:{icon:"i-lucide-alert-circle",color:"text-red-500",message:"二维码已过期，请刷新",showRefresh:!0},[b.LOGIN_FAIL]:{icon:"i-lucide-alert-circle",color:"text-red-500",message:"登录失败，请重试",showRefresh:!0},[b.CODE_ERROR]:{icon:"i-lucide-alert-circle",color:"text-red-500",message:"获取二维码失败，请重试",showRefresh:!0}})[f.value]||{message:"",icon:"",color:""}),{start:N,clear:x}=be(async t=>{if(!a.value){t();return}try{const r=await ue({key:a.value});r.is_scan&&(f.value=b.LOGIN_SUCCESS,x(),o(r.user))}catch(r){console.error("检查登录状态失败:",r),x(),f.value=b.INVALID}},{interval:2e3,maxWaitTime:300*1e3,onEnded:()=>{f.value===b.NORMAL&&(f.value=b.INVALID)}});async function O(){try{c.value=!0,x(),f.value=b.NORMAL;const t=await re();s.value=t.url,a.value=t.key||"",N()}catch(t){console.error("获取微信二维码失败:",t),f.value=b.CODE_ERROR}finally{c.value=!1}}function o(t){_("success",t)}return P(()=>{_("update:showLoginMethods",!0),O()}),Q(x),(t,r)=>{const E=G,I=ce,A=W;return n(),h("div",Ne,[r[3]||(r[3]=l("p",{class:"text-muted-foreground mb-4 text-sm"},"请使用微信扫描二维码登录",-1)),l("div",Oe,[c.value?(n(),h("div",Ee)):(n(),h($,{key:1},[s.value?(n(),L(E,{key:0,src:s.value,alt:"微信登录二维码",class:"pointer-events-none h-full w-full select-none"},null,8,["src"])):C("",!0),!e(m).isAgreed&&e(g).loginWay.loginAgreement&&e(g).loginSettings?.showPolicyAgreement?(n(),h("div",Ae,[d(I,{name:"i-lucide-alert-triangle",class:"mb-2 text-5xl text-yellow-500"}),r[1]||(r[1]=l("p",{class:"text-sm text-gray-700 dark:text-gray-300"},"请先阅读并勾选协议",-1))])):C("",!0),u.value.message?(n(),h("div",Ue,[d(I,{name:u.value.icon,class:ie([u.value.color,"mb-2 text-5xl"])},null,8,["name","class"]),l("p",$e,w(u.value.message),1),u.value.showRefresh?(n(),L(A,{key:0,size:"xs",onClick:O},{default:y(()=>[...r[2]||(r[2]=[D(" 刷新二维码 ",-1)])]),_:1})):C("",!0)])):C("",!0)],64))]),l("div",De,[e(g).loginSettings?.showPolicyAgreement?(n(),L(e(p),{key:0,modelValue:e(m).isAgreed,"onUpdate:modelValue":r[0]||(r[0]=v=>e(m).isAgreed=v)},null,8,["modelValue"])):C("",!0)])])}}}),Te={class:"login-container flex h-screen flex-col overflow-y-auto bg-[#f9f9f9] dark:bg-[#000]"},Ve={class:"fixed top-8 left-8 flex items-center"},Be={class:"ml-2 text-3xl font-bold"},Pe={class:"flex h-auto items-center justify-center pt-[15vh]"},je={class:"w-[370px] px-4"},Fe={class:"mb-8 space-y-3 text-center"},Ge={class:"text-3xl font-bold"},ze={class:"text-muted-foreground"},We={class:"flex flex-col justify-center gap-4"},He=R({__name:"index",setup(U){const i=K(),p=z(),{t:_}=de(),g=M(()=>({[F.ACCOUNT]:{component:we,icon:"tabler:lock",label:_("login.continueWithAccount")},[F.WECHAT]:{component:Re,icon:"tabler:brand-wechat",label:_("login.continueWithWechat")},[T.BIND]:{component:Me,icon:"",label:_("login.bindMobile")}})),m=i?.loginSettings?.defaultLoginMethod||F.ACCOUNT,s=k(m),a=k(!0),f=M(()=>Object.fromEntries(Object.entries(g.value).filter(([t])=>i?.loginSettings?.allowedLoginMethods.includes(Number(t))))),c=M(()=>Object.entries(f.value).filter(([o])=>o!==T.BIND&&o!==T.SUCCESS).map(([o,t])=>({name:o,...t}))),u=M(()=>g.value[s.value]?.component),N=M(()=>g.value[s.value]);function x(o){g.value[o]&&(s.value=o)}function O(o){if(i.loginWay.coerceMobile*1&&!o.hasBind&&!o.mobile){p.tempLogin(o.token),s.value=T.BIND;return}p.login(o.token)}return P(()=>{i.loginSettings||i.getLoginSettings()}),Q(()=>{p.isAgreed=!1}),(o,t)=>{const r=G,E=W,I=X,A=Le;return n(),h("div",Te,[l("h1",Ve,[e(i).siteConfig?.webinfo.logo?(n(),h($,{key:0},[d(r,{src:e(i).siteConfig?.webinfo.logo,alt:"Logo",class:"size-12"},null,8,["src"]),l("span",Be,w(e(i).siteConfig?.webinfo.name),1)],64)):(n(),L(e(pe),{key:1,class:"text-foreground h-8",filled:"",fontControlled:!1}))]),l("div",Pe,[l("div",je,[l("div",Fe,[l("h1",Ge,w(e(_)("login.title")),1),l("p",ze,w(e(_)("login.subtitle")),1)]),l("div",We,[(n(!0),h($,null,Z(e(c),(v,j)=>(n(),h($,{key:j},[v.name!=e(s)?(n(),L(E,{key:0,"leading-icon":v.icon,variant:"outline",color:"neutral",size:"lg",ui:{base:"flex-1 justify-center bg-transparent p-3"},onClick:S=>x(v.name)},{default:y(()=>[D(w(v.label),1)]),_:2},1032,["leading-icon","onClick"])):C("",!0)],64))),128))]),e(c).length>1?(n(),L(I,{key:0,label:o.$t("login.orLoginTo"),ui:{root:"py-5",label:"text-xs text-foreground/60"}},null,8,["label"])):C("",!0),l("div",null,[e(u)?(n(),L(J(e(u)),me({key:0},e(N),{onSuccess:O,onSwitchTo:x,"onUpdate:showLoginMethods":t[0]||(t[0]=v=>a.value=v)}),null,16)):C("",!0)]),d(A,{copyright:e(i).siteConfig?.copyright},null,8,["copyright"])])])])}}}),nt=Object.freeze(Object.defineProperty({__proto__:null,default:He},Symbol.toStringTag,{value:"Module"}));export{F as L,xe as S,nt as i};
