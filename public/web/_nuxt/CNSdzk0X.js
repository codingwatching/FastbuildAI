import{_ as D}from"./DyTskiS5.js";import K from"./BjYsydzc.js";import{aC as N,aB as Q,d as z,e as q,ap as G,s as v,r as x,w as k,j as H,c as R,o as U,t as a,v as M,m as s,x as c,q as o,B as C,l as n,y,_ as A}from"#entry";import F from"./CDSfhndf.js";import{_ as J}from"./CEOm-hjj.js";import{_ as L}from"./Bjbrn0__.js";import"./DoL5-2Ox.js";import"./DVSiT9pd.js";import"./D_1uxSdv.js";const O=()=>N("/recharge-config"),W=V=>Q("/recharge-config",V),X={class:"my-px space-y-4 pb-6"},Y={class:"flex flex-col gap-6"},Z={class:""},ee={class:"mb-4 flex flex-col gap-1"},ae={class:"text-secondary-foreground text-md font-bold"},te={class:"text-muted-foreground text-xs"},le={key:0},re={class:"mb-4 flex flex-col gap-1"},oe={class:"text-secondary-foreground text-md font-bold"},se={class:"text-muted-foreground text-xs"},ne={class:"w-full text-sm"},ce={class:"flex-1"},ie={class:"flex w-full items-center justify-between"},de={class:"text-secondary-foreground text-md font-bold"},ue={class:"flex items-center justify-between gap-2 px-4"},ge={class:"mt-4"},me={class:"flex justify-end"},Ve=z({__name:"index",setup(V){const{t:l}=q(),P=G(),i=v(!0),g=v(!1),d=x([]),m=v(""),h=x(),S=[{id:"move",header:"#",size:40,enableSorting:!1,enableHiding:!1},{id:"rechargeValue",accessorKey:"rechargeValue",header:l("marketing.backend.recharge.tab.rechargeValue")},{id:"freeQuantity",accessorKey:"freeQuantity",header:l("marketing.backend.recharge.tab.freeQuantity")},{id:"price",accessorKey:"price",header:l("marketing.backend.recharge.tab.price")},{id:"label",accessorKey:"label",header:l("marketing.backend.recharge.tab.label")},{id:"action",header:l("marketing.backend.recharge.tab.action"),size:40,enableSorting:!1,enableHiding:!1}],w=async()=>{const r=await O();h.value=r,d.value=r.rechargeRule.map(t=>({...t})),i.value=r.rechargeStatus,m.value=r.rechargeExplain},$=()=>{const r=x({givePower:0,label:"",power:0,sellPrice:0});d.value.push(r.value)},B=r=>{d.value=d.value.filter(t=>t!==r)},E=async()=>{try{await W({rechargeRule:d.value,rechargeStatus:i.value,rechargeExplain:m.value}),w(),P.success(l("marketing.backend.recharge.saveSuccess"))}catch(r){console.error(r)}};k(i,()=>{i.value!==h.value?.rechargeStatus?g.value=!0:g.value=!1}),k(m,()=>{m.value!==h.value?.rechargeExplain?g.value=!0:g.value=!1});const T=(r,t)=>!t||r.length!==t.length?!1:r.every((f,p)=>!(f?.power!==t[p]?.power||f?.givePower!==t[p]?.givePower||f?.sellPrice!==t[p]?.sellPrice||f?.label!==t[p]?.label));return k(d,()=>{T(d.value,h.value?.rechargeRule)?g.value=!1:g.value=!0},{deep:!0}),H(()=>w()),(r,t)=>{const f=D,p=K,b=A,_=F,j=J,I=L;return U(),R("div",X,[a("div",Y,[a("div",Z,[a("div",null,[a("div",ee,[a("div",ae,c(o(l)("marketing.backend.recharge.statusTitle")),1),a("div",te,c(o(l)("marketing.backend.recharge.statusDescription")),1)]),s(f,{modelValue:o(i),"onUpdate:modelValue":t[0]||(t[0]=e=>C(i)?i.value=e:null)},null,8,["modelValue"])])]),o(i)?(U(),R("div",le,[a("div",re,[a("div",oe,c(o(l)("marketing.backend.recharge.rechargeInstructionsTitle")),1),a("div",se,c(o(l)("marketing.backend.recharge.rechargeInstructionsDescription")),1)]),a("div",ne,[s(p,{class:"w-full",modelValue:o(m),"onUpdate:modelValue":t[1]||(t[1]=e=>C(m)?m.value=e:null),rows:6,placeholder:"请输入套餐充值说明..."},null,8,["modelValue"])])])):M("",!0),a("div",ce,[a("div",ie,[a("div",de,c(o(l)("marketing.backend.recharge.rechargeRulesTitle")),1),a("div",ue,[s(b,{color:"primary",variant:"outline",icon:"tabler:plus",ui:{leadingIcon:"size-4"},onClick:$},{default:n(()=>[y(c(o(l)("marketing.backend.recharge.button.new")),1)]),_:1})])]),a("div",ge,[s(j,{ref:"table",data:o(d),columns:S,ui:{base:"table-fixed border-separate border-spacing-0",thead:"[&>tr]:bg-elevated/50 [&>tr]:after:content-none",tbody:"[&>tr]:last:[&>td]:border-b-0",th:"py-2 first:rounded-l-lg last:rounded-r-lg border-y border-default first:border-l last:border-r",td:"border-b border-default",tr:"[&:has(>td[colspan])]:hidden"}},{"move-cell":n(({row:e})=>[y(c(e.index+1),1)]),"rechargeValue-cell":n(({row:e})=>[s(_,{modelValue:e.original.power,"onUpdate:modelValue":u=>e.original.power=u,type:"number"},null,8,["modelValue","onUpdate:modelValue"])]),"freeQuantity-cell":n(({row:e})=>[s(_,{modelValue:e.original.givePower,"onUpdate:modelValue":u=>e.original.givePower=u,type:"number"},null,8,["modelValue","onUpdate:modelValue"])]),"price-cell":n(({row:e})=>[s(_,{modelValue:e.original.sellPrice,"onUpdate:modelValue":u=>e.original.sellPrice=u,type:"number",min:"0",step:"0.01",ui:{trailing:"bg-muted-foreground/15 pl-2 rounded-tr-lg rounded-br-lg"}},{trailing:n(()=>[a("span",null,c(o(l)("marketing.backend.recharge.tab.priceUnit")),1)]),_:1},8,["modelValue","onUpdate:modelValue"])]),"label-cell":n(({row:e})=>[s(_,{modelValue:e.original.label,"onUpdate:modelValue":u=>e.original.label=u},null,8,["modelValue","onUpdate:modelValue"])]),"action-cell":n(({row:e})=>[s(b,{icon:"tabler:trash",color:"error",variant:"ghost",onClick:u=>B(e.original)},null,8,["onClick"])]),_:1},8,["data"])])]),a("div",me,[s(I,{codes:["recharge-config:setConfig"]},{default:n(()=>[s(b,{color:"primary",disabled:!o(g),ui:{base:"w-16 flex justify-center items-center"},onClick:E},{default:n(()=>[y(c(o(l)("marketing.backend.recharge.button.save")),1)]),_:1},8,["disabled"])]),_:1})])])])}}});export{Ve as default};
