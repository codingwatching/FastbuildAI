import{d as T,e as V,r as h,au as U,aK as w,j as G,k as C,o as n,l,c,q as a,m as r,z as O,t,x as o,v as _,y as p,F as R,C as q,A as E,_ as J}from"#entry";import{_ as K}from"./BixMXl5t.js";import{_ as H}from"./B-p4_8pw.js";import{_ as Q}from"./C7KE9iN2.js";import{_ as W}from"./DRoDiArK.js";import{_ as X}from"./CR9qioUt.js";import{_ as Y}from"./BYm23QKU.js";import{a as Z,b as tt}from"./mlvoFkx6.js";import{e as et}from"./Bni8bPEl.js";import"./BMSQkwth.js";import"./DaWZu8wl.js";import"./BRI4D6WA.js";import"./DlAUqK2U.js";import"./DGUAW_1C.js";import"./DDJ79SjH.js";import"./Ti3HjCpC.js";import"./DegKy-XA.js";import"./B1TeSxwV.js";import"./RmzZBBRE.js";import"./C4jlvBh2.js";import"./C-XPfH0G.js";import"./7d3iyZ8h.js";const ot={key:0,class:"flex items-center justify-center",style:{height:"644px"}},st={key:1,class:"space-y-6"},at={class:"bg-muted rounded-lg p-4"},nt={class:"grid grid-cols-1 gap-4 md:grid-cols-2"},rt={class:"text-accent-foreground text-sm font-medium"},it={class:"text-secondary-foreground mt-1 text-sm"},ct={class:"text-accent-foreground text-sm font-medium"},dt={class:"text-secondary-foreground mt-1 text-sm"},lt={class:"text-accent-foreground text-sm font-medium"},mt={class:"text-secondary-foreground mt-1 text-sm"},ut={class:"text-accent-foreground text-sm font-medium"},_t={class:"text-secondary-foreground mt-1 text-sm"},pt={class:"mt-3 flex gap-2"},ft={class:"mb-3 text-lg font-semibold"},ht={class:"space-y-4"},gt={class:"mb-2 flex items-center justify-between"},xt={class:"flex items-center gap-2"},kt={class:"text-muted-foreground flex items-center gap-4 text-xs"},yt={key:0,class:"flex items-center gap-1"},bt={key:1,class:"flex items-center gap-1"},vt={key:2,class:"flex items-center gap-1"},$t={class:"prose prose-sm dark:prose-invert max-w-none"},wt={key:0,class:"mt-3 border-t border-gray-100 pt-3 dark:border-gray-600"},Ct={class:"text-xs"},Mt={class:"text-muted-foreground cursor-pointer"},Bt={class:"text-accent-foreground mt-2"},Ft={key:2,class:"py-8 text-center"},Lt={class:"text-muted-foreground"},St={class:"flex justify-end"},Zt=T({__name:"detail",props:{conversationId:{}},emits:["close"],setup(M,{emit:B}){const g=M,x=B,{t:m}=V(),d=h(null),f=h([]),k=h(!0),y=U({page:0,pageSize:15}),{lockFn:F,isLock:L}=w(async()=>{try{d.value=await Z(g.conversationId)}catch(e){console.error("获取对话详情失败:",e)}}),{lockFn:b,isLock:v}=w(async()=>{try{y.page+=1;const e=await tt(g.conversationId,y),i=e.items.reverse();f.value.push(...i),k.value=e.total>f.value.length}catch(e){console.error("获取消息列表失败:",e)}});function S(e,i={name:m("ai-chat.backend.roles.assistant")}){return{user:m("ai-chat.backend.roles.user"),assistant:i.name}[e]||e}function I(e){return{user:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200",assistant:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200"}[e]||"bg-gray-100 text-gray-800"}return G(async()=>await Promise.all([F(),b()])),(e,i)=>{const u=O,$=K,j=H,z=Q,A=W,D=X,N=J,P=Y;return n(),C(P,{dismissible:!0,title:e.$t("ai-chat.backend.detail.title"),description:e.$t("ai-chat.backend.detail.description"),ui:{content:"max-w-4xl",body:"max-h-[80vh] overflow-y-auto"},onClose:i[1]||(i[1]=s=>x("close"))},{footer:l(()=>[t("div",St,[r(N,{color:"neutral",variant:"soft",onClick:i[0]||(i[0]=s=>x("close"))},{default:l(()=>[p(o(e.$t("console-common.close")),1)]),_:1})])]),default:l(()=>[a(L)&&a(v)?(n(),c("div",ot,[r(u,{name:"i-lucide-loader-2",class:"size-8 animate-spin"})])):a(d)?(n(),c("div",st,[t("div",at,[t("div",nt,[t("div",null,[t("label",rt,o(e.$t("ai-chat.backend.detail.chatTitle")),1),t("p",it,o(a(d).title),1)]),t("div",null,[t("label",ct,o(e.$t("ai-chat.backend.detail.user")),1),t("p",dt,o(a(d)?.user?.nickname||a(d)?.user?.username),1)]),t("div",null,[t("label",lt,o(e.$t("ai-chat.backend.detail.messageCount")),1),t("p",mt,o(a(d).messageCount),1)]),t("div",null,[t("label",ut,o(e.$t("console-common.createAt")),1),t("p",_t,[r($,{datetime:a(d).createdAt,mode:"datetime"},null,8,["datetime"])])])]),t("div",pt,[a(d).isPinned?(n(),C(j,{key:0,color:"warning",size:"sm",icon:"i-lucide-pin"},{default:l(()=>[p(o(e.$t("ai-chat.backend.detail.isPinned")),1)]),_:1})):_("",!0)])]),t("div",null,[t("h3",ft,o(e.$t("ai-chat.backend.detail.messages"))+" ("+o(a(f).length)+") ",1),t("div",ht,[r(D,{class:"h-full min-h-0 w-full"},{default:l(()=>[r(A,{threshold:300,loading:a(v),"has-more":a(k),onLoadMore:a(b)},{default:l(()=>[(n(!0),c(R,null,q(a(f),s=>(n(),c("div",{key:s.id,class:"mb-4 rounded-lg border border-gray-200 p-4 dark:border-gray-700"},[t("div",gt,[t("div",xt,[t("span",{class:E([I(s.role),"rounded-full px-2 py-1 text-xs font-medium"])},o(S(s.role,s.model)),3),r($,{datetime:s.createdAt,mode:"datetime",class:"text-muted-foreground text-xs"},null,8,["datetime"])]),t("div",kt,[s.userConsumedPower!==void 0&&s.role==="assistant"?(n(),c("span",yt,[r(u,{name:"i-lucide-hash",class:"h-3 w-3"}),p(" "+o(a(m)("ai-chat.backend.detail.total"))+" "+o(s.userConsumedPower||0)+" "+o(a(m)("common.power")),1)])):_("",!0),s.tokens?(n(),c("span",bt,[r(u,{name:"i-lucide-hash",class:"h-3 w-3"}),p(" "+o(a(m)("ai-chat.backend.detail.total"))+" "+o(s.tokens.total_tokens)+" Tokens ",1)])):_("",!0),s.cost?(n(),c("span",vt,[r(u,{name:"i-lucide-dollar-sign",class:"h-3 w-3"}),p(" $"+o(s.cost.toFixed(6)),1)])):_("",!0)])]),t("div",$t,[r(z,{content:s.role==="user"?a(et)(s.content):s.content.toString()},null,8,["content"])]),s.metadata&&Object.keys(s.metadata).length>0?(n(),c("div",wt,[t("details",Ct,[t("summary",Mt,o(e.$t("ai-chat.backend.detail.metadata")),1),t("pre",Bt,o(JSON.stringify(s.metadata,null,2)),1)])])):_("",!0)]))),128))]),_:1},8,["loading","has-more","onLoadMore"])]),_:1})])])])):(n(),c("div",Ft,[t("p",Lt,o(e.$t("ai-chat.backend.detail.notFound")),1)]))]),_:1},8,["title","description"])}}});export{Zt as default};
