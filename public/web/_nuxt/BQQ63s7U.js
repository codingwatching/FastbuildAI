import{d as A,aM as B,n as r,b2 as L,l as m,p as k,J as x,q as N,ai as C,c as I,f as F,g as n,x as _,y as W,t as j,G as D,b3 as M,o as y,aK as V}from"#entry";import{a as G}from"./itKTsrtZ.js";const P={key:0,class:"relative h-full w-full"},T=["src","title"],q={key:0,class:"absolute inset-0 z-999999 flex items-center justify-center bg-[#f8f9fa] text-inherit dark:bg-[#121212] dark:text-[#ddd]"},J={class:"flex flex-col items-center gap-6"},K={class:"flex size-[240px] items-center justify-center"},S={class:"animate-[pulse_1.5s_ease-in-out_infinite] drop-shadow-[0_0_12px_rgba(81,10,252,0.2)] motion-reduce:animate-none dark:drop-shadow-[0_0_12px_rgba(81,10,252,0.35)]"},X=A({__name:"[...all]",async setup(H){let c,g;const u=B(),l=r(()=>u.path.includes("/console")),t=r(()=>l.value?"":u.fullPath.match(/\/app\/([^/]+)/)?.[1]||""),{data:d}=([c,g]=L(async()=>M(`extension-info-${t.value}`,async()=>{if(!t.value)return null;try{return await G(t.value)}catch(e){return console.error("[extension] Failed to load extension info:",e),null}},{default:()=>null,watch:[t]})),c=await c,g(),c),w=r(()=>d.value?.aliasIcon||d.value?.icon||""),U=r(()=>d.value?.alias||d.value?.name||t.value||"Extension"),p=r(()=>{const e=u.params.all;return Array.isArray(e)&&e.length>1?e.slice(1).join("/"):""}),z=r(()=>{const e=`/extension/${t.value}/`;return p.value?`${e}${p.value}`:e}),s=m(null),h=m(!1),f=m(!1),v=m(!0),$=e=>e?`/app/${t.value}/${e}`:`/app/${t.value}`,b=e=>{u.path!==e&&(f.value=!0,window.history.replaceState({...window.history.state},"",e),x(()=>{f.value=!1}))},E=()=>{if(!(l.value||!s.value?.contentWindow||h.value||f.value))try{const{pathname:e,search:a,hash:i}=s.value.contentWindow.location,o=(e+a+i).match(/^\/extension\/[^/]+\/(.*)$/);b($(o?.[1]||""))}catch{}},R=()=>{v.value=!1,x(E)};return k(()=>p.value,e=>{if(l.value||!s.value||f.value)return;const a=e?`/extension/${t.value}/${e}`:`/extension/${t.value}/`;s.value.src.endsWith(a)||(h.value=!0,v.value=!0,s.value.src=a,x(()=>{h.value=!1}))}),k(()=>t.value,()=>{l.value||(v.value=!0)}),N(()=>{const e=a=>{const{type:i,path:o}=a.data||{};i!=="extension-navigation"||o.startsWith("console")||b($(o))};window.addEventListener("message",e),C(()=>window.removeEventListener("message",e))}),(e,a)=>{const i=D,o=V;return n(l)?(y(),F(o,{key:1})):(y(),I("div",P,[_("iframe",{ref_key:"iframeRef",ref:s,src:n(z),class:"h-full w-full border-0",title:`Extension Frontend: ${n(t)}`,loading:"eager",onLoad:R},null,40,T),n(v)?(y(),I("div",q,[_("div",J,[_("div",K,[_("div",S,[j(i,{src:n(w)||void 0,alt:n(U),icon:"i-lucide-puzzle",ui:{root:`size-12 rounded-xl ${n(w)?"":"bg-primary"}`,icon:"size-6 text-white"}},null,8,["src","alt","ui"])])])])])):W("",!0)]))}}});export{X as default};
