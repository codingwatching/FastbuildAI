import{d as E,e as K,ap as O,s as T,r as H,i as J,aK as k,j as Q,k as W,o as a,l as v,c as d,t as u,q as o,m as c,z as X,x as p,y as _,_ as Y,v as Z,F as z,C as B}from"#entry";import{_ as ee}from"./DJ9SNVgt.js";import{_ as se}from"./BYm23QKU.js";import{b as oe}from"./B3Cet3zC.js";import{a as te,b as ie}from"./CthPp3Zu.js";import"./CgMDXot0.js";import"./DVSiT9pd.js";import"./CZsOHrUj.js";import"./DegKy-XA.js";import"./DaC7Nksz.js";import"./cwT2REE1.js";import"./CXk2IlXx.js";import"./D_1uxSdv.js";import"./DoL5-2Ox.js";import"./DGUAW_1C.js";import"./DDJ79SjH.js";import"./Ti3HjCpC.js";import"./B1TeSxwV.js";import"./RmzZBBRE.js";import"./C4jlvBh2.js";import"./C-XPfH0G.js";import"./7d3iyZ8h.js";const ne={key:0,class:"flex items-center justify-center",style:{height:"544px"}},le={key:1},re={class:"mb-4 flex items-center justify-between"},ae={class:"text-muted-foreground text-sm"},ce={class:"flex gap-2"},me={class:"max-h-[40vh] overflow-y-auto"},de={class:"mb-2 flex items-center"},ue={class:"ml-6 grid grid-cols-1 gap-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4"},pe={key:0,class:"text-muted-foreground py-4 text-center"},fe={class:"mt-4 flex justify-end gap-2"},De=E({__name:"assign-permissions",props:{id:{}},emits:["close"],setup(G,{emit:L}){const g=G,y=L,{t:n}=K(),x=O(),m=T([]),t=H([]),h=J(()=>m.value.flatMap(e=>e.permissions?.map(s=>s.id).filter(Boolean)??[]));function P(e){t.value.includes(e)||t.value.push(e)}function b(e){const s=t.value.indexOf(e);s!==-1&&t.value.splice(s,1)}function S(e){t.value.includes(e)?b(e):P(e)}function U(){t.value=[...h.value]}function F(){t.value=[]}function I(){t.value=h.value.filter(e=>!t.value.includes(e))}const{lockFn:$,isLock:C}=k(async()=>{try{const e=await oe({isDeprecated:!1,isGrouped:!0});m.value=e}catch(e){console.error("加载权限列表失败:",e)}}),{lockFn:A,isLock:w}=k(async()=>{if(g.id)try{const e=await te(g.id);t.value=e.permissions?.map(s=>s.id)??[]}catch(e){console.error("加载角色详情失败:",e)}}),{isLock:D,lockFn:N}=k(async()=>{if(!g.id){x.error(n("system-perms.role.roleIdRequired"));return}try{await ie({id:g.id,permissionIds:t.value}),x.success(n("system-perms.role.assignPermissionsSuccess")),y("close",!0)}catch(e){console.error("分配权限失败:",e)}});function j(e,s){const l=m.value.find(i=>i.code===e);l&&l.permissions.forEach(i=>{s?P(i.id):b(i.id)})}function M(e){const s=m.value.find(l=>l.code===e);return!s||!s.permissions.length?!1:s.permissions.every(l=>t.value.includes(l.id))}function R(e){const s=m.value.find(i=>i.code===e);if(!s||!s.permissions.length)return!1;const l=s.permissions.filter(i=>t.value.includes(i.id)).length;return l>0&&l<s.permissions.length}return Q(async()=>{await Promise.all([$(),A()])}),(e,s)=>{const l=X,i=Y,V=ee,q=se;return a(),W(q,{title:o(n)("system-perms.role.assignPermissions"),description:o(n)("system-perms.role.assignPermissionsDesc"),ui:{content:"max-w-3xl"},onClose:s[1]||(s[1]=r=>y("close",!1))},{default:v(()=>[o(w)||o(C)?(a(),d("div",ne,[c(l,{name:"i-lucide-loader-2",class:"size-8 animate-spin"})])):(a(),d("div",le,[u("div",re,[u("div",ae,p(o(n)("system-perms.role.totalPermissions",{count:o(h).length})),1),u("div",ce,[c(i,{size:"sm",color:"primary",variant:"soft",onClick:U},{default:v(()=>[_(p(o(n)("console-common.selectAll")),1)]),_:1}),c(i,{size:"sm",color:"info",variant:"soft",onClick:F},{default:v(()=>[_(p(o(n)("console-common.selectNone")),1)]),_:1}),c(i,{size:"sm",color:"info",variant:"soft",onClick:I},{default:v(()=>[_(p(o(n)("system-perms.role.invertSelection")),1)]),_:1})])]),u("div",me,[(a(!0),d(z,null,B(o(m),r=>(a(),d("div",{key:r.code,class:"mb-6"},[u("div",de,[c(V,{"model-value":M(r.code)?!0:R(r.code)?"indeterminate":!1,label:r.name,"onUpdate:modelValue":f=>j(r.code,f===!0)},null,8,["model-value","label","onUpdate:modelValue"])]),u("div",ue,[(a(!0),d(z,null,B(r.permissions,f=>(a(),d("div",{key:f.id,class:"flex items-center"},[c(V,{"model-value":o(t).includes(f.id),label:f.name,"onUpdate:modelValue":()=>S(f.id)},null,8,["model-value","label","onUpdate:modelValue"])]))),128))])]))),128)),o(m).length===0?(a(),d("div",pe,p(o(n)("system-perms.role.noPermissions")),1)):Z("",!0)])])),u("div",fe,[c(i,{color:"neutral",variant:"soft",size:"lg",onClick:s[0]||(s[0]=r=>y("close",!1))},{default:v(()=>[_(p(o(n)("console-common.cancel")),1)]),_:1}),c(i,{color:"primary",size:"lg",loading:o(D),disabled:o(w)||o(C),onClick:o(N)},{default:v(()=>[_(p(o(n)("console-common.confirm")),1)]),_:1},8,["loading","disabled","onClick"])])]),_:1},8,["title","description"])}}});export{De as default};
