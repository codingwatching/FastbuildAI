import{d as M,e as E,ap as A,s as b,au as C,j as S,k,o as i,l as g,t,c as l,aW as T,m as p,z as q,x as c,q as s,F as D,C as G,v as P,y as w,_ as R}from"#entry";import{_ as W}from"./B-p4_8pw.js";import{_ as H}from"./BhyXixVX.js";import{_ as J}from"./BYm23QKU.js";import{h as K,i as O}from"./BdGqAD-s.js";import"./CDSfhndf.js";import"./CR9qioUt.js";import"./BRI4D6WA.js";import"./DlAUqK2U.js";import"./CvZB4bI9.js";import"./KiG0a5S-.js";import"./CXk2IlXx.js";import"./kRIii9yh.js";import"./DBwQYu6J.js";import"./B1TeSxwV.js";import"./C6Y-ieo6.js";import"./Ti3HjCpC.js";import"./CyS2mNdj.js";import"./BaKvIqXP.js";import"./cwT2REE1.js";import"./DaC7Nksz.js";import"./DegKy-XA.js";import"./DnFVE45b.js";import"./B0g9CpkI.js";import"./DGUAW_1C.js";import"./DDJ79SjH.js";import"./RmzZBBRE.js";import"./C4jlvBh2.js";import"./C-XPfH0G.js";import"./7d3iyZ8h.js";const Q={class:"space-y-4"},X={class:"bg-muted/30 flex items-center gap-3 rounded-lg p-3"},Y={key:1,class:"bg-primary/10 flex h-10 w-10 items-center justify-center rounded-lg"},Z={class:"font-medium"},ee={class:"text-muted-foreground text-sm"},te={key:0,class:"flex items-center justify-center py-12"},oe={key:1,class:"text-muted-foreground flex flex-col items-center justify-center py-12"},se={class:"text-sm"},ne={key:2,class:"space-y-3"},ie={class:"mb-3"},ae={class:"flex items-center gap-2"},ce={class:"font-medium"},re={key:0,class:"text-muted-foreground mt-1 text-sm"},le={class:"flex items-center gap-3"},de={class:"min-w-0 flex-1"},me={class:"text-muted-foreground mt-2 text-xs"},Ge=M({__name:"feature-config",props:{extension:{}},emits:["close"],setup(r,{emit:B}){const L=r,$=B,{t:a}=E(),x=A(),u=b(!1),_=C({}),d=b([]),f=C({});async function F(){if(!u.value){u.value=!0;try{d.value=await K(L.extension.identifier),d.value.forEach(e=>{f[e.id]=e.membershipLevels.map(o=>o.id)})}catch(e){console.error("加载功能列表失败:",e),x.error(a("console-common.messages.failed"))}finally{u.value=!1}}}async function I(e){if(!_[e.id]){_[e.id]=!0;try{const o=f[e.id]||[],h=await O(e.id,o),m=d.value.findIndex(v=>v.id===e.id);m!==-1&&(d.value[m]=h),x.success(a("console-common.messages.success"))}catch(o){console.error("保存失败:",o),x.error(a("console-common.messages.failed"))}finally{_[e.id]=!1}}}function U(e,o){f[e]=Array.isArray(o)?o:o?[o]:[]}function V(){$("close")}return S(F),(e,o)=>{const h=T,m=q,v=W,j=H,z=R,N=J;return i(),k(N,{title:s(a)("extensions.featureConfig.title"),description:r.extension.name,ui:{content:"max-w-xl"},onClose:V},{default:g(()=>[t("div",Q,[t("div",X,[r.extension.icon?(i(),k(h,{key:0,src:r.extension.icon,alt:r.extension.name,class:"h-10 w-10 rounded-lg object-cover"},null,8,["src","alt"])):(i(),l("div",Y,[p(m,{name:"i-lucide-puzzle",class:"text-primary h-5 w-5"})])),t("div",null,[t("div",Z,c(r.extension.name),1),t("div",ee,c(r.extension.identifier),1)])]),s(u)?(i(),l("div",te,[p(m,{name:"i-lucide-loader-2",class:"text-muted-foreground h-6 w-6 animate-spin"})])):s(d).length?(i(),l("div",ne,[(i(!0),l(D,null,G(s(d),n=>(i(),l("div",{key:n.id,class:"border-border rounded-lg border p-4"},[t("div",ie,[t("div",ae,[t("span",ce,c(n.name),1),p(v,{variant:"soft",color:"neutral",size:"sm"},{default:g(()=>[w(c(n.featureCode),1)]),_:2},1024)]),n.description?(i(),l("p",re,c(n.description),1)):P("",!0)]),t("div",le,[t("div",de,[p(j,{"model-value":s(f)[n.id],multiple:"",placeholder:s(a)("extensions.featureConfig.levelPlaceholder"),"button-ui":{class:"w-full border border-border rounded-md"},"onUpdate:modelValue":y=>U(n.id,y)},null,8,["model-value","placeholder","onUpdate:modelValue"])]),p(z,{color:"primary",size:"sm",loading:s(_)[n.id],onClick:y=>I(n)},{default:g(()=>[w(c(s(a)("console-common.save")),1)]),_:1},8,["loading","onClick"])]),t("p",me,c(s(a)("extensions.featureConfig.levelTip")),1)]))),128))])):(i(),l("div",oe,[p(m,{name:"i-lucide-box",class:"mb-3 h-10 w-10 opacity-50"}),t("span",se,c(s(a)("extensions.featureConfig.empty")),1)]))])]),_:1},8,["title","description"])}}});export{Ge as default};
