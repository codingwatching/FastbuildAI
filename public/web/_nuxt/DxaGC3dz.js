const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./B3UlXW53.js","./D3sM9MCC.js","./n4aLOYdS.js","./2uNW2Gs5.js","./DxD6Ynfo.js","./CuVAPZQ8.js","./zlMhJk0P.js","./CZX-O16F.js","./CtosDvS0.js","./CAQVAH0V.js","./kRIii9yh.js","./D4e4FYoF.js","./CMKSl-Ng.js","./Deu6qIfg.js","./C6Y-ieo6.js","./shdu-Ndv.js","./cd55qm53.js","./D_3bTjYR.js","./D9sX2Qi6.js","./Iv8N83fp.js","./BtLy_Oaq.js","./D_1egFH-.js","./FTderXKt.js","./DaWZu8wl.js","./BzLCLO6P.js","./C9KJmhH1.js","./xjeLVIoz.js","./Bzv9SrOl.js","./B-cZF5FC.js","./aQpBHIRE.js","./Be9qZ8Md.js","./BKdtdX-7.js","./BhB8DUPm.js","./DeCyaT7k.js","./BCcN9pii.js","./psimjGaX.js","./BpDzXI85.js","./oxig-ZyS.js","./BNECID3R.js","./DIsObNTi.js","./Cuqwcq71.js","./CjasYwqF.js","./DBEJUH-Z.js"])))=>i.map(i=>d[i]);
import{d as T,n as M,c as h,F as D,E as Y,o as n,f as L,y as C,x as l,z as w,aZ as G,s as ee,q as P,g as e,au as J,W as V,X as B,at as te,j as z,l as k,a2 as oe,aN as H,t as d,w as y,D as se,A as $,v as ne,_ as W,cH as le,bU as ie,a_ as K,ai as Q,C as ae,cI as re,B as ce,cJ as ue,i as de,m as me}from"#entry";import{_ as X}from"./shdu-Ndv.js";import{L as pe}from"./C9KJmhH1.js";import{_ as _e}from"./D3sM9MCC.js";import ge from"./cd55qm53.js";import{_ as fe}from"./D_3bTjYR.js";import{_ as he}from"./BtLy_Oaq.js";import{M as q}from"./D_1egFH-.js";import{c as ye,b as Z}from"./FTderXKt.js";import{s as ve}from"./BzLCLO6P.js";import{u as be}from"./B-cZF5FC.js";const R={BIND:"bind-login",SUCCESS:"success-login"},b={CODE_ERROR:-1,INVALID:0,NORMAL:1,SCANNED_CODE:2,LOGIN_FAIL:3,LOGIN_SUCCESS:4},xe={LOGIN:"YZMDL",BIND_MOBILE:"BDSJHM",CHANGE_MOBILE:"BGSJHM",FIND_PASSWORD:"ZHDLMM",REGISTER:"YZMZC"},F={ACCOUNT:1,WECHAT:3},Se={class:"footer-copyright flex items-center justify-center gap-4 py-4"},Ce=["href"],Le=T({__name:"footer-copyright",props:{copyright:{}},setup(U){const a=U,p=M(()=>a.copyright||[]);return(_,g)=>{const m=G;return n(),h("footer",Se,[(n(!0),h(D,null,Y(p.value,s=>(n(),h("a",{key:s.url,class:"hover:text-primary-500 flex items-center gap-1 text-xs text-gray-500 transition-colors",href:s.url,target:"_blank",rel:"noopener noreferrer"},[s.iconUrl?(n(),L(m,{key:0,src:s.iconUrl,alt:s.displayName,class:"inline-block h-4 w-4 align-middle"},null,8,["src","alt"])):C("",!0),l("span",null,w(s.displayName),1)],8,Ce))),128))])}}}),we=T({__name:"account",emits:["success","update:showLoginMethods"],setup(U,{emit:a}){const p=V(()=>B(()=>import("./B3UlXW53.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28]),import.meta.url)),_=V(()=>B(()=>import("./aQpBHIRE.js"),__vite__mapDeps([29,2,16,17,18,19,30,31,8,10,4,32,14,6,33,11,34,12,5,35,20,22,23,36,37,15,25,26,27,1,3,7,9,13,21,24,28]),import.meta.url)),g=V(()=>B(()=>import("./BNECID3R.js"),__vite__mapDeps([38,2,16,17,18,19,30,31,8,10,4,32,14,6,33,11,34,12,5,35,20,22,23,36,37]),import.meta.url)),m=a,s=ee("account-login"),i={"account-login":_,"account-register":g,"account-forget":p};function f(u){s.value=u,m("update:showLoginMethods",u==="account-login")}function c(u){m("success",u)}return P(()=>{m("update:showLoginMethods",!0)}),(u,N)=>(n(),L(J(i[e(s)]),{key:e(s),onSuccess:c,onSwitchComponent:f},null,32))}}),ke={class:"p-8"},Ie={class:"mt-10"},Me=T({__name:"login-bind",emits:["updateStyle","update:showLoginMethods","success"],setup(U,{emit:a}){const p=a,_=te(),g=z(),m=k([{value:"中国大陆",label:"86"}]),s=k(m.value[0]),i=k({isCounting:!1,text:"获取验证码"}),f=ye({mobile:Z().min(8,"手机号不能少于11位").required("请输入手机号码"),code:Z().min(4,"验证码不能少于4位").required("请输入验证码")}),c=oe({mobile:"",code:""}),{lockFn:u,isLock:N}=H(async()=>{if(i.value.isCounting!==!0){i.value.text="正在发送中";try{await ie({scene:xe.BIND_MOBILE,mobile:c.mobile}),_.success("验证码已发送，请注意查收",{title:"发送成功"}),i.value.isCounting=!0;let o=60;i.value.text=`${o}s`;const t=ve(()=>{o--,i.value.text=`${o}s`,o===0&&(clearInterval(t),i.value.isCounting=!1,i.value.text="重新发送")},1e3)}catch{i.value.isCounting=!1,i.value.text="重新发送"}}}),{lockFn:x,isLock:O}=H(async()=>{try{await le({type:"bind",...c}),p("success",{token:g.token,hasBind:!0})}catch(o){console.error("绑定失败:",o)}});return P(()=>{p("updateStyle",{width:"400px",height:"330px"}),p("update:showLoginMethods",!1)}),(o,t)=>{const r=_e,E=X,I=ge,A=fe,v=W,j=he;return n(),h("div",ke,[d(e(q),{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{type:"tween",stiffness:300,damping:30}},{default:y(()=>[...t[4]||(t[4]=[l("h2",{class:"mb-2 text-2xl font-bold"},"绑定手机号",-1),l("p",{class:"text-muted-foreground mb-2 text-sm"},"请输入手机号码，我们将向您发送验证码",-1)])]),_:1}),d(e(q),{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{type:"tween",stiffness:300,damping:30,delay:.4},class:"relative"},{default:y(()=>[d(j,{schema:e(f),state:e(c),onSubmit:e(x)},{default:y(()=>[d(A,{label:"手机号",name:"mobile",required:""},{default:y(()=>[d(I,{modelValue:e(c).mobile,"onUpdate:modelValue":t[2]||(t[2]=S=>e(c).mobile=S),class:"w-full",size:"lg",placeholder:"请输入手机号码",autocomplete:"off",ui:{base:"!pl-24"}},{leading:y(()=>[l("div",{class:"flex items-center text-sm",onClick:t[1]||(t[1]=ne(()=>{},["stop","prevent"]))},[t[5]||(t[5]=l("span",{class:"mr-[1px] pb-[1px]"},"+",-1)),d(r,{modelValue:e(s),"onUpdate:modelValue":t[0]||(t[0]=S=>se(s)?s.value=S:null),"trailing-icon":"heroicons:chevron-up-down-20-solid",ui:{base:"!ring-0",content:"z-999 w-34"},class:"w-16",items:e(m)},{item:y(({item:S})=>[$(w(S.value)+" +"+w(S.label),1)]),_:1},8,["modelValue","items"])]),d(E,{class:"h-1/2",orientation:"vertical"})]),_:1},8,["modelValue"])]),_:1}),d(A,{label:"验证码",name:"code",class:"mt-2",required:""},{default:y(()=>[d(I,{id:"code",modelValue:e(c).code,"onUpdate:modelValue":t[3]||(t[3]=S=>e(c).code=S),size:"lg",placeholder:"请输入验证码",autocomplete:"off",ui:{root:"w-full",trailing:"pr-0"}},{trailing:y(()=>[d(E,{class:"h-1/2",orientation:"vertical"}),d(v,{variant:"link",ui:{base:"w-[90px] justify-center"},disabled:e(N),onClick:e(u)},{default:y(()=>[$(w(e(i).text),1)]),_:1},8,["disabled","onClick"])]),_:1},8,["modelValue"])]),_:1}),l("div",Ie,[d(v,{color:"primary",type:"submit",size:"lg",ui:{base:"w-full justify-center"},loading:e(O)},{default:y(()=>[...t[6]||(t[6]=[$(" 立即绑定 ",-1)])]),_:1},8,["loading"])])]),_:1},8,["schema","state","onSubmit"])]),_:1})])}}}),Ne={class:"flex flex-col items-center justify-between"},Oe={class:"relative flex h-70 w-70 items-center justify-center overflow-hidden rounded-lg border p-1 dark:border-gray-700"},Ee={key:0,class:"h-70 w-70 animate-pulse rounded bg-gray-200 dark:bg-gray-700"},Ae={key:1,class:"absolute inset-0 z-30 flex flex-col items-center justify-center bg-white/40 backdrop-blur-sm dark:bg-gray-800/60"},Ue={key:2,class:"absolute inset-0 z-10 flex flex-col items-center justify-center bg-white/40 backdrop-blur-sm dark:bg-gray-800/60"},De={class:"mb-3 text-sm text-gray-700 dark:text-gray-300"},$e={class:"mt-2 mb-8 text-left"},Te=T({__name:"wechat",emits:["update:showLoginMethods","success"],setup(U,{emit:a}){const p=V(()=>B(()=>import("./DIsObNTi.js"),__vite__mapDeps([39,2,40,41,9,42,5,12,34,8,13,18]),import.meta.url)),_=a,g=K(),m=z(),s=k(""),i=k(""),f=k(b.NORMAL),c=k(!1),u=M(()=>({[b.LOGIN_SUCCESS]:{icon:"i-lucide-check-circle",color:"text-green-500",message:"登录成功，正在跳转..."},[b.INVALID]:{icon:"i-lucide-alert-circle",color:"text-red-500",message:"二维码已过期，请刷新",showRefresh:!0},[b.LOGIN_FAIL]:{icon:"i-lucide-alert-circle",color:"text-red-500",message:"登录失败，请重试",showRefresh:!0},[b.CODE_ERROR]:{icon:"i-lucide-alert-circle",color:"text-red-500",message:"获取二维码失败，请重试",showRefresh:!0}})[f.value]||{message:"",icon:"",color:""}),{start:N,clear:x}=be(async t=>{if(!i.value){t();return}try{const r=await ue({key:i.value});r.is_scan&&(f.value=b.LOGIN_SUCCESS,x(),o(r.user))}catch(r){console.error("检查登录状态失败:",r),x(),f.value=b.INVALID}},{interval:2e3,maxWaitTime:300*1e3,onEnded:()=>{f.value===b.NORMAL&&(f.value=b.INVALID)}});async function O(){try{c.value=!0,x(),f.value=b.NORMAL;const t=await re();s.value=t.url,i.value=t.key||"",N()}catch(t){console.error("获取微信二维码失败:",t),f.value=b.CODE_ERROR}finally{c.value=!1}}function o(t){_("success",t)}return P(()=>{_("update:showLoginMethods",!0),O()}),Q(x),(t,r)=>{const E=G,I=ce,A=W;return n(),h("div",Ne,[r[3]||(r[3]=l("p",{class:"text-muted-foreground mb-4 text-sm"},"请使用微信扫描二维码登录",-1)),l("div",Oe,[c.value?(n(),h("div",Ee)):(n(),h(D,{key:1},[s.value?(n(),L(E,{key:0,src:s.value,alt:"微信登录二维码",class:"pointer-events-none h-full w-full select-none"},null,8,["src"])):C("",!0),!e(m).isAgreed&&e(g).loginWay.loginAgreement&&e(g).loginSettings?.showPolicyAgreement?(n(),h("div",Ae,[d(I,{name:"i-lucide-alert-triangle",class:"mb-2 text-5xl text-yellow-500"}),r[1]||(r[1]=l("p",{class:"text-sm text-gray-700 dark:text-gray-300"},"请先阅读并勾选协议",-1))])):C("",!0),u.value.message?(n(),h("div",Ue,[d(I,{name:u.value.icon,class:ae([u.value.color,"mb-2 text-5xl"])},null,8,["name","class"]),l("p",De,w(u.value.message),1),u.value.showRefresh?(n(),L(A,{key:0,size:"xs",onClick:O},{default:y(()=>[...r[2]||(r[2]=[$(" 刷新二维码 ",-1)])]),_:1})):C("",!0)])):C("",!0)],64))]),l("div",$e,[e(g).loginSettings?.showPolicyAgreement?(n(),L(e(p),{key:0,modelValue:e(m).isAgreed,"onUpdate:modelValue":r[0]||(r[0]=v=>e(m).isAgreed=v)},null,8,["modelValue"])):C("",!0)])])}}}),Re={class:"login-container flex h-screen flex-col overflow-y-auto bg-[#f9f9f9] dark:bg-[#000]"},Ve={class:"fixed top-8 left-8 flex items-center"},Be={class:"ml-2 text-3xl font-bold"},Pe={class:"flex h-auto items-center justify-center pt-[15vh]"},je={class:"w-[370px] px-4"},Fe={class:"mb-8 space-y-3 text-center"},Ge={class:"text-3xl font-bold"},ze={class:"text-muted-foreground"},We={class:"flex flex-col justify-center gap-4"},He=T({__name:"index",setup(U){const a=K(),p=z(),{t:_}=de(),g=M(()=>({[F.ACCOUNT]:{component:we,icon:"tabler:lock",label:_("login.continueWithAccount")},[F.WECHAT]:{component:Te,icon:"tabler:brand-wechat",label:_("login.continueWithWechat")},[R.BIND]:{component:Me,icon:"",label:_("login.bindMobile")}})),m=a?.loginSettings?.defaultLoginMethod||F.ACCOUNT,s=k(m),i=k(!0),f=M(()=>Object.fromEntries(Object.entries(g.value).filter(([t])=>a?.loginSettings?.allowedLoginMethods.includes(Number(t))))),c=M(()=>Object.entries(f.value).filter(([o])=>o!==R.BIND&&o!==R.SUCCESS).map(([o,t])=>({name:o,...t}))),u=M(()=>g.value[s.value]?.component),N=M(()=>g.value[s.value]);function x(o){g.value[o]&&(s.value=o)}function O(o){if(a.loginWay.coerceMobile*1&&!o.hasBind&&!o.mobile){p.tempLogin(o.token),s.value=R.BIND;return}p.login(o.token)}return P(()=>{a.loginSettings||a.getLoginSettings()}),Q(()=>{p.isAgreed=!1}),(o,t)=>{const r=G,E=W,I=X,A=Le;return n(),h("div",Re,[l("h1",Ve,[e(a).siteConfig?.webinfo.logo?(n(),h(D,{key:0},[d(r,{src:e(a).siteConfig?.webinfo.logo,alt:"Logo",class:"size-12"},null,8,["src"]),l("span",Be,w(e(a).siteConfig?.webinfo.name),1)],64)):(n(),L(e(pe),{key:1,class:"text-foreground h-8",filled:"",fontControlled:!1}))]),l("div",Pe,[l("div",je,[l("div",Fe,[l("h1",Ge,w(e(_)("login.title")),1),l("p",ze,w(e(_)("login.subtitle")),1)]),l("div",We,[(n(!0),h(D,null,Y(e(c),(v,j)=>(n(),h(D,{key:j},[v.name!=e(s)?(n(),L(E,{key:0,"leading-icon":v.icon,variant:"outline",color:"neutral",size:"lg",ui:{base:"flex-1 justify-center bg-transparent p-3"},onClick:S=>x(v.name)},{default:y(()=>[$(w(v.label),1)]),_:2},1032,["leading-icon","onClick"])):C("",!0)],64))),128))]),e(c).length>1?(n(),L(I,{key:0,label:o.$t("login.orLoginTo"),ui:{root:"py-5",label:"text-xs text-foreground/60"}},null,8,["label"])):C("",!0),l("div",null,[e(u)?(n(),L(J(e(u)),me({key:0},e(N),{onSuccess:O,onSwitchTo:x,"onUpdate:showLoginMethods":t[0]||(t[0]=v=>i.value=v)}),null,16)):C("",!0)]),d(A,{copyright:e(a).siteConfig?.copyright},null,8,["copyright"])])])])}}}),nt=Object.freeze(Object.defineProperty({__proto__:null,default:He},Symbol.toStringTag,{value:"Module"}));export{F as L,xe as S,nt as i};
