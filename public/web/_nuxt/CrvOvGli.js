import{aP as X,b2 as Z,g as k,bc as G,b9 as ee,b_ as te,j as p,o as l,k as m,t as b,c as d,C as J,z as L,F as B,B as U,aq as se,p as i,$ as oe,d as ae,b as le,ao as ne,f as I,ap as re,w as ie,i as ce,l as y,_ as ue,n as T,q as s,v as r,Y as de,y as fe,x as $,b$ as me}from"#entry";import pe from"./BruVSCWF.js";import{_ as ve}from"./B6GvGSfA.js";import{_ as ge}from"./Cif_tCX1.js";import{_ as ye}from"./DLMDXBaB.js";import{M as _e,j as he}from"./D9F45f3T.js";const xe={slots:{root:"inline-flex flex-row-reverse justify-end",base:"relative rounded-full ring-bg first:me-0"},variants:{size:{"3xs":{base:"ring -me-0.5"},"2xs":{base:"ring -me-0.5"},xs:{base:"ring -me-0.5"},sm:{base:"ring-2 -me-1.5"},md:{base:"ring-2 -me-1.5"},lg:{base:"ring-2 -me-1.5"},xl:{base:"ring-3 -me-2"},"2xl":{base:"ring-3 -me-2"},"3xl":{base:"ring-3 -me-2"}}},defaultVariants:{size:"md"}},be={__name:"AvatarGroup",props:{as:{type:null,required:!1},size:{type:null,required:!1},max:{type:[Number,String],required:!1},class:{type:null,required:!1},ui:{type:null,required:!1}},setup(S){const v=S,c=X(),N=Z(),z=k(()=>G({extend:G(xe),...N.ui?.avatarGroup||{}})({size:v.size})),n=k(()=>typeof v.max=="string"?Number.parseInt(v.max,10):v.max),_=k(()=>{let h=c.default?.();return h?.length&&(h=h.flatMap(o=>typeof o.type=="symbol"?typeof o.children=="string"?void 0:o.children:o).filter(Boolean)),h||[]}),x=k(()=>_.value.length?!n.value||n.value<=0?[..._.value].reverse():[..._.value].slice(0,n.value).reverse():[]),w=k(()=>_.value.length?_.value.length-x.value.length:0);return ee(te,k(()=>({size:v.size}))),(h,o)=>(l(),p(i(oe),{as:S.as,class:L(z.value.root({class:[v.ui?.root,v.class]}))},{default:m(()=>[w.value>0?(l(),p(J,{key:0,text:`+${w.value}`,class:L(z.value.base({class:v.ui?.base}))},null,8,["text","class"])):b("",!0),(l(!0),d(B,null,U(x.value,(M,C)=>(l(),p(se(M),{key:C,class:L(z.value.base({class:v.ui?.base}))},null,8,["class"]))),128))]),_:1},8,["as","class"]))}},ke={class:"flex items-center gap-1 truncate"},we={class:"hidden sm:block"},Ce={class:"flex items-center gap-2"},Le={class:"flex items-center"},ze={class:"bg-background max-h-[480px] w-90 overflow-hidden rounded-lg shadow-lg"},Me={class:"flex items-stretch gap-2 border-b p-3"},Ie={class:"grid grid-cols-1 gap-3 p-2"},Ve={key:0,class:"text-muted-foreground col-span-full py-10 text-center"},Se={key:1,class:"text-muted-foreground col-span-full py-10 text-center"},Ae={class:"max-h-70 space-y-2 overflow-y-auto"},$e={class:"space-y-1"},Be=["onClick"],Ue={class:"flex w-full flex-row items-center justify-between"},Ne={class:"flex flex-row items-center gap-2 space-y-0.5 overflow-hidden"},je={key:1,class:"bg-primary flex size-9 items-center justify-center rounded-md"},qe={class:"flex flex-1 flex-col overflow-hidden"},Oe={class:"text-secondary-foreground truncate text-sm font-medium"},Pe={key:0,class:"text-muted-foreground truncate text-xs"},De={key:1,class:"flex items-center gap-1 text-xs text-red-500"},Ee={class:"line-clamp-1"},Ge={class:"flex h-fit w-96 flex-col items-start gap-4 p-5"},Te={class:"flex flex-row justify-center gap-2"},Je={key:1,class:"bg-primary flex size-11 items-center justify-center rounded-lg"},Fe={class:"flex flex-col gap-1"},Ye={class:"text-secondary-foreground truncate text-sm font-medium"},Ke={key:1,class:"flex items-start gap-1 text-sm text-red-500"},Re={class:"bg-muted-foreground/10 w-full rounded-lg p-2"},He={class:"text-muted-foreground text-xs wrap-break-word"},Qe={key:0,class:"space-y-2"},We={class:"text-xs font-bold"},Xe={class:"flex flex-wrap gap-1"},Ze={class:"sticky bottom-0"},rt=ae({__name:"mcp-tool-select",props:{modelValue:{},disabled:{type:Boolean},showDescription:{type:Boolean,default:!0},defaultSelected:{type:Boolean,default:!0},console:{type:Boolean,default:!1},capability:{},modelId:{default:""},mcpIds:{},useCache:{type:Boolean,default:!0}},emits:["update:modelValue","change"],setup(S,{emit:v}){const{t:c}=le(),N=me(),z=ne(),n=S,_=v,x=I(!1),w=I(!1),h=I(""),o=I([]),M=I(_e.SYSTEM),C=I([]),F=re(),P=k(()=>{const a=h.value.trim().toLowerCase(),t=C.value.filter(g=>g.type===M.value);return a?t.filter(g=>[g.name,g.providerName,g.description].some(u=>u?.toLowerCase().includes(a))):t}),A=k(()=>(Array.isArray(o.value)?o.value:[]).filter(a=>C.value.some(t=>t.id===a))),Y=a=>{M.value=a,j()},j=async()=>{if(!x.value){if(x.value=!0,n.useCache)try{const a=JSON.parse(localStorage.getItem("mcpIds")||"[]");o.value=Array.isArray(a)?a:[]}catch{o.value=[]}else n.modelValue&&Array.isArray(n.modelValue)?o.value=[...n.modelValue]:o.value=[];try{const a=await he();C.value=a;const f=(Array.isArray(o.value)?o.value:[]).filter(g=>a.some(u=>u.id===g));f.length!==o.value.length&&(o.value=f)}catch(a){console.error("Failed to load MCP",a)}finally{x.value=!1}}};ie(()=>n.modelValue,a=>{if(!n.useCache&&a&&Array.isArray(a)){const t=a.filter(f=>typeof f=="string");JSON.stringify(t.sort())!==JSON.stringify(o.value.sort())&&(o.value=t)}},{immediate:!0,deep:!0}),ce(()=>{z.isLogin&&j()});function K(a){const t=o.value.indexOf(a.id);if(t>-1)o.value.splice(t,1);else{if(o.value.length===5){F.warning("为了保持性能，在当前的 MCP模式下，最多只能同时激活5个MCP 服务器。请在启用新的服务器之前关闭一些服务器。");return}o.value.push(a.id)}n.useCache&&localStorage.setItem("mcpIds",JSON.stringify(o.value)),_("update:modelValue",[...o.value]),_("change",o.value)}function R(){o.value=[],_("update:modelValue",[]),_("change",[]),w.value=!1,h.value="",n.useCache&&localStorage.removeItem("mcpIds")}const q=a=>C.value.find(t=>t.id===a);async function H(a){if(a){await j();const f=(Array.isArray(o.value)?o.value:[]).filter(g=>C.value.some(u=>u.id===g));f.length!==o.value.length&&(o.value=f)}}return(a,t)=>{const f=J,g=be,u=fe,O=ue,Q=pe,W=ve,D=ge,E=ye;return l(),p(E,{open:w.value,"onUpdate:open":[t[7]||(t[7]=e=>w.value=e),H],disabled:n.disabled},{content:m(()=>[s("div",ze,[s("div",Me,[y(Q,{modelValue:h.value,"onUpdate:modelValue":t[2]||(t[2]=e=>h.value=e),placeholder:i(c)("common.placeholder.mcpSelect"),size:"lg",ui:{root:"flex-1"}},{leading:m(()=>[y(u,{name:"i-lucide-search"})]),_:1},8,["modelValue","placeholder"]),y(O,{class:"w-fit",color:"primary",variant:"ghost",ui:{leadingIcon:"size-4"},icon:"i-lucide-rotate-ccw",onClick:t[3]||(t[3]=e=>o.value=[])},{default:m(()=>[$(r(i(c)("ai-mcp.frontend.reset")),1)]),_:1})]),s("div",Ie,[y(W,{color:"primary",variant:"link",content:!1,items:[{label:i(c)("common.tab.system"),value:"system"},{label:i(c)("common.tab.custom"),value:"user"}],"onUpdate:modelValue":[t[4]||(t[4]=e=>Y(e)),t[5]||(t[5]=e=>M.value=e)],modelValue:M.value,class:"w-full"},null,8,["items","modelValue"]),x.value?(l(),d("div",Ve,r(i(c)("common.loading"))+"... ",1)):P.value.length?b("",!0):(l(),d("div",Se,r(i(c)("common.empty")),1)),s("section",Ae,[s("ul",$e,[(l(!0),d(B,null,U(P.value,e=>(l(),d("li",{key:e.id,class:L(["group hover:bg-muted flex cursor-pointer items-center justify-between gap-2 rounded-md px-3 py-2 transition-colors",{"bg-secondary":o.value.includes(e.id),"cursor-not-allowed!":!e.connectable}]),onClick:V=>e.connectable&&K(e)},[y(E,{mode:"hover","open-delay":500,content:{align:"start",side:"right",sideOffset:20}},{content:m(()=>[s("div",Ge,[s("div",Te,[e.icon?(l(),p(f,{key:0,src:e.icon,alt:e.name,size:"2xl",class:"bg-secondary",ui:{image:"rounded-lg"}},null,8,["src","alt"])):(l(),d("div",Je,[...t[10]||(t[10]=[s("svg",{class:"size-9 text-white",viewBox:"0 0 195 195",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[s("path",{d:"M25 97.8528L92.8823 29.9706C102.255 20.598 117.451 20.598 126.823 29.9706V29.9706C136.196 39.3431 136.196 54.5391 126.823 63.9117L75.5581 115.177",stroke:"currentColor","stroke-width":"12","stroke-linecap":"round"}),s("path",{d:"M76.2653 114.47L126.823 63.9117C136.196 54.5391 151.392 54.5391 160.765 63.9117L161.118 64.2652C170.491 73.6378 170.491 88.8338 161.118 98.2063L99.7248 159.6C96.6006 162.724 96.6006 167.789 99.7248 170.913L112.331 183.52",stroke:"currentColor","stroke-width":"12","stroke-linecap":"round"}),s("path",{d:"M109.853 46.9411L59.6482 97.1457C50.2757 106.518 50.2757 121.714 59.6482 131.087V131.087C69.0208 140.459 84.2168 140.459 93.5894 131.087L143.794 80.8822",stroke:"currentColor","stroke-width":"12","stroke-linecap":"round"})],-1)])])),s("div",Fe,[s("p",Ye,r(e.alias||e.name),1),e.connectable?(l(),p(D,{key:0,size:"sm",class:"w-fit",color:"success"},{default:m(()=>[$(r(i(c)("ai-mcp.frontend.success")),1)]),_:1})):(l(),d("div",Ke,[y(u,{size:"20",name:"i-lucide-alert-octagon"}),s("p",null,r(e.connectError),1)]))])]),s("div",Re,[s("p",He,r(e.description||i(c)("ai-mcp.frontend.detail.noDescription")),1)]),e.connectable?(l(),d("div",Qe,[s("h2",We,r(i(c)("ai-mcp.frontend.detail.tools")),1),s("div",Xe,[(l(!0),d(B,null,U(e.tools,V=>(l(),p(D,{key:V.id,color:"neutral",variant:"outline"},{default:m(()=>[$(r(V.name),1)]),_:2},1024))),128))])])):b("",!0)])]),default:m(()=>[s("div",Ue,[s("div",Ne,[e.icon?(l(),p(f,{key:0,src:e.icon,alt:e.name,size:"lg",class:"bg-secondary",ui:{image:"rounded-md"}},null,8,["src","alt"])):(l(),d("div",je,[...t[9]||(t[9]=[s("svg",{class:"size-7 text-white",viewBox:"0 0 195 195",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[s("path",{d:"M25 97.8528L92.8823 29.9706C102.255 20.598 117.451 20.598 126.823 29.9706V29.9706C136.196 39.3431 136.196 54.5391 126.823 63.9117L75.5581 115.177",stroke:"currentColor","stroke-width":"12","stroke-linecap":"round"}),s("path",{d:"M76.2653 114.47L126.823 63.9117C136.196 54.5391 151.392 54.5391 160.765 63.9117L161.118 64.2652C170.491 73.6378 170.491 88.8338 161.118 98.2063L99.7248 159.6C96.6006 162.724 96.6006 167.789 99.7248 170.913L112.331 183.52",stroke:"currentColor","stroke-width":"12","stroke-linecap":"round"}),s("path",{d:"M109.853 46.9411L59.6482 97.1457C50.2757 106.518 50.2757 121.714 59.6482 131.087V131.087C69.0208 140.459 84.2168 140.459 93.5894 131.087L143.794 80.8822",stroke:"currentColor","stroke-width":"12","stroke-linecap":"round"})],-1)])])),s("div",qe,[s("p",Oe,r(e.alias||e.name),1),n.showDescription&&e.description?(l(),d("p",Pe,r(e.description),1)):b("",!0),e.connectError?(l(),d("div",De,[y(u,{size:"16",name:"i-lucide-alert-octagon"}),s("p",Ee,r(e.connectError),1)])):b("",!0)])]),o.value.includes(e.id)?(l(),p(u,{key:0,name:"i-lucide-check-circle",class:"text-primary flex-none",size:"lg"})):b("",!0)])]),_:2},1024)],10,Be))),128))]),s("div",Ze,[y(O,{color:"primary",variant:"subtle",class:"flex w-full items-center justify-center",onClick:t[6]||(t[6]=e=>i(N).push(`/profile/${i(z).userInfo?.id}/mcp-settings`))},{default:m(()=>[$(r(i(c)("ai-mcp.frontend.setMcp"))+" ",1),y(u,{name:"i-lucide-external-link"})]),_:1})])])])])]),default:m(()=>[y(O,{color:o.value.length>0?"primary":"neutral",variant:"ghost",ui:{leadingIcon:"size-4"},class:L({"bg-primary/10":A.value.length}),loading:x.value,disabled:n.disabled,onClick:t[1]||(t[1]=T(()=>{},["stop"]))},{default:m(()=>[s("span",ke,[t[8]||(t[8]=s("svg",{class:"size-4",viewBox:"0 0 195 195",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[s("path",{d:"M25 97.8528L92.8823 29.9706C102.255 20.598 117.451 20.598 126.823 29.9706V29.9706C136.196 39.3431 136.196 54.5391 126.823 63.9117L75.5581 115.177",stroke:"currentColor","stroke-width":"12","stroke-linecap":"round"}),s("path",{d:"M76.2653 114.47L126.823 63.9117C136.196 54.5391 151.392 54.5391 160.765 63.9117L161.118 64.2652C170.491 73.6378 170.491 88.8338 161.118 98.2063L99.7248 159.6C96.6006 162.724 96.6006 167.789 99.7248 170.913L112.331 183.52",stroke:"currentColor","stroke-width":"12","stroke-linecap":"round"}),s("path",{d:"M109.853 46.9411L59.6482 97.1457C50.2757 106.518 50.2757 121.714 59.6482 131.087V131.087C69.0208 140.459 84.2168 140.459 93.5894 131.087L143.794 80.8822",stroke:"currentColor","stroke-width":"12","stroke-linecap":"round"})],-1)),s("span",we,r(i(c)("ai-mcp.frontend.tool")),1),A.value.length?(l(),p(g,{key:0,ui:{base:"ring-0 -me-2"},size:"2xs"},{default:m(()=>[(l(!0),d(B,null,U(A.value,(e,V)=>(l(),p(f,{src:q(e)?.icon,style:de(`z-index: ${V+1}`),key:e,class:L(`${q(e)?.icon?"bg-secondary":"bg-primary"}`),ui:{fallback:"text-inverted"},alt:q(e)?.name||""},null,8,["src","style","class","alt"]))),128))]),_:1})):b("",!0)]),s("div",Ce,[A.value.length>0&&n.console?(l(),p(u,{key:0,name:"i-lucide-x",onClick:t[0]||(t[0]=T(e=>R(),["stop"]))})):b("",!0),s("div",Le,[y(u,{name:"i-lucide-chevron-down",class:L({"rotate-180":w.value})},null,8,["class"])])])]),_:1},8,["color","class","loading","disabled"])]),_:1},8,["open","disabled"])}}});export{rt as _};
